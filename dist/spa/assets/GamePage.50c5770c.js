import{g as ie}from"./QBtn.0bee305a.js";import{t as we,l as be,Q as _e,n as st,o as rt,m as Gt}from"./imagesEnum.466fb08f.js";import{T as lt,b as ge,S as ct,P as dt,E as ut,M as B,c as Ee,B as mt,G as ht,e as F,R as zt,d as jt,f as Ft,V as _,h as H,i as ae,Q as Je,j as et,k as G,l as Yt,g as i,m as T,u as Q,a as f,n as Vt,W as Wt,o as Ut}from"./game.cb47d5bd.js";import{_ as ve,O as A,W as de,X as $,f as D,R as J,Z as q,Q as Y,ak as pt,a0 as ye,F as ft,$ as X,d as Ht,k as ne,u as Bt,a7 as tt,a1 as $t,a2 as Kt}from"./index.4d0f9dc1.js";const E=ge.card;var O={config:E,createCard:qt,createTexturedMaterial:Xt,createColoredMaterial:Zt,createFromUrlMaterial:Qt,createCardFromMaterials:Jt};const Pe=new lt;function qt(t,n=F.DROW_PILE,s=null,e=null){if(t=Math.floor(Number(t)),isNaN(t)||t<1)return null;const o=E.width*E.size,r=E.height*E.size,c=E.radius*E.size,l=E.radius,u=E.depth*E.size,d=new ct;d.moveTo(0,c),d.lineTo(0,r-c),d.quadraticCurveTo(0,r,c,r),d.lineTo(o-c,r),d.quadraticCurveTo(o,r,o,r-c),d.lineTo(o,c),d.quadraticCurveTo(o,0,o-c,0),d.lineTo(c,0),d.quadraticCurveTo(0,0,0,c);const h=new dt;h.moveTo(l,l),h.lineTo(o-l,l),h.lineTo(o-l,r-l),h.lineTo(l,r-l),h.lineTo(l,l),d.holes.push(h);const p={steps:1,depth:u*t,bevelEnabled:!1},y=new ut(d,p),P=new B({color:"#000000"}),w=new Ee(y,P),S=new mt(o-2*l,r-2*l,u*t),z=[P,P,P,P,P,new B({map:Pe.load(we.CARD_BACK.path)})],N=s?[P,P,P,P,new B({map:Pe.load(s.path)}),new B({map:Pe.load(we.CARD_BACK.path)})]:null,j=new Ee(S,s?N:z),b=new ht;return w.position.x-=o/2,w.position.y-=r/2,w.position.z-=u*t/2,w.name=F.CARD_FRAME,b.add(w),b.add(j),b.rotateX(Math.PI/2),b.name=n,b.params={...e},b.select=(R=!0)=>{R?w.material=new B({color:"#ea7c01"}):w.material=P},s&&(b.hidePicture=(R=!0)=>{j.material=R?z:N}),b}function Xt(t){const n=new lt().load("data:image/jpeg;base64,"+t);return new B({map:n})}function Zt(t){return new B({color:t})}function Qt(t=we.CARD_BACK.path){return new B({map:Pe.load(t)})}function Jt(t,n,s,e,o,r=null){if(!n||!s||!(o!=null&&o.primary)||!(o!=null&&o.secondary)||(t=Math.floor(Number(t)),isNaN(t)||t<1))return null;const c=E.width*E.size,l=E.height*E.size,u=E.radius*E.size,d=E.radius,h=E.depth*E.size,p=new ct;p.moveTo(0,u),p.lineTo(0,l-u),p.quadraticCurveTo(0,l,u,l),p.lineTo(c-u,l),p.quadraticCurveTo(c,l,c,l-u),p.lineTo(c,u),p.quadraticCurveTo(c,0,c-u,0),p.lineTo(u,0),p.quadraticCurveTo(0,0,0,u);const y=new dt;y.moveTo(d,d),y.lineTo(c-d,d),y.lineTo(c-d,l-d),y.lineTo(d,l-d),y.lineTo(d,d),p.holes.push(y);const P={steps:1,depth:h*t,bevelEnabled:!1},w=new ut(p,P),S=new Ee(w,o.primary),z=new mt(c-2*d,l-2*d,h*t),N=[o.primary,o.primary,o.primary,o.primary,o.primary,e],j=[o.primary,o.primary,o.primary,o.primary,s,e],b=new Ee(z,N),R=new ht;return S.position.x-=c/2,S.position.y-=l/2,S.position.z-=h*t/2,S.name=F.CARD_FRAME,R.add(S),R.add(b),R.rotateX(Math.PI/2),R.name=n,R.params={...r},R.select=(x=!0)=>{x?S.material=new B({color:"#ea7c01"}):S.material=o.primary},R.hidePicture=(x=!0)=>{b.material=x?N:j},R}const at={type:"change"},Ae={type:"start"},nt={type:"end"},fe=new zt,it=new jt,ea=Math.cos(70*Yt.DEG2RAD);class ta extends Ft{constructor(n,s){super(),this.object=n,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new _,this.cursor=new _,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.PAN},this.touches={ONE:ae.ROTATE,TWO:ae.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(a){a.addEventListener("keydown",Oe),this._domElementKeyEvents=a},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Oe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(at),e.update(),r=o.NONE},this.update=function(){const a=new _,m=new Je().setFromUnitVectors(n.up,new _(0,1,0)),g=m.clone().invert(),C=new _,M=new Je,K=new _,L=2*Math.PI;return function(kt=null){const Ze=e.object.position;a.copy(Ze).sub(e.target),a.applyQuaternion(m),l.setFromVector3(a),e.autoRotate&&r===o.NONE&&se(Pt(kt)),e.enableDamping?(l.theta+=u.theta*e.dampingFactor,l.phi+=u.phi*e.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);let V=e.minAzimuthAngle,W=e.maxAzimuthAngle;isFinite(V)&&isFinite(W)&&(V<-Math.PI?V+=L:V>Math.PI&&(V-=L),W<-Math.PI?W+=L:W>Math.PI&&(W-=L),V<=W?l.theta=Math.max(V,Math.min(W,l.theta)):l.theta=l.theta>(V+W)/2?Math.max(V,l.theta):Math.min(W,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let le=!1;if(e.zoomToCursor&&ue||e.object.isOrthographicCamera)l.radius=Re(l.radius);else{const U=l.radius;l.radius=Re(l.radius*d),le=U!=l.radius}if(a.setFromSpherical(l),a.applyQuaternion(g),Ze.copy(e.target).add(a),e.object.lookAt(e.target),e.enableDamping===!0?(u.theta*=1-e.dampingFactor,u.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),e.zoomToCursor&&ue){let U=null;if(e.object.isPerspectiveCamera){const ce=a.length();U=Re(ce*d);const pe=ce-U;e.object.position.addScaledVector(R,pe),e.object.updateMatrixWorld(),le=!!pe}else if(e.object.isOrthographicCamera){const ce=new _(x.x,x.y,0);ce.unproject(e.object);const pe=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),e.object.updateProjectionMatrix(),le=pe!==e.object.zoom;const Qe=new _(x.x,x.y,0);Qe.unproject(e.object),e.object.position.sub(Qe).add(ce),e.object.updateMatrixWorld(),U=a.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;U!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(U).add(e.object.position):(fe.origin.copy(e.object.position),fe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(fe.direction))<ea?n.lookAt(e.target):(it.setFromNormalAndCoplanarPoint(e.object.up,e.target),fe.intersectPlane(it,e.target))))}else if(e.object.isOrthographicCamera){const U=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),U!==e.object.zoom&&(e.object.updateProjectionMatrix(),le=!0)}return d=1,ue=!1,le||C.distanceToSquared(e.object.position)>c||8*(1-M.dot(e.object.quaternion))>c||K.distanceToSquared(e.target)>c?(e.dispatchEvent(at),C.copy(e.object.position),M.copy(e.object.quaternion),K.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",qe),e.domElement.removeEventListener("pointerdown",Ue),e.domElement.removeEventListener("pointercancel",re),e.domElement.removeEventListener("wheel",He),e.domElement.removeEventListener("pointermove",Me),e.domElement.removeEventListener("pointerup",re),e.domElement.getRootNode().removeEventListener("keydown",Be,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Oe),e._domElementKeyEvents=null)};const e=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=o.NONE;const c=1e-6,l=new et,u=new et;let d=1;const h=new _,p=new G,y=new G,P=new G,w=new G,S=new G,z=new G,N=new G,j=new G,b=new G,R=new _,x=new G;let ue=!1;const I=[],oe={};let Te=!1;function Pt(a){return a!==null?2*Math.PI/60*e.autoRotateSpeed*a:2*Math.PI/60/60*e.autoRotateSpeed}function me(a){const m=Math.abs(a*.01);return Math.pow(.95,e.zoomSpeed*m)}function se(a){u.theta-=a}function he(a){u.phi-=a}const Ne=function(){const a=new _;return function(g,C){a.setFromMatrixColumn(C,0),a.multiplyScalar(-g),h.add(a)}}(),xe=function(){const a=new _;return function(g,C){e.screenSpacePanning===!0?a.setFromMatrixColumn(C,1):(a.setFromMatrixColumn(C,0),a.crossVectors(e.object.up,a)),a.multiplyScalar(g),h.add(a)}}(),ee=function(){const a=new _;return function(g,C){const M=e.domElement;if(e.object.isPerspectiveCamera){const K=e.object.position;a.copy(K).sub(e.target);let L=a.length();L*=Math.tan(e.object.fov/2*Math.PI/180),Ne(2*g*L/M.clientHeight,e.object.matrix),xe(2*C*L/M.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Ne(g*(e.object.right-e.object.left)/e.object.zoom/M.clientWidth,e.object.matrix),xe(C*(e.object.top-e.object.bottom)/e.object.zoom/M.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function Se(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d/=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Le(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d*=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ie(a,m){if(!e.zoomToCursor)return;ue=!0;const g=e.domElement.getBoundingClientRect(),C=a-g.left,M=m-g.top,K=g.width,L=g.height;x.x=C/K*2-1,x.y=-(M/L)*2+1,R.set(x.x,x.y,1).unproject(e.object).sub(e.object.position).normalize()}function Re(a){return Math.max(e.minDistance,Math.min(e.maxDistance,a))}function ke(a){p.set(a.clientX,a.clientY)}function Ct(a){Ie(a.clientX,a.clientX),N.set(a.clientX,a.clientY)}function Ge(a){w.set(a.clientX,a.clientY)}function wt(a){y.set(a.clientX,a.clientY),P.subVectors(y,p).multiplyScalar(e.rotateSpeed);const m=e.domElement;se(2*Math.PI*P.x/m.clientHeight),he(2*Math.PI*P.y/m.clientHeight),p.copy(y),e.update()}function bt(a){j.set(a.clientX,a.clientY),b.subVectors(j,N),b.y>0?Se(me(b.y)):b.y<0&&Le(me(b.y)),N.copy(j),e.update()}function Et(a){S.set(a.clientX,a.clientY),z.subVectors(S,w).multiplyScalar(e.panSpeed),ee(z.x,z.y),w.copy(S),e.update()}function Tt(a){Ie(a.clientX,a.clientY),a.deltaY<0?Le(me(a.deltaY)):a.deltaY>0&&Se(me(a.deltaY)),e.update()}function St(a){let m=!1;switch(a.code){case e.keys.UP:a.ctrlKey||a.metaKey||a.shiftKey?he(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(0,e.keyPanSpeed),m=!0;break;case e.keys.BOTTOM:a.ctrlKey||a.metaKey||a.shiftKey?he(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(0,-e.keyPanSpeed),m=!0;break;case e.keys.LEFT:a.ctrlKey||a.metaKey||a.shiftKey?se(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(e.keyPanSpeed,0),m=!0;break;case e.keys.RIGHT:a.ctrlKey||a.metaKey||a.shiftKey?se(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(-e.keyPanSpeed,0),m=!0;break}m&&(a.preventDefault(),e.update())}function ze(a){if(I.length===1)p.set(a.pageX,a.pageY);else{const m=te(a),g=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);p.set(g,C)}}function je(a){if(I.length===1)w.set(a.pageX,a.pageY);else{const m=te(a),g=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);w.set(g,C)}}function Fe(a){const m=te(a),g=a.pageX-m.x,C=a.pageY-m.y,M=Math.sqrt(g*g+C*C);N.set(0,M)}function It(a){e.enableZoom&&Fe(a),e.enablePan&&je(a)}function Rt(a){e.enableZoom&&Fe(a),e.enableRotate&&ze(a)}function Ye(a){if(I.length==1)y.set(a.pageX,a.pageY);else{const g=te(a),C=.5*(a.pageX+g.x),M=.5*(a.pageY+g.y);y.set(C,M)}P.subVectors(y,p).multiplyScalar(e.rotateSpeed);const m=e.domElement;se(2*Math.PI*P.x/m.clientHeight),he(2*Math.PI*P.y/m.clientHeight),p.copy(y)}function Ve(a){if(I.length===1)S.set(a.pageX,a.pageY);else{const m=te(a),g=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);S.set(g,C)}z.subVectors(S,w).multiplyScalar(e.panSpeed),ee(z.x,z.y),w.copy(S)}function We(a){const m=te(a),g=a.pageX-m.x,C=a.pageY-m.y,M=Math.sqrt(g*g+C*C);j.set(0,M),b.set(0,Math.pow(j.y/N.y,e.zoomSpeed)),Se(b.y),N.copy(j);const K=(a.pageX+m.x)*.5,L=(a.pageY+m.y)*.5;Ie(K,L)}function Mt(a){e.enableZoom&&We(a),e.enablePan&&Ve(a)}function Ot(a){e.enableZoom&&We(a),e.enableRotate&&Ye(a)}function Ue(a){e.enabled!==!1&&(I.length===0&&(e.domElement.setPointerCapture(a.pointerId),e.domElement.addEventListener("pointermove",Me),e.domElement.addEventListener("pointerup",re)),!Lt(a)&&(Nt(a),a.pointerType==="touch"?Ke(a):At(a)))}function Me(a){e.enabled!==!1&&(a.pointerType==="touch"?vt(a):Dt(a))}function re(a){switch(xt(a),I.length){case 0:e.domElement.releasePointerCapture(a.pointerId),e.domElement.removeEventListener("pointermove",Me),e.domElement.removeEventListener("pointerup",re),e.dispatchEvent(nt),r=o.NONE;break;case 1:const m=I[0],g=oe[m];Ke({pointerId:m,pageX:g.x,pageY:g.y});break}}function At(a){let m;switch(a.button){case 0:m=e.mouseButtons.LEFT;break;case 1:m=e.mouseButtons.MIDDLE;break;case 2:m=e.mouseButtons.RIGHT;break;default:m=-1}switch(m){case H.DOLLY:if(e.enableZoom===!1)return;Ct(a),r=o.DOLLY;break;case H.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enablePan===!1)return;Ge(a),r=o.PAN}else{if(e.enableRotate===!1)return;ke(a),r=o.ROTATE}break;case H.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enableRotate===!1)return;ke(a),r=o.ROTATE}else{if(e.enablePan===!1)return;Ge(a),r=o.PAN}break;default:r=o.NONE}r!==o.NONE&&e.dispatchEvent(Ae)}function Dt(a){switch(r){case o.ROTATE:if(e.enableRotate===!1)return;wt(a);break;case o.DOLLY:if(e.enableZoom===!1)return;bt(a);break;case o.PAN:if(e.enablePan===!1)return;Et(a);break}}function He(a){e.enabled===!1||e.enableZoom===!1||r!==o.NONE||(a.preventDefault(),e.dispatchEvent(Ae),Tt(_t(a)),e.dispatchEvent(nt))}function _t(a){const m=a.deltaMode,g={clientX:a.clientX,clientY:a.clientY,deltaY:a.deltaY};switch(m){case 1:g.deltaY*=16;break;case 2:g.deltaY*=100;break}return a.ctrlKey&&!Te&&(g.deltaY*=10),g}function Be(a){a.key==="Control"&&(Te=!0,e.domElement.getRootNode().addEventListener("keyup",$e,{passive:!0,capture:!0}))}function $e(a){a.key==="Control"&&(Te=!1,e.domElement.getRootNode().removeEventListener("keyup",$e,{passive:!0,capture:!0}))}function Oe(a){e.enabled===!1||e.enablePan===!1||St(a)}function Ke(a){switch(Xe(a),I.length){case 1:switch(e.touches.ONE){case ae.ROTATE:if(e.enableRotate===!1)return;ze(a),r=o.TOUCH_ROTATE;break;case ae.PAN:if(e.enablePan===!1)return;je(a),r=o.TOUCH_PAN;break;default:r=o.NONE}break;case 2:switch(e.touches.TWO){case ae.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;It(a),r=o.TOUCH_DOLLY_PAN;break;case ae.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Rt(a),r=o.TOUCH_DOLLY_ROTATE;break;default:r=o.NONE}break;default:r=o.NONE}r!==o.NONE&&e.dispatchEvent(Ae)}function vt(a){switch(Xe(a),r){case o.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ye(a),e.update();break;case o.TOUCH_PAN:if(e.enablePan===!1)return;Ve(a),e.update();break;case o.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Mt(a),e.update();break;case o.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ot(a),e.update();break;default:r=o.NONE}}function qe(a){e.enabled!==!1&&a.preventDefault()}function Nt(a){I.push(a.pointerId)}function xt(a){delete oe[a.pointerId];for(let m=0;m<I.length;m++)if(I[m]==a.pointerId){I.splice(m,1);return}}function Lt(a){for(let m=0;m<I.length;m++)if(I[m]==a.pointerId)return!0;return!1}function Xe(a){let m=oe[a.pointerId];m===void 0&&(m=new G,oe[a.pointerId]=m),m.set(a.pageX,a.pageY)}function te(a){const m=a.pointerId===I[0]?I[1]:I[0];return oe[m]}e.domElement.addEventListener("contextmenu",qe),e.domElement.addEventListener("pointerdown",Ue),e.domElement.addEventListener("pointercancel",re),e.domElement.addEventListener("wheel",He,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Be,{passive:!0,capture:!0}),this.update()}}var aa={add:na};function na(t,n){const s=new ta(t,n.domElement);return s.enableDamping=!0,s.dampingFactor=.05,s.screenSpacePanning=!0,s.enablePan=!1,s.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.ROTATE},s.enableZoom=!0,s.minDistance=300,s.maxDistance=3e3,s.minPolarAngle=-1,s.maxPolarAngle=Math.PI/2.01,s}var v={moveCardVertically:Z,moveCard:Ce,rotateCardTo:gt,rotateCardBy:sa,moveCardTo:yt,shuffleIfNeeded:ia};async function Z(t,n=i().animate.stepSize,s=T.tableConfig.height+150){const e=Math.sign(s-t.position.y);n||(n=i().animate.stepSize),n*=i().speed;let o=null;return new Promise(r=>{const c=()=>{if(i().state===f.NO_GAME){o&&cancelAnimationFrame(o),r(!1);return}if(Math.abs(t.position.y-s)<=n){t.position.y=s,r(!0);return}t.position.y+=e*n,o=requestAnimationFrame(c)};c()})}async function Ce(t,n=100,s=Math.PI,e=i().animate.stepSize){e*=i().speed;let o=0;const r=Q.vector(s,e);let c=null;return new Promise(l=>{const u=()=>{if(n-o<=e){l(!0);return}if(t.position.x+=r.x,t.position.z+=r.z,o+=e,i().state===f.NO_GAME){c&&cancelAnimationFrame(c),l(!1);return}c=requestAnimationFrame(u)};u()})}async function gt(t,n=null,s=null,e=null){const o=i().animate.angleSize*i().speed,r=Math.sign(1/n),c=Math.sign(1/e),l=Math.sign(1/s);let u=null;return new Promise(d=>{const h=()=>{if(n!=null&&Math.abs(n-t.rotation.x)<=o?t.rotation.x+=o*r:n!=null&&(t.rotation.x=n,n=null),s!=null&&Math.abs(s-t.rotation.y)<=o?t.rotation.y+=o*l:s!=null&&(t.rotation.y=s,s=null),e!=null&&Math.abs(e-t.rotation.z)<=o?t.rotation.z+=o*c:e!=null&&(t.rotation.z=e,e=null),n===null&&s===null&&e===null){d(!0);return}if(i().state===f.NO_GAME){u&&cancelAnimationFrame(u),d(!1);return}u=requestAnimationFrame(h)};h()})}async function ia(t,n,s){if(i().drawPileCardsIds.length===0){const e=[],o=i().discardPileCardsIds,r=o[o.length-1],c=o.slice(0,-1);for(const u of c){const d=i().gameCards.find(h=>h.params.cardId===u);await Ce(d,ge.card.height*1.1),await Z(d,void 0,T.tableConfig.height+75+e.length),await gt(d,Math.PI/2,0,0),d.hidePicture(!0),await Z(d,void 0,T.tableConfig.height+150+e.length),e.push(d)}if(e.length>2)for(let u=0;u<50;u++){const d=Math.floor(Math.random()*e.length),h=e[d];await Ce(h,100,void 0,15),await Z(h,15,T.tableConfig.height+150+e.length+u),await Ce(h,100,2*Math.PI,15);for(let p=0;p<e.length;p++){const y=e[p];await Z(y,15,T.tableConfig.height+150+e.length+p)}}for(let u=0;u<e.length;u++){const d=e[u];await yt(d,ge.animate.drawPilePosition,void 0,15),await Z(d,15,T.tableConfig.height+u*.5),i().drawPileCardsIds.push(d.params.cardId),t.remove(d),t.remove(n),s()}i().drawPileCardsIds=oa(c),i().discardPileCardsIds=[r];const l=i().gameCards.find(u=>u.params.cardId===r);await Z(l,15,T.tableConfig.height+ge.card.depth)}}function oa(t){for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}return t}async function sa(t,n=null,s=null,e=null){const o=i().animate.angleSize*i().speed,r=n?Math.abs(Math.ceil(n/o)):null,c=s?Math.abs(Math.ceil(s/o)):null,l=e?Math.abs(Math.ceil(e/o)):null;let u=0,d=null;return new Promise(h=>{const p=()=>{if(r&&r>u&&t.rotateX(n/r),c&&c>u&&t.rotateY(s/c),l&&l>u&&t.rotateZ(e/l),Math.max(r,l,c)===u){h(!0);return}if(u++,i().state===f.NO_GAME){d&&cancelAnimationFrame(d),h(!1);return}d=requestAnimationFrame(p)};p()})}async function yt(t,n={x:0,z:0},s=null,e=i().animate.stepSize){n.x=Q.round(n.x),n.z=Q.round(n.z),e*=i().speed;let o=i().animate.angleSize*i().speed;const r=t.position;let c=0;const l=Math.atan2(n.z-r.z,n.x-r.x),u=Q.vector(l,e),d=Q.distance(r.x,n.x,r.z,n.z);let h=null;return new Promise(p=>{const y=()=>{const P=d-c;if(P<=e?(t.position.x=n.x,t.position.z=n.z,c=d):(t.position.x+=u.x,t.position.z+=u.z,c+=e),s!==null){const w=s-t.rotation.z;Math.abs(w)<=o?(t.rotation.z=s,s=null):t.rotation.z+=Math.sign(w)*o}if(P<=e&&s===null){p(!0);return}if(i().state===f.NO_GAME){h&&cancelAnimationFrame(h),p(!1);return}h=requestAnimationFrame(y)};y()})}var k=Object.freeze({DRAW_TO_DISCARD:"DRAW_TO_DISCARD",DRAW_TO_PLAYER:"DRAW_TO_PLAYER",PLAYER_TO_DISCARD:"PLAYER_TO_DISCARD",NOT_PLAY:"NOT_PLAY",GAME_OVER:"GAME_OVER"});const ra={name:"SuitSelectDialog",props:{modelValue:{type:Boolean,default:!1},items:{type:Array,default:()=>[]}},data:()=>({}),computed:{modelValueComp:{get(){return this.modelValue},set(t){this.$emit("update:model-value",t)}},itemSelected(){return!!this.items.filter(t=>t.selected).length}},methods:{handleClick(t){if(!t.selected){this.items.forEach(n=>n.selected=!1),t.selected=!0;return}this.$emit("select",t.name),this.$emit("update:model-value",!1)}}},la={class:"text-h6"};function ca(t,n,s,e,o,r){return A(),de(rt,{modelValue:r.modelValueComp,"onUpdate:modelValue":n[0]||(n[0]=c=>r.modelValueComp=c),persistent:""},{default:$(()=>[D(st,null,{default:$(()=>[D(be,null,{default:$(()=>[J("div",la,"Vyberte barvu "+q(r.itemSelected?"(vyberte znovu pro potvrzen\xED)":""),1)]),_:1}),D(be,{class:"fp-row"},{default:$(()=>[(A(!0),Y(ft,null,pt(s.items,(c,l)=>(A(),de(_e,{key:l,src:c.image,style:ye(`width: 200px; border: solid 3px ${c.selected?"red":"white"};`),onClick:u=>r.handleClick(c)},null,8,["src","style","onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var da=ve(ra,[["render",ca]]);const ua={name:"GameOverDialog",props:{modelValue:{type:Boolean,default:!1},playerId:{type:Number,default:null}},data:()=>({}),computed:{valueComp:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},player(){return this.playerId?i().players.find(t=>t.id===this.playerId):{}}},methods:{startGame(){i().setGameState(f.START_GAME)},stopGame(){i().setGameState(f.NO_GAME)},restartGame(){this.stopGame(),this.$nextTick(()=>this.startGame()),this.close()},close(){this.$emit("update:modelValue",!1)}}},ma=J("span",{style:{"font-size":"14pt","font-weight":"bold"}},"Vyhr\xE1l:",-1),ha={style:{"font-size":"28pt","font-weight":"bold",color:"#0d47a1"}},pa=J("br",null,null,-1);function fa(t,n,s,e,o,r){return A(),de(rt,{modelValue:r.valueComp,"onUpdate:modelValue":n[0]||(n[0]=c=>r.valueComp=c),persistent:""},{default:$(()=>[D(st,null,{default:$(()=>[D(be,null,{default:$(()=>[ma]),_:1}),D(be,null,{default:$(()=>{var c,l;return[J("span",ha,q((c=r.player)==null?void 0:c.name),1),pa,(l=r.player)!=null&&l.avatar?(A(),de(_e,{key:0,src:r.player.avatar,style:{"margin-left":"10px",width:"350px","border-radius":"5px"}},null,8,["src"])):X("",!0)]}),_:1}),D(Gt,{align:"right",class:"text-primary"},{default:$(()=>[D(ie,{style:{margin:"auto"},color:"orange",label:t.$t("zavrit"),onClick:r.close},null,8,["label","onClick"]),D(ie,{style:{margin:"auto"},color:"secondary",label:t.$t("hra_restart"),onClick:r.restartGame},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ga=ve(ua,[["render",fa]]);const ot=new Vt,De=new G,ya=Ht({name:"GamePage",components:{GameOverDialog:ga,SuitSelectDialog:da},data:()=>({suits:[],itemsSelectSuits:[],showSelectSuit:!1,computerStopBtn:!1,showGameOverDialog:!1,winnerId:null,gameContainerWidth:0,gameContainerHeight:0,camera:null,renderer:null,scene:null,drawPileObject:null,materials:{cardFrame:{primary:null,secondary:null},cardBack:null,table:null,sky:null,grass:null},cameraView:{PLAYER:"player",TABLE:"table"},playerSelectObject:null,timeouts:[],axiosCancelTokenStoreName:"game"}),computed:{loading(){return i().state===f.LOADING},showMenu(){return ne().showMenu},showStausBar(){return!1},players(){return i().players.length},activePlayer(){return i().players.find(t=>t.id===i().activePlayerId)},gameWarning(){return i().warning},gameInfo(){return i().info},hasMoreMoves(){var t;return i().activePlayerId?!(i().lastPlayerMove===k.PLAYER_TO_DISCARD||i().lastPlayerMove===k.NOT_PLAY||i().lastPlayerMove===k.DRAW_TO_PLAYER&&((t=i().rules)==null?void 0:t.numberOfCardsToDraw)===0):!0},lastMove(){return i().lastPlayerMove},showStopBtn(){var c,l,u,d;const t=i().discardPileCardsIds,n=t[t.length-1],s=(u=(l=(c=i())==null?void 0:c.gameCards)==null?void 0:l.find(h=>h.params.cardId===n))==null?void 0:u.params,e=(s==null?void 0:s.power)==="GET"&&(s==null?void 0:s.powerValue)===0,o=((d=i().rules)==null?void 0:d.numberOfCardsToDraw)>0;return f.PLAYER_TURN===i().state&&e&&!o},showSuits(){var e,o,r,c;if(!((e=i().gameCards)!=null&&e.length))return[];if(!((o=i().discardPileCardsIds)!=null&&o.length))return[];const t=i().discardPileCardsIds,n=t[t.length-1];return((r=i().gameCards.find(l=>l.params.cardId===n).params)==null?void 0:r.power)!=="SELECT_SUIT"?[]:(c=i().rules)!=null&&c.suit?this.suits.filter(l=>l.name===i().rules.suit):this.suits},mainPlayer(){const t=i().players.find(n=>n.id===Bt().id);return t||{}},isGameActive(){return i().state!==f.NO_GAME}},methods:{async startGame(){const t=i().settings;this.resetGame(),i().setGameState(f.LOADING),this.materials.cardFrame.primary=O.createColoredMaterial("#000000"),this.materials.cardFrame.secondary=O.createColoredMaterial("#fb8d3c"),this.materials.cardBack=O.createFromUrlMaterial(we.CARD_BACK.path),i().gameCards=await this.getDrawCardPileFromServer(t.cardGroupId);const n=await this.getNewGameFromServer(t);if(!n){this.resetGame();return}i().setPiles(n),i().setPlayers(n.players),i().setGameState(f.DEAL_CARDS),this.createDrawPile(),await this.dealCards(n.movesList),i().setFromState(n),i().setActivePlayerById(n.nextPLayerId)},async dealCards(t){const n=t.map((s,e)=>new Promise(o=>{const r=setTimeout(async()=>{await this.executeMove(s),o()},e*500/i().speed);this.timeouts.push(r)}));await Promise.all(n)},async executeMove(t,n){var s,e;switch(t.type){case k.DRAW_TO_DISCARD:n=await this.getDrawPileCard(null,!0),await this.moveToDiscardPile(n)||i().setGameState(f.ERROR);return;case k.DRAW_TO_PLAYER:const r=i().rules;if(!r){await this.getDrawPileCard(this.getPlayer(t.to));return}if(r.numberOfCardsToDraw===0){i().setWarning("Nepovolen\xFD tah");return}else if(r.numberOfCardsToDraw--,r.permittedCardIdsOnDiscardPile=[],r.numberOfCardsToDraw===0&&i().setGameState(this.activePlayer===this.mainPlayer?f.PLAYER_TURN_PROCESSING:f.COMPUTER_TURN_PROCESSING,!1),await this.getDrawPileCard(this.getPlayer(t.to)),await v.shuffleIfNeeded(this.scene,this.drawPileObject,()=>this.createDrawPile()),r.numberOfCardsToDraw>0){this.activePlayer===this.mainPlayer&&this.executeMove(t);return}break;case k.PLAYER_TO_DISCARD:const c=this.getPlayer(t.from);if(this.mainPlayer!==c)i().setGameState(f.COMPUTER_TURN_PROCESSING,!1),n=i().gameCards.find(l=>l.params.cardId===t.cardId),t.newSuit&&(i().rules.suit=t.newSuit),await this.moveToDiscardPile(n,c);else if((((s=i().rules)==null?void 0:s.permittedCardIdsOnDiscardPile)||[]).includes(n.params.cardId))i().setGameState(f.PLAYER_TURN_PROCESSING),await this.moveToDiscardPile(n,c);else{i().setWarning("Nepovolen\xFD tah");return}break;case k.NOT_PLAY:this.activePlayer===this.mainPlayer?i().setGameState(f.PLAYER_TURN_PROCESSING):(this.computerStopBtn=!0,await this.sleep(1e3/i().speed),this.computerStopBtn=!1,i().setGameState(f.COMPUTER_TURN_PROCESSING,!1));break}i().lastPlayerMove=t.type,i().state===f.COMPUTER_TURN_PROCESSING&&this.getNextPlayerActions(),i().state===f.PLAYER_TURN_PROCESSING&&(t.type===k.PLAYER_TO_DISCARD&&((e=n==null?void 0:n.params)==null?void 0:e.power)==="SELECT_SUIT"?this.openSelectSuitDialog():this.getNextPlayerActions())},createDrawPile(){const t=i().drawPileCardsIds.length,n=O.createCardFromMaterials(t,F.DROW_PILE,this.materials.cardFrame,this.materials.cardBack,this.materials.cardFrame,{selectable:!0});n&&(n.position.y=T.tableConfig.height+(t+1)*O.config.depth,n.position.x=i().animate.drawPilePosition.x,n.position.z=i().animate.drawPilePosition.z,this.scene.add(n)),this.drawPileObject=n},handleMouseClickOnCard(t){var e;const n=i().players[0];if(n.id!==i().activePlayerId||!((e=t==null?void 0:t.params)!=null&&e.selectable))return;if(!this.playerSelectObject||this.playerSelectObject&&this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect();const s=t.params.cardId;n.cardInHandIds.includes(s)&&this.executeMove({type:k.PLAYER_TO_DISCARD,from:n.id},t)},handleMouseClickOnDrawPile(t){if(i().players[0].id===i().activePlayerId){if(!this.playerSelectObject||this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect(),this.executeMove({type:k.DRAW_TO_PLAYER,to:this.mainPlayer.id})}},getPlayer(t){return i().players.find(n=>n.id===t)},clearPlayerSelect(){const t=this.playerSelectObject;!t||(t.select&&t.select(!1),this.playerSelectObject=null)},async addCardToHand(t,n,s=i().animate.cardAngleView){const e=Math.abs(Math.ceil(s/(i().animate.angleSize*i().speed)));let o=0,r=null;return new Promise(c=>{const l=async()=>{if(o<e)t.rotateX(s/e),o++;else{n.cardInHandIds.push(t.params.cardId);const u=i().animate.maxCardsPerRow;let d=(n.cardInHandIds.length-1)%u+1,h=Math.floor((n.cardInHandIds.length-1)/u);switch(h){case 0:h=1;break;case 1:h=0;break;case 2:break;default:h=-h+2}if(h*=i().animate.cardOverlap,h-=1,d-1){const p=n.point,y=d%2===0?n.angle-Math.PI/2:n.angle+Math.PI/2,P=Q.vector(y,(O.config.width*2+10)*Math.floor(d/2));if(P.x+=p.x,P.z+=p.z,!await v.moveCardTo(t,P)){c(!1);return}}if(!await v.moveCardVertically(t,void 0,T.tableConfig.height-h*O.config.height)){c(!1);return}if(!await v.moveCard(t,O.config.height*Math.abs(h),Math.sign(h)*n.angle)){c(!1);return}c(!0);return}if(i().state===f.NO_GAME){r&&cancelAnimationFrame(r),c(!1);return}r=requestAnimationFrame(l)};l()})},async moveToDiscardPile(t,n){if(!t)return!1;t.params.selectable=!1,t.hidePicture(!1);const s=t.params.cardId,e=T.tableConfig.height+i().discardPileCardsIds.length*O.config.depth*4,o=i().animate.discardPilePosition,r={...t.position};i().discardPileCardsIds.push(s);let c=null,l=!0;if(n){const d=n.cardInHandIds,h=d.findIndex(y=>y===s),p=d.length-1;h!==p&&(c=i().gameCards.find(y=>y.params.cardId===d[p]),d.splice(h,1,c.params.cardId),l=!1),d.pop()}const u=async()=>{await v.moveCardVertically(c,void 0,r.y),await v.moveCardTo(c,{x:r.x,z:r.z})};return new Promise(async d=>{let h=await v.moveCardVertically(t);l||u(),h&&(h=await v.rotateCardBy(t,Math.PI/2+i().animate.cardAngleView)),h&&(h=await v.moveCardTo(t,o));const p=Q.round(Math.random()*2*Math.PI);if(h&&(h=await v.rotateCardTo(t,-Math.PI/2,0,p)),h&&(h=await v.moveCardVertically(t,void 0,e)),!h){i().setGameState(f.ERROR),d(!1);return}t.params.selectable=!0,d(!0)})},async getDrawPileCard(t,n){if(i().state===f.NO_GAME)return;const s=i().drawPileCardsIds.length;if(!s)return i().setGameState(f.ERROR),!1;const e=i().drawPileCardsIds[0],o=i().gameCards.find(l=>l.params.cardId===e);if(!o)return;i().drawPileCardsIds=i().drawPileCardsIds.slice(1),o.params.selectable=!1,o.hidePicture(!(t!=null&&t.main));const r=this.drawPileObject,c={x:r.position.x,z:r.position.z};if(o.position.y=T.tableConfig.height+s*2*O.config.depth,o.position.x=c.x,o.position.z=c.z,this.scene.add(o),this.scene.remove(r),this.createDrawPile(),!await v.moveCardVertically(o))return!1;if(n)return o.params.selectable=!0,o;if(!await v.moveCardTo(o,t.point,-Math.PI/2+t.angle))return!1;await this.addCardToHand(o,t),o.params.selectable=!0},showNextPlayerNameBeforeServerResponse(){let t=i().players.findIndex(e=>e.id===i().activePlayerId)+1;const n=i().players.length,s=i().players[t%n];return this.mainPlayer!==s&&i().setInfo("Hraje "+s.name),s.id},addListeners(){window.addEventListener("resize",this.handleChangeWindowSize.bind(this)),this.$refs.gameContainer.addEventListener("click",this.onMouseClick),this.$refs.gameContainer.addEventListener("dblclick",this.onMouseDoubleClick)},removeListeners(){window.removeEventListener("resize",this.handleChangeWindowSize),this.$refs.gameContainer.removeEventListener("click",this.onMouseClick),this.$refs.gameContainer.removeEventListener("dblclick",this.onMouseDoubleClick)},resetScene(){const t=[F.CARD,F.DROW_PILE,F.DISCARD_PILE,F.TABLE],n=this.scene;n.children.filter(o=>t.includes(o.name)).forEach(o=>{n.remove(o)});const e=T.createTable(this.materials.table);e&&this.scene.add(e)},resetGame(){this.resetScene(),i().reset(),this.timeouts.forEach(clearTimeout);const t=ne().axiosRequests[this.axiosCancelTokenStoreName];t!=null&&t.length&&t.forEach(n=>{n.cancel&&n.cancel()}),this.timeouts=[]},initWebGL(){this.materials.table=T.createTableMaterial();const t=this.$refs.gameContainer,n=t.clientWidth,s=t.clientHeight,e=new Wt({antialias:!0});e.setSize(n,s),t.appendChild(e.domElement);const o=new Ut(75,n/s,1,1e4);o.lookAt(0,T.tableConfig.height+O.config.height*3,0);const r=aa.add(o,e),c=T.create(),l=T.createTable(this.materials.table);l&&c.add(l);const u=()=>{requestAnimationFrame(u),r.update(),e.render(c,o)};this.scene=c,this.renderer=e,this.camera=o,this.gameContainerWidth=n,this.gameContainerHeight=s,this.changeCameraView(this.cameraView.PLAYER),u()},changeCameraView(t){t||(t=i().cameraView);const n=this.camera,s=this.cameraView,e=this.mainPlayer.point||{x:0,z:T.tableConfig.radius};switch(t){case null:case s.PLAYER:n.position.set(0,T.tableConfig.height*2+O.config.height*2.5,e.z*1.05+O.config.height*1.5);break;case s.TABLE:n.position.set(0,e.z*1.3,e.z*.5);break}i().cameraView=t},handleChangePlayers(){this.resetScene()},handleChangeWindowSize(){const t=this.$refs.gameContainer,n=t.clientWidth,s=t.clientHeight;this.fitGameContainerToSize(n,s)},handleSuitSelect(t){i().rules.suit=t,this.getNextPlayerActions()},handleNotPlay(){this.executeMove({type:k.NOT_PLAY})},openSelectSuitDialog(){this.$get("prsi/suits",{groupId:i().settings.cardGroupId}).then(t=>{!t||(this.itemsSelectSuits=[],t.forEach(n=>{n.image.startsWith("data:image")||(n.image="data:"+n.imageType+";base64,"+n.image)}),this.itemsSelectSuits=t,this.showSelectSuit=!0)})},onMouseClick(t){var o,r;if(t.stopPropagation(),i().state===f.LOADING||i().state===f.DEAL_CARDS||i().state===f.WAITING_FOR_SERVER||i().state===f.PLAYER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na dokon\u010Den\xED akce");return}if(i().state===f.COMPUTER_TURN||i().state===f.COMPUTER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na tah protihr\xE1\u010De");return}const s=this.$refs.gameContainer.getBoundingClientRect();De.x=(t.clientX-s.left)/s.width*2-1,De.y=-((t.clientY-s.top)/s.height)*2+1,ot.setFromCamera(De,this.camera);const e=ot.intersectObjects(this.scene.children);switch((r=(o=e[0].object)==null?void 0:o.parent)==null?void 0:r.name){case F.CARD:this.handleMouseClickOnCard(e[0].object.parent);return;case F.DROW_PILE:this.handleMouseClickOnDrawPile(e[0].object.parent);return}this.playerSelectObject&&this.clearPlayerSelect()},handleSwitchMenu(){window.innerWidth<ne().minimumViewPort||(ne().showMenu?setTimeout(()=>{this.fitGameContainerToSize(this.gameContainerWidth-ne().menuWidth)},200):this.fitGameContainerToSize(this.gameContainerWidth+ne().menuWidth))},fitGameContainerToSize(t,n){n==null&&(n=this.gameContainerHeight),t==null&&(t=this.gameContainerWidth),this.camera.aspect=t/n,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,n),this.gameContainerWidth=t,this.gameContainerHeight=n},clearAll(){this.resetScene(),this.scene=null,this.renderer=null,this.camera=null,this.gameContainerWidth=null,this.gameContainerHeight=null},gameOver(t){console.log("ukon\u010Dit hru"),console.log(t),i().activePlayerId=null,i().setGameState(f.GAME_OVER),this.showGameOverDialog=!0,this.winnerId=t.to},async getDrawCardPileFromServer(t){this.$get("prsi/suits",{groupId:i().settings.cardGroupId},!1,this.axiosCancelTokenStoreName).then(e=>{e&&(e.forEach(o=>{o.image.startsWith("data:image")||(o.image="data:"+o.imageType+";base64,"+o.image)}),this.suits=e)});const n=[],s=await this.$get("prsi/all_cards",{groupId:t},!1,this.axiosCancelTokenStoreName);if(s!==null)return s.forEach(e=>{n.push(O.createCardFromMaterials(1,F.CARD,O.createTexturedMaterial(e.face),this.materials.cardBack,this.materials.cardFrame,{cardId:e.id,selectable:!0,face:e.face,power:e.power,powerValue:e.powerValue})),delete e.face}),n},async getNewGameFromServer(t){return await this.$post("prsi/start",t,!1,this.axiosCancelTokenStoreName)},async getNextPlayerActions(){if(i().state===f.NO_GAME)return;const t={stateId:i().stateId,players:i().players.map(e=>({id:e.id,cardIds:e.cardInHandIds})),drawPile:i().drawPileCardsIds,discardPile:i().discardPileCardsIds,rules:i().rules,lastMove:i().lastPlayerMove,lastMoveBy:i().activePlayerId},n=this.showNextPlayerNameBeforeServerResponse();i().setGameState(f.WAITING_FOR_SERVER);const s=await this.$post("prsi/next",t,!1,this.axiosCancelTokenStoreName);if(!!s){i().activePlayerId=n,i().setGameState(this.mainPlayer===this.activePlayer?f.PLAYER_TURN:f.COMPUTER_TURN,this.mainPlayer===this.activePlayer),i().setFromState(s);for(const e of s.movesList){if(e.type===k.GAME_OVER){this.gameOver(e);return}await this.executeMove(e),await this.sleep(500)}}},async sleep(t){return new Promise(n=>setTimeout(n,t))}},mounted(){this.initWebGL(),this.addListeners()},beforeUnmount(){this.removeListeners(),this.clearAll()},watch:{showMenu(){this.handleSwitchMenu()},players(){this.handleChangePlayers()},isGameActive(){i().state===f.START_GAME&&this.startGame(),i().state===f.NO_GAME&&this.resetGame()}}}),Pa=t=>($t("data-v-732c4dd9"),t=t(),Kt(),t),Ca={class:"height-100 width-100 fp-column game-page",ref:"gamePage"},wa={key:0,class:"overlay"},ba=Pa(()=>J("span",{class:"overlay-text"},"Na\u010D\xEDt\xE1n\xED hry",-1)),Ea=[ba],Ta={id:"gameContainer",ref:"gameContainer",class:"game-container"},Sa={key:1,class:"game-statusbar non-selectable"},Ia={class:"fp-column",style:{position:"absolute",right:"3px"}},Ra={key:2,class:"non-selectable width-100 page-info"},Ma={key:3,class:"non-selectable width-100 page-warning"};function Oa(t,n,s,e,o,r){var u;const c=tt("suit-select-dialog"),l=tt("game-over-dialog");return A(),Y("div",Ca,[t.loading?(A(),Y("div",wa,Ea)):X("",!0),J("div",Ta,null,512),t.showStausBar?(A(),Y("div",Sa," hr\xE1\u010D\u016F: "+q(t.players)+", hr\xE1\u010D: "+q((u=t.activePlayer)==null?void 0:u.name)+", existuje tah: "+q(t.hasMoreMoves)+", posledn\xED tah: "+q(t.lastMove)+", ",1)):X("",!0),J("div",Ia,[D(ie,{style:{margin:"3px","z-index":"10"},icon:"panorama",color:"accent",title:"Zobrazit pohled hr\xE1\u010De",onClick:n[0]||(n[0]=d=>t.changeCameraView(t.cameraView.PLAYER))}),D(ie,{style:{margin:"3px","z-index":"10"},icon:"visibility",color:"accent",title:"N\xE1hled na hern\xED st\u016Fl",onClick:n[1]||(n[1]=d=>t.changeCameraView(t.cameraView.TABLE))})]),!t.gameWarning&&t.gameInfo?(A(),Y("div",Ra,q(t.gameInfo),1)):X("",!0),t.gameWarning?(A(),Y("div",Ma,q(t.gameWarning),1)):X("",!0),t.computerStopBtn?(A(),Y("div",{key:4,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-50}px; top: ${t.gameContainerHeight/3-50}px`)},[D(ie,{icon:"front_hand",color:"red",title:"St\xE1t",style:{width:"100px",height:"100px"},class:"page-warning",onClick:n[2]||(n[2]=d=>t.handleNotPlay())})],4)):X("",!0),t.showStopBtn?(A(),Y("div",{key:5,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-50}px; bottom: 100px`)},[D(ie,{icon:"front_hand",color:"accent",title:"St\xE1t",style:{margin:"3px"},class:"page-warning",onClick:n[3]||(n[3]=d=>t.handleNotPlay())})],4)):t.showSuits.length?(A(),Y("div",{key:6,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-t.showSuits.length*27}px; bottom: 30px`)},[(A(!0),Y(ft,null,pt(t.showSuits,(d,h)=>(A(),de(_e,{key:h,src:d.image,style:{width:"50px",margin:"4px"}},null,8,["src"]))),128))],4)):X("",!0),D(c,{modelValue:t.showSelectSuit,"onUpdate:modelValue":n[4]||(n[4]=d=>t.showSelectSuit=d),items:t.itemsSelectSuits,onSelect:t.handleSuitSelect},null,8,["modelValue","items","onSelect"]),D(l,{modelValue:t.showGameOverDialog,"onUpdate:modelValue":n[5]||(n[5]=d=>t.showGameOverDialog=d),"player-id":t.winnerId},null,8,["modelValue","player-id"])],512)}var La=ve(ya,[["render",Oa],["__scopeId","data-v-732c4dd9"]]);export{La as default};
