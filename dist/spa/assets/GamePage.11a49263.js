import{g as ne}from"./QBtn.03e79f6b.js";import{t as Pe,l as Ce,Q as Ae,n as it,o as ot,m as Nt}from"./imagesEnum.406f7307.js";import{T as st,b as fe,S as rt,P as lt,E as ct,M as B,c as we,B as dt,G as ut,e as F,R as xt,d as Lt,f as kt,V as v,h as H,i as te,Q as Ze,j as Qe,k as G,l as Gt,g as i,m as S,u as Z,a as p,n as zt,W as jt,o as Ft}from"./game.73704761.js";import{_ as De,O as D,W as ce,X as $,f as _,R as Q,Z as q,Q as V,ak as mt,a0 as ge,F as ht,$ as X,d as Vt,k as ae,u as Yt,a7 as Je,a1 as Wt,a2 as Ut}from"./index.999f1b65.js";const T=fe.card;var A={config:T,createCard:Ht,createTexturedMaterial:Bt,createColoredMaterial:$t,createFromUrlMaterial:Kt,createCardFromMaterials:qt};const ye=new st;function Ht(t,n=F.DROW_PILE,r=null,e=null){if(t=Math.floor(Number(t)),isNaN(t)||t<1)return null;const o=T.width*T.size,s=T.height*T.size,l=T.radius*T.size,c=T.radius,m=T.depth*T.size,d=new rt;d.moveTo(0,l),d.lineTo(0,s-l),d.quadraticCurveTo(0,s,l,s),d.lineTo(o-l,s),d.quadraticCurveTo(o,s,o,s-l),d.lineTo(o,l),d.quadraticCurveTo(o,0,o-l,0),d.lineTo(l,0),d.quadraticCurveTo(0,0,0,l);const h=new lt;h.moveTo(c,c),h.lineTo(o-c,c),h.lineTo(o-c,s-c),h.lineTo(c,s-c),h.lineTo(c,c),d.holes.push(h);const g={steps:1,depth:m*t,bevelEnabled:!1},C=new ct(d,g),y=new B({color:"#000000"}),b=new we(C,y),I=new dt(o-2*c,s-2*c,m*t),z=[y,y,y,y,y,new B({map:ye.load(Pe.CARD_BACK.path)})],N=r?[y,y,y,y,new B({map:ye.load(r.path)}),new B({map:ye.load(Pe.CARD_BACK.path)})]:null,j=new we(I,r?N:z),E=new ut;return b.position.x-=o/2,b.position.y-=s/2,b.position.z-=m*t/2,b.name=F.CARD_FRAME,E.add(b),E.add(j),E.rotateX(Math.PI/2),E.name=n,E.params={...e},E.select=(M=!0)=>{M?b.material=new B({color:"#ea7c01"}):b.material=y},r&&(E.hidePicture=(M=!0)=>{j.material=M?z:N}),E}function Bt(t){const n=new st().load("data:image/jpeg;base64,"+t);return new B({map:n})}function $t(t){return new B({color:t})}function Kt(t=Pe.CARD_BACK.path){return new B({map:ye.load(t)})}function qt(t,n,r,e,o,s=null){if(!n||!r||!(o!=null&&o.primary)||!(o!=null&&o.secondary)||(t=Math.floor(Number(t)),isNaN(t)||t<1))return null;const l=T.width*T.size,c=T.height*T.size,m=T.radius*T.size,d=T.radius,h=T.depth*T.size,g=new rt;g.moveTo(0,m),g.lineTo(0,c-m),g.quadraticCurveTo(0,c,m,c),g.lineTo(l-m,c),g.quadraticCurveTo(l,c,l,c-m),g.lineTo(l,m),g.quadraticCurveTo(l,0,l-m,0),g.lineTo(m,0),g.quadraticCurveTo(0,0,0,m);const C=new lt;C.moveTo(d,d),C.lineTo(l-d,d),C.lineTo(l-d,c-d),C.lineTo(d,c-d),C.lineTo(d,d),g.holes.push(C);const y={steps:1,depth:h*t,bevelEnabled:!1},b=new ct(g,y),I=new we(b,o.primary),z=new dt(l-2*d,c-2*d,h*t),N=[o.primary,o.primary,o.primary,o.primary,o.primary,e],j=[o.primary,o.primary,o.primary,o.primary,r,e],E=new we(z,N),M=new ut;return I.position.x-=l/2,I.position.y-=c/2,I.position.z-=h*t/2,I.name=F.CARD_FRAME,M.add(I),M.add(E),M.rotateX(Math.PI/2),M.name=n,M.params={...s},M.select=(x=!0)=>{x?I.material=new B({color:"#ea7c01"}):I.material=o.primary},M.hidePicture=(x=!0)=>{E.material=x?N:j},M}const et={type:"change"},Me={type:"start"},tt={type:"end"},pe=new xt,at=new Lt,Xt=Math.cos(70*Gt.DEG2RAD);class Zt extends kt{constructor(n,r){super(),this.object=n,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new v,this.cursor=new v,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.PAN},this.touches={ONE:te.ROTATE,TWO:te.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(a){a.addEventListener("keydown",Re),this._domElementKeyEvents=a},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Re),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(et),e.update(),s=o.NONE},this.update=function(){const a=new v,u=new Ze().setFromUnitVectors(n.up,new v(0,1,0)),f=u.clone().invert(),P=new v,O=new Ze,K=new v,L=2*Math.PI;return function(vt=null){const qe=e.object.position;a.copy(qe).sub(e.target),a.applyQuaternion(u),c.setFromVector3(a),e.autoRotate&&s===o.NONE&&oe(pt(vt)),e.enableDamping?(c.theta+=m.theta*e.dampingFactor,c.phi+=m.phi*e.dampingFactor):(c.theta+=m.theta,c.phi+=m.phi);let Y=e.minAzimuthAngle,W=e.maxAzimuthAngle;isFinite(Y)&&isFinite(W)&&(Y<-Math.PI?Y+=L:Y>Math.PI&&(Y-=L),W<-Math.PI?W+=L:W>Math.PI&&(W-=L),Y<=W?c.theta=Math.max(Y,Math.min(W,c.theta)):c.theta=c.theta>(Y+W)/2?Math.max(Y,c.theta):Math.min(W,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let re=!1;if(e.zoomToCursor&&de||e.object.isOrthographicCamera)c.radius=Se(c.radius);else{const U=c.radius;c.radius=Se(c.radius*d),re=U!=c.radius}if(a.setFromSpherical(c),a.applyQuaternion(f),qe.copy(e.target).add(a),e.object.lookAt(e.target),e.enableDamping===!0?(m.theta*=1-e.dampingFactor,m.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(m.set(0,0,0),h.set(0,0,0)),e.zoomToCursor&&de){let U=null;if(e.object.isPerspectiveCamera){const le=a.length();U=Se(le*d);const he=le-U;e.object.position.addScaledVector(M,he),e.object.updateMatrixWorld(),re=!!he}else if(e.object.isOrthographicCamera){const le=new v(x.x,x.y,0);le.unproject(e.object);const he=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),e.object.updateProjectionMatrix(),re=he!==e.object.zoom;const Xe=new v(x.x,x.y,0);Xe.unproject(e.object),e.object.position.sub(Xe).add(le),e.object.updateMatrixWorld(),U=a.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;U!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(U).add(e.object.position):(pe.origin.copy(e.object.position),pe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(pe.direction))<Xt?n.lookAt(e.target):(at.setFromNormalAndCoplanarPoint(e.object.up,e.target),pe.intersectPlane(at,e.target))))}else if(e.object.isOrthographicCamera){const U=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),U!==e.object.zoom&&(e.object.updateProjectionMatrix(),re=!0)}return d=1,de=!1,re||P.distanceToSquared(e.object.position)>l||8*(1-O.dot(e.object.quaternion))>l||K.distanceToSquared(e.target)>l?(e.dispatchEvent(et),P.copy(e.object.position),O.copy(e.object.quaternion),K.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",$e),e.domElement.removeEventListener("pointerdown",Ye),e.domElement.removeEventListener("pointercancel",se),e.domElement.removeEventListener("wheel",We),e.domElement.removeEventListener("pointermove",Ie),e.domElement.removeEventListener("pointerup",se),e.domElement.getRootNode().removeEventListener("keydown",Ue,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Re),e._domElementKeyEvents=null)};const e=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const l=1e-6,c=new Qe,m=new Qe;let d=1;const h=new v,g=new G,C=new G,y=new G,b=new G,I=new G,z=new G,N=new G,j=new G,E=new G,M=new v,x=new G;let de=!1;const R=[],ie={};let be=!1;function pt(a){return a!==null?2*Math.PI/60*e.autoRotateSpeed*a:2*Math.PI/60/60*e.autoRotateSpeed}function ue(a){const u=Math.abs(a*.01);return Math.pow(.95,e.zoomSpeed*u)}function oe(a){m.theta-=a}function me(a){m.phi-=a}const _e=function(){const a=new v;return function(f,P){a.setFromMatrixColumn(P,0),a.multiplyScalar(-f),h.add(a)}}(),ve=function(){const a=new v;return function(f,P){e.screenSpacePanning===!0?a.setFromMatrixColumn(P,1):(a.setFromMatrixColumn(P,0),a.crossVectors(e.object.up,a)),a.multiplyScalar(f),h.add(a)}}(),J=function(){const a=new v;return function(f,P){const O=e.domElement;if(e.object.isPerspectiveCamera){const K=e.object.position;a.copy(K).sub(e.target);let L=a.length();L*=Math.tan(e.object.fov/2*Math.PI/180),_e(2*f*L/O.clientHeight,e.object.matrix),ve(2*P*L/O.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(_e(f*(e.object.right-e.object.left)/e.object.zoom/O.clientWidth,e.object.matrix),ve(P*(e.object.top-e.object.bottom)/e.object.zoom/O.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function Ee(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d/=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ne(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d*=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Te(a,u){if(!e.zoomToCursor)return;de=!0;const f=e.domElement.getBoundingClientRect(),P=a-f.left,O=u-f.top,K=f.width,L=f.height;x.x=P/K*2-1,x.y=-(O/L)*2+1,M.set(x.x,x.y,1).unproject(e.object).sub(e.object.position).normalize()}function Se(a){return Math.max(e.minDistance,Math.min(e.maxDistance,a))}function xe(a){g.set(a.clientX,a.clientY)}function ft(a){Te(a.clientX,a.clientX),N.set(a.clientX,a.clientY)}function Le(a){b.set(a.clientX,a.clientY)}function gt(a){C.set(a.clientX,a.clientY),y.subVectors(C,g).multiplyScalar(e.rotateSpeed);const u=e.domElement;oe(2*Math.PI*y.x/u.clientHeight),me(2*Math.PI*y.y/u.clientHeight),g.copy(C),e.update()}function yt(a){j.set(a.clientX,a.clientY),E.subVectors(j,N),E.y>0?Ee(ue(E.y)):E.y<0&&Ne(ue(E.y)),N.copy(j),e.update()}function Pt(a){I.set(a.clientX,a.clientY),z.subVectors(I,b).multiplyScalar(e.panSpeed),J(z.x,z.y),b.copy(I),e.update()}function Ct(a){Te(a.clientX,a.clientY),a.deltaY<0?Ne(ue(a.deltaY)):a.deltaY>0&&Ee(ue(a.deltaY)),e.update()}function wt(a){let u=!1;switch(a.code){case e.keys.UP:a.ctrlKey||a.metaKey||a.shiftKey?me(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):J(0,e.keyPanSpeed),u=!0;break;case e.keys.BOTTOM:a.ctrlKey||a.metaKey||a.shiftKey?me(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):J(0,-e.keyPanSpeed),u=!0;break;case e.keys.LEFT:a.ctrlKey||a.metaKey||a.shiftKey?oe(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):J(e.keyPanSpeed,0),u=!0;break;case e.keys.RIGHT:a.ctrlKey||a.metaKey||a.shiftKey?oe(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):J(-e.keyPanSpeed,0),u=!0;break}u&&(a.preventDefault(),e.update())}function ke(a){if(R.length===1)g.set(a.pageX,a.pageY);else{const u=ee(a),f=.5*(a.pageX+u.x),P=.5*(a.pageY+u.y);g.set(f,P)}}function Ge(a){if(R.length===1)b.set(a.pageX,a.pageY);else{const u=ee(a),f=.5*(a.pageX+u.x),P=.5*(a.pageY+u.y);b.set(f,P)}}function ze(a){const u=ee(a),f=a.pageX-u.x,P=a.pageY-u.y,O=Math.sqrt(f*f+P*P);N.set(0,O)}function bt(a){e.enableZoom&&ze(a),e.enablePan&&Ge(a)}function Et(a){e.enableZoom&&ze(a),e.enableRotate&&ke(a)}function je(a){if(R.length==1)C.set(a.pageX,a.pageY);else{const f=ee(a),P=.5*(a.pageX+f.x),O=.5*(a.pageY+f.y);C.set(P,O)}y.subVectors(C,g).multiplyScalar(e.rotateSpeed);const u=e.domElement;oe(2*Math.PI*y.x/u.clientHeight),me(2*Math.PI*y.y/u.clientHeight),g.copy(C)}function Fe(a){if(R.length===1)I.set(a.pageX,a.pageY);else{const u=ee(a),f=.5*(a.pageX+u.x),P=.5*(a.pageY+u.y);I.set(f,P)}z.subVectors(I,b).multiplyScalar(e.panSpeed),J(z.x,z.y),b.copy(I)}function Ve(a){const u=ee(a),f=a.pageX-u.x,P=a.pageY-u.y,O=Math.sqrt(f*f+P*P);j.set(0,O),E.set(0,Math.pow(j.y/N.y,e.zoomSpeed)),Ee(E.y),N.copy(j);const K=(a.pageX+u.x)*.5,L=(a.pageY+u.y)*.5;Te(K,L)}function Tt(a){e.enableZoom&&Ve(a),e.enablePan&&Fe(a)}function St(a){e.enableZoom&&Ve(a),e.enableRotate&&je(a)}function Ye(a){e.enabled!==!1&&(R.length===0&&(e.domElement.setPointerCapture(a.pointerId),e.domElement.addEventListener("pointermove",Ie),e.domElement.addEventListener("pointerup",se)),!_t(a)&&(At(a),a.pointerType==="touch"?Be(a):It(a)))}function Ie(a){e.enabled!==!1&&(a.pointerType==="touch"?Ot(a):Rt(a))}function se(a){switch(Dt(a),R.length){case 0:e.domElement.releasePointerCapture(a.pointerId),e.domElement.removeEventListener("pointermove",Ie),e.domElement.removeEventListener("pointerup",se),e.dispatchEvent(tt),s=o.NONE;break;case 1:const u=R[0],f=ie[u];Be({pointerId:u,pageX:f.x,pageY:f.y});break}}function It(a){let u;switch(a.button){case 0:u=e.mouseButtons.LEFT;break;case 1:u=e.mouseButtons.MIDDLE;break;case 2:u=e.mouseButtons.RIGHT;break;default:u=-1}switch(u){case H.DOLLY:if(e.enableZoom===!1)return;ft(a),s=o.DOLLY;break;case H.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enablePan===!1)return;Le(a),s=o.PAN}else{if(e.enableRotate===!1)return;xe(a),s=o.ROTATE}break;case H.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enableRotate===!1)return;xe(a),s=o.ROTATE}else{if(e.enablePan===!1)return;Le(a),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Me)}function Rt(a){switch(s){case o.ROTATE:if(e.enableRotate===!1)return;gt(a);break;case o.DOLLY:if(e.enableZoom===!1)return;yt(a);break;case o.PAN:if(e.enablePan===!1)return;Pt(a);break}}function We(a){e.enabled===!1||e.enableZoom===!1||s!==o.NONE||(a.preventDefault(),e.dispatchEvent(Me),Ct(Mt(a)),e.dispatchEvent(tt))}function Mt(a){const u=a.deltaMode,f={clientX:a.clientX,clientY:a.clientY,deltaY:a.deltaY};switch(u){case 1:f.deltaY*=16;break;case 2:f.deltaY*=100;break}return a.ctrlKey&&!be&&(f.deltaY*=10),f}function Ue(a){a.key==="Control"&&(be=!0,e.domElement.getRootNode().addEventListener("keyup",He,{passive:!0,capture:!0}))}function He(a){a.key==="Control"&&(be=!1,e.domElement.getRootNode().removeEventListener("keyup",He,{passive:!0,capture:!0}))}function Re(a){e.enabled===!1||e.enablePan===!1||wt(a)}function Be(a){switch(Ke(a),R.length){case 1:switch(e.touches.ONE){case te.ROTATE:if(e.enableRotate===!1)return;ke(a),s=o.TOUCH_ROTATE;break;case te.PAN:if(e.enablePan===!1)return;Ge(a),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(e.touches.TWO){case te.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;bt(a),s=o.TOUCH_DOLLY_PAN;break;case te.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Et(a),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Me)}function Ot(a){switch(Ke(a),s){case o.TOUCH_ROTATE:if(e.enableRotate===!1)return;je(a),e.update();break;case o.TOUCH_PAN:if(e.enablePan===!1)return;Fe(a),e.update();break;case o.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Tt(a),e.update();break;case o.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;St(a),e.update();break;default:s=o.NONE}}function $e(a){e.enabled!==!1&&a.preventDefault()}function At(a){R.push(a.pointerId)}function Dt(a){delete ie[a.pointerId];for(let u=0;u<R.length;u++)if(R[u]==a.pointerId){R.splice(u,1);return}}function _t(a){for(let u=0;u<R.length;u++)if(R[u]==a.pointerId)return!0;return!1}function Ke(a){let u=ie[a.pointerId];u===void 0&&(u=new G,ie[a.pointerId]=u),u.set(a.pageX,a.pageY)}function ee(a){const u=a.pointerId===R[0]?R[1]:R[0];return ie[u]}e.domElement.addEventListener("contextmenu",$e),e.domElement.addEventListener("pointerdown",Ye),e.domElement.addEventListener("pointercancel",se),e.domElement.addEventListener("wheel",We,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Ue,{passive:!0,capture:!0}),this.update()}}var Qt={add:Jt};function Jt(t,n){const r=new Zt(t,n.domElement);return r.enableDamping=!0,r.dampingFactor=.05,r.screenSpacePanning=!0,r.enablePan=!1,r.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.ROTATE},r.enableZoom=!0,r.minDistance=300,r.maxDistance=3e3,r.minPolarAngle=-1,r.maxPolarAngle=Math.PI/2.01,r}var w={moveCardVertically:ea,moveCard:ta,rotateCardTo:aa,rotateCardBy:na,moveCardTo:ia};async function ea(t,n=i().animate.stepSize,r=S.tableConfig.height+150){const e=Math.sign(r-t.position.y);n||(n=i().animate.stepSize),n*=i().speed;let o=null;return new Promise(s=>{const l=()=>{if(i().state===p.NO_GAME){o&&cancelAnimationFrame(o),s(!1);return}if(Math.abs(t.position.y-r)<=n){t.position.y=r,s(!0);return}t.position.y+=e*n,o=requestAnimationFrame(l)};l()})}async function ta(t,n=100,r=Math.PI,e=i().animate.stepSize){e*=i().speed;let o=0;const s=Z.vector(r,e);let l=null;return new Promise(c=>{const m=()=>{if(n-o<=e){c(!0);return}if(t.position.x+=s.x,t.position.z+=s.z,o+=e,i().state===p.NO_GAME){l&&cancelAnimationFrame(l),c(!1);return}l=requestAnimationFrame(m)};m()})}async function aa(t,n=null,r=null,e=null){const o=i().animate.angleSize*i().speed,s=Math.sign(1/n),l=Math.sign(1/e),c=Math.sign(1/r);let m=null;return new Promise(d=>{const h=()=>{if(n!=null&&Math.abs(n-t.rotation.x)<=o?t.rotation.x+=o*s:n!=null&&(t.rotation.x=n,n=null),r!=null&&Math.abs(r-t.rotation.y)<=o?t.rotation.y+=o*c:r!=null&&(t.rotation.y=r,r=null),e!=null&&Math.abs(e-t.rotation.z)<=o?t.rotation.z+=o*l:e!=null&&(t.rotation.z=e,e=null),n===null&&r===null&&e===null){d(!0);return}if(i().state===p.NO_GAME){m&&cancelAnimationFrame(m),d(!1);return}m=requestAnimationFrame(h)};h()})}async function na(t,n=null,r=null,e=null){const o=i().animate.angleSize*i().speed,s=n?Math.abs(Math.ceil(n/o)):null,l=r?Math.abs(Math.ceil(r/o)):null,c=e?Math.abs(Math.ceil(e/o)):null;let m=0,d=null;return new Promise(h=>{const g=()=>{if(s&&s>m&&t.rotateX(n/s),l&&l>m&&t.rotateY(r/l),c&&c>m&&t.rotateZ(e/c),Math.max(s,c,l)===m){h(!0);return}if(m++,i().state===p.NO_GAME){d&&cancelAnimationFrame(d),h(!1);return}d=requestAnimationFrame(g)};g()})}async function ia(t,n={x:0,z:0},r=null,e=i().animate.stepSize){n.x=Z.round(n.x),n.z=Z.round(n.z),e*=i().speed;let o=i().animate.angleSize*i().speed;const s=t.position;let l=0;const c=Math.atan2(n.z-s.z,n.x-s.x),m=Z.vector(c,e),d=Z.distance(s.x,n.x,s.z,n.z);let h=null;return new Promise(g=>{const C=()=>{const y=d-l;if(y<=e?(t.position.x=n.x,t.position.z=n.z,l=d):(t.position.x+=m.x,t.position.z+=m.z,l+=e),r!==null){const b=r-t.rotation.z;Math.abs(b)<=o?(t.rotation.z=r,r=null):t.rotation.z+=Math.sign(b)*o}if(y<=e&&r===null){g(!0);return}if(i().state===p.NO_GAME){h&&cancelAnimationFrame(h),g(!1);return}h=requestAnimationFrame(C)};C()})}var k=Object.freeze({DRAW_TO_DISCARD:"DRAW_TO_DISCARD",DRAW_TO_PLAYER:"DRAW_TO_PLAYER",PLAYER_TO_DISCARD:"PLAYER_TO_DISCARD",NOT_PLAY:"NOT_PLAY",GAME_OVER:"GAME_OVER"});const oa={name:"SuitSelectDialog",props:{modelValue:{type:Boolean,default:!1},items:{type:Array,default:()=>[]}},data:()=>({}),computed:{modelValueComp:{get(){return this.modelValue},set(t){this.$emit("update:model-value",t)}},itemSelected(){return!!this.items.filter(t=>t.selected).length}},methods:{handleClick(t){if(!t.selected){this.items.forEach(n=>n.selected=!1),t.selected=!0;return}this.$emit("select",t.name),this.$emit("update:model-value",!1)}}},sa={class:"text-h6"};function ra(t,n,r,e,o,s){return D(),ce(ot,{modelValue:s.modelValueComp,"onUpdate:modelValue":n[0]||(n[0]=l=>s.modelValueComp=l),persistent:""},{default:$(()=>[_(it,null,{default:$(()=>[_(Ce,null,{default:$(()=>[Q("div",sa,"Vyberte barvu "+q(s.itemSelected?"(vyberte znovu pro potvrzen\xED)":""),1)]),_:1}),_(Ce,{class:"fp-row"},{default:$(()=>[(D(!0),V(ht,null,mt(r.items,(l,c)=>(D(),ce(Ae,{key:c,src:l.image,style:ge(`width: 200px; border: solid 3px ${l.selected?"red":"white"};`),onClick:m=>s.handleClick(l)},null,8,["src","style","onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var la=De(oa,[["render",ra]]);const ca={name:"GameOverDialog",props:{modelValue:{type:Boolean,default:!1},playerId:{type:Number,default:null}},data:()=>({}),computed:{valueComp:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},player(){return this.playerId?i().players.find(t=>t.id===this.playerId):{}}},methods:{startGame(){i().setGameState(p.START_GAME)},stopGame(){i().setGameState(p.NO_GAME)},restartGame(){this.stopGame(),this.$nextTick(()=>this.startGame()),this.close()},close(){this.$emit("update:modelValue",!1)}}},da=Q("span",{style:{"font-size":"14pt","font-weight":"bold"}},"Vyhr\xE1l:",-1),ua={style:{"font-size":"28pt","font-weight":"bold",color:"#0d47a1"}},ma=Q("br",null,null,-1);function ha(t,n,r,e,o,s){return D(),ce(ot,{modelValue:s.valueComp,"onUpdate:modelValue":n[0]||(n[0]=l=>s.valueComp=l),persistent:""},{default:$(()=>[_(it,null,{default:$(()=>[_(Ce,null,{default:$(()=>[da]),_:1}),_(Ce,null,{default:$(()=>{var l,c;return[Q("span",ua,q((l=s.player)==null?void 0:l.name),1),ma,(c=s.player)!=null&&c.avatar?(D(),ce(Ae,{key:0,src:s.player.avatar,style:{"margin-left":"10px",width:"350px","border-radius":"5px"}},null,8,["src"])):X("",!0)]}),_:1}),_(Nt,{align:"right",class:"text-primary"},{default:$(()=>[_(ne,{style:{margin:"auto"},color:"orange",label:t.$t("zavrit"),onClick:s.close},null,8,["label","onClick"]),_(ne,{style:{margin:"auto"},color:"secondary",label:t.$t("hra_restart"),onClick:s.restartGame},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var pa=De(ca,[["render",ha]]);const nt=new zt,Oe=new G,fa=Vt({name:"GamePage",components:{GameOverDialog:pa,SuitSelectDialog:la},data:()=>({suits:[],itemsSelectSuits:[],showSelectSuit:!1,computerStopBtn:!1,showGameOverDialog:!1,winnerId:null,gameContainerWidth:0,gameContainerHeight:0,camera:null,renderer:null,scene:null,drawPileObject:null,materials:{cardFrame:{primary:null,secondary:null},cardBack:null,table:null,sky:null,grass:null},cameraView:{PLAYER:"player",TABLE:"table"},playerSelectObject:null,timeouts:[],axiosCancelTokenStoreName:"game"}),computed:{loading(){return i().state===p.LOADING},showMenu(){return ae().showMenu},showStausBar(){return!1},players(){return i().players.length},activePlayer(){return i().players.find(t=>t.id===i().activePlayerId)},gameWarning(){return i().warning},gameInfo(){return i().info},hasMoreMoves(){var t;return i().activePlayerId?!(i().lastPlayerMove===k.PLAYER_TO_DISCARD||i().lastPlayerMove===k.NOT_PLAY||i().lastPlayerMove===k.DRAW_TO_PLAYER&&((t=i().rules)==null?void 0:t.numberOfCardsToDraw)===0):!0},lastMove(){return i().lastPlayerMove},showStopBtn(){var l,c,m,d;const t=i().discardPileCardsIds,n=t[t.length-1],r=(m=(c=(l=i())==null?void 0:l.gameCards)==null?void 0:c.find(h=>h.params.cardId===n))==null?void 0:m.params,e=(r==null?void 0:r.power)==="GET"&&(r==null?void 0:r.powerValue)===0,o=((d=i().rules)==null?void 0:d.numberOfCardsToDraw)>0;return p.PLAYER_TURN===i().state&&e&&!o},showSuits(){var e,o,s,l;if(!((e=i().gameCards)!=null&&e.length))return[];if(!((o=i().discardPileCardsIds)!=null&&o.length))return[];const t=i().discardPileCardsIds,n=t[t.length-1];return((s=i().gameCards.find(c=>c.params.cardId===n).params)==null?void 0:s.power)!=="SELECT_SUIT"?[]:(l=i().rules)!=null&&l.suit?this.suits.filter(c=>c.name===i().rules.suit):this.suits},mainPlayer(){const t=i().players.find(n=>n.id===Yt().id);return t||{}},isGameActive(){return i().state!==p.NO_GAME}},methods:{async startGame(){const t=i().settings;this.resetGame(),i().setGameState(p.LOADING),this.materials.cardFrame.primary=A.createColoredMaterial("#000000"),this.materials.cardFrame.secondary=A.createColoredMaterial("#fb8d3c"),this.materials.cardBack=A.createFromUrlMaterial(Pe.CARD_BACK.path),i().gameCards=await this.getDrawCardPileFromServer(t.cardGroupId);const n=await this.getNewGameFromServer(t);if(!n){this.resetGame();return}i().setPiles(n),i().setPlayers(n.players),i().setGameState(p.DEAL_CARDS),this.createDrawPile(),await this.dealCards(n.movesList),i().setFromState(n),i().setActivePlayerById(n.nextPLayerId)},async dealCards(t){const n=t.map((r,e)=>new Promise(o=>{const s=setTimeout(async()=>{await this.executeMove(r),o()},e*500/i().speed);this.timeouts.push(s)}));await Promise.all(n)},async executeMove(t,n){var r,e;switch(t.type){case k.DRAW_TO_DISCARD:n=await this.getDrawPileCard(null,!0),await this.moveToDiscardPile(n)||i().setGameState(p.ERROR);return;case k.DRAW_TO_PLAYER:const s=i().rules;if(!s){await this.getDrawPileCard(this.getPlayer(t.to));return}if(s.numberOfCardsToDraw===0){i().setWarning("Nepovolen\xFD tah");return}else if(s.numberOfCardsToDraw--,s.permittedCardIdsOnDiscardPile=[],s.numberOfCardsToDraw===0&&i().setGameState(this.activePlayer===this.mainPlayer?p.PLAYER_TURN_PROCESSING:p.COMPUTER_TURN_PROCESSING,!1),await this.getDrawPileCard(this.getPlayer(t.to)),await this.shuffleIfNeeded(),s.numberOfCardsToDraw>0){this.activePlayer===this.mainPlayer&&this.executeMove(t);return}break;case k.PLAYER_TO_DISCARD:const l=this.getPlayer(t.from);if(this.mainPlayer!==l)i().setGameState(p.COMPUTER_TURN_PROCESSING,!1),n=i().gameCards.find(c=>c.params.cardId===t.cardId),t.newSuit&&(i().rules.suit=t.newSuit),await this.moveToDiscardPile(n,l);else if((((r=i().rules)==null?void 0:r.permittedCardIdsOnDiscardPile)||[]).includes(n.params.cardId))i().setGameState(p.PLAYER_TURN_PROCESSING),await this.moveToDiscardPile(n,l);else{i().setWarning("Nepovolen\xFD tah");return}break;case k.NOT_PLAY:this.activePlayer===this.mainPlayer?i().setGameState(p.PLAYER_TURN_PROCESSING):(this.computerStopBtn=!0,await this.sleep(1e3/i().speed),this.computerStopBtn=!1,i().setGameState(p.COMPUTER_TURN_PROCESSING,!1));break}i().lastPlayerMove=t.type,i().state===p.COMPUTER_TURN_PROCESSING&&this.getNextPlayerActions(),i().state===p.PLAYER_TURN_PROCESSING&&(t.type===k.PLAYER_TO_DISCARD&&((e=n==null?void 0:n.params)==null?void 0:e.power)==="SELECT_SUIT"?this.openSelectSuitDialog():this.getNextPlayerActions())},async shuffleIfNeeded(){if(i().drawPileCardsIds.length===0){const t=[],n=i().discardPileCardsIds,r=n[n.length-1],e=n.slice(0,-1);for(const s of e){const l=i().gameCards.find(c=>c.params.cardId===s);await w.moveCard(l,fe.card.height*1.1),await w.moveCardVertically(l,void 0,S.tableConfig.height+75+t.length),await w.rotateCardTo(l,Math.PI/2,0,0),l.hidePicture(!0),await w.moveCardVertically(l,void 0,S.tableConfig.height+150+t.length),t.push(l)}if(t.length>2)for(let s=0;s<50;s++){const l=Math.floor(Math.random()*t.length),c=t[l];await w.moveCard(c,100,void 0,15),await w.moveCardVertically(c,15,S.tableConfig.height+150+t.length+s),await w.moveCard(c,100,2*Math.PI,15);for(let m=0;m<t.length;m++){const d=t[m];await w.moveCardVertically(d,15,S.tableConfig.height+150+t.length+m)}}for(let s=0;s<t.length;s++){const l=t[s];await w.moveCardTo(l,fe.animate.drawPilePosition,void 0,15),await w.moveCardVertically(l,15,S.tableConfig.height+s*.5),i().drawPileCardsIds.push(l.params.cardId),this.scene.remove(l),this.scene.remove(this.drawPileObject),this.createDrawPile()}i().drawPileCardsIds=this.shuffleArray(e),i().discardPileCardsIds=[r];const o=i().gameCards.find(s=>s.params.cardId===r);await w.moveCardVertically(o,15,S.tableConfig.height+fe.card.depth)}},shuffleArray(t){for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t},createDrawPile(){const t=i().drawPileCardsIds.length,n=A.createCardFromMaterials(t,F.DROW_PILE,this.materials.cardFrame,this.materials.cardBack,this.materials.cardFrame,{selectable:!0});n&&(n.position.y=S.tableConfig.height+(t+1)*A.config.depth,n.position.x=i().animate.drawPilePosition.x,n.position.z=i().animate.drawPilePosition.z,this.scene.add(n)),this.drawPileObject=n},handleMouseClickOnCard(t){var e;const n=i().players[0];if(n.id!==i().activePlayerId||!((e=t==null?void 0:t.params)!=null&&e.selectable))return;if(!this.playerSelectObject||this.playerSelectObject&&this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect();const r=t.params.cardId;n.cardInHandIds.includes(r)&&this.executeMove({type:k.PLAYER_TO_DISCARD,from:n.id},t)},handleMouseClickOnDrawPile(t){if(i().players[0].id===i().activePlayerId){if(!this.playerSelectObject||this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect(),this.executeMove({type:k.DRAW_TO_PLAYER,to:this.mainPlayer.id})}},getPlayer(t){return i().players.find(n=>n.id===t)},clearPlayerSelect(){const t=this.playerSelectObject;!t||(t.select&&t.select(!1),this.playerSelectObject=null)},async addCardToHand(t,n,r=i().animate.cardAngleView){const e=Math.abs(Math.ceil(r/(i().animate.angleSize*i().speed)));let o=0,s=null;return new Promise(l=>{const c=async()=>{if(o<e)t.rotateX(r/e),o++;else{n.cardInHandIds.push(t.params.cardId);const m=i().animate.maxCardsPerRow;let d=(n.cardInHandIds.length-1)%m+1,h=Math.floor((n.cardInHandIds.length-1)/m);switch(h){case 0:h=1;break;case 1:h=0;break;case 2:break;default:h=-h+2}if(h*=i().animate.cardOverlap,h-=1,d-1){const g=n.point,C=d%2===0?n.angle-Math.PI/2:n.angle+Math.PI/2,y=Z.vector(C,(A.config.width*2+10)*Math.floor(d/2));if(y.x+=g.x,y.z+=g.z,!await w.moveCardTo(t,y)){l(!1);return}}if(!await w.moveCardVertically(t,void 0,S.tableConfig.height-h*A.config.height)){l(!1);return}if(!await w.moveCard(t,A.config.height*Math.abs(h),Math.sign(h)*n.angle)){l(!1);return}l(!0);return}if(i().state===p.NO_GAME){s&&cancelAnimationFrame(s),l(!1);return}s=requestAnimationFrame(c)};c()})},async moveToDiscardPile(t,n){if(!t)return!1;t.params.selectable=!1,t.hidePicture(!1);const r=t.params.cardId,e=S.tableConfig.height+i().discardPileCardsIds.length*A.config.depth*4,o=i().animate.discardPilePosition,s={...t.position};i().discardPileCardsIds.push(r);let l=null,c=!0;if(n){const d=n.cardInHandIds,h=d.findIndex(C=>C===r),g=d.length-1;h!==g&&(l=i().gameCards.find(C=>C.params.cardId===d[g]),d.splice(h,1,l.params.cardId),c=!1),d.pop()}const m=async()=>{await w.moveCardVertically(l,void 0,s.y),await w.moveCardTo(l,{x:s.x,z:s.z})};return new Promise(async d=>{let h=await w.moveCardVertically(t);c||m(),h&&(h=await w.rotateCardBy(t,Math.PI/2+i().animate.cardAngleView)),h&&(h=await w.moveCardTo(t,o));const g=Z.round(Math.random()*2*Math.PI);if(h&&(h=await w.rotateCardTo(t,-Math.PI/2,0,g)),h&&(h=await w.moveCardVertically(t,void 0,e)),!h){i().setGameState(p.ERROR),d(!1);return}t.params.selectable=!0,d(!0)})},async getDrawPileCard(t,n){const r=i().drawPileCardsIds.length;if(!r)return i().setGameState(p.ERROR),!1;const e=i().drawPileCardsIds[0],o=i().gameCards.find(c=>c.params.cardId===e);i().drawPileCardsIds=i().drawPileCardsIds.slice(1),o.params.selectable=!1,o.hidePicture(!(t!=null&&t.main));const s=this.drawPileObject,l={x:s.position.x,z:s.position.z};if(o.position.y=S.tableConfig.height+r*2*A.config.depth,o.position.x=l.x,o.position.z=l.z,this.scene.add(o),this.scene.remove(s),this.createDrawPile(l.x,l.z),!await w.moveCardVertically(o))return!1;if(n)return o.params.selectable=!0,o;if(!await w.moveCardTo(o,t.point,-Math.PI/2+t.angle))return!1;await this.addCardToHand(o,t),o.params.selectable=!0},showNextPlayerNameBeforeServerResponse(){let t=i().players.findIndex(e=>e.id===i().activePlayerId)+1;const n=i().players.length,r=i().players[t%n];return this.mainPlayer!==r&&i().setInfo("Hraje "+r.name),r.id},addListeners(){window.addEventListener("resize",this.handleChangeWindowSize.bind(this)),this.$refs.gameContainer.addEventListener("click",this.onMouseClick),this.$refs.gameContainer.addEventListener("dblclick",this.onMouseDoubleClick)},removeListeners(){window.removeEventListener("resize",this.handleChangeWindowSize),this.$refs.gameContainer.removeEventListener("click",this.onMouseClick),this.$refs.gameContainer.removeEventListener("dblclick",this.onMouseDoubleClick)},resetScene(){const t=[F.CARD,F.DROW_PILE,F.DISCARD_PILE,F.TABLE],n=this.scene;n.children.filter(o=>t.includes(o.name)).forEach(o=>{n.remove(o)});const e=S.createTable(this.materials.table);e&&this.scene.add(e)},resetGame(){this.resetScene(),i().reset(),this.timeouts.forEach(clearTimeout);const t=ae().axiosRequests[this.axiosCancelTokenStoreName];t!=null&&t.length&&t.forEach(n=>{n.cancel&&n.cancel()}),this.timeouts=[]},initWebGL(){this.materials.table=S.createTableMaterial();const t=this.$refs.gameContainer,n=t.clientWidth,r=t.clientHeight,e=new jt({antialias:!0});e.setSize(n,r),t.appendChild(e.domElement);const o=new Ft(75,n/r,1,1e4);o.lookAt(0,S.tableConfig.height+A.config.height*3,0);const s=Qt.add(o,e),l=S.create(),c=S.createTable(this.materials.table);c&&l.add(c);const m=()=>{requestAnimationFrame(m),s.update(),e.render(l,o)};this.scene=l,this.renderer=e,this.camera=o,this.gameContainerWidth=n,this.gameContainerHeight=r,this.changeCameraView(this.cameraView.PLAYER),m()},changeCameraView(t){t||(t=i().cameraView);const n=this.camera,r=this.cameraView,e=this.mainPlayer.point||{x:0,z:S.tableConfig.radius};switch(t){case null:case r.PLAYER:n.position.set(0,S.tableConfig.height*2+A.config.height*2.5,e.z*1.05+A.config.height*1.5);break;case r.TABLE:n.position.set(0,e.z*1.3,e.z*.5);break}i().cameraView=t},handleChangePlayers(){this.resetScene()},handleChangeWindowSize(){const t=this.$refs.gameContainer,n=t.clientWidth,r=t.clientHeight;this.fitGameContainerToSize(n,r)},handleSuitSelect(t){i().rules.suit=t,this.getNextPlayerActions()},handleNotPlay(){this.executeMove({type:k.NOT_PLAY})},openSelectSuitDialog(){this.$get("prsi/suits",{groupId:i().settings.cardGroupId}).then(t=>{this.itemsSelectSuits=[],t.forEach(n=>{n.image.startsWith("data:image")||(n.image="data:"+n.imageType+";base64,"+n.image)}),this.itemsSelectSuits=t,this.showSelectSuit=!0})},onMouseClick(t){var o,s;if(t.stopPropagation(),i().state===p.LOADING||i().state===p.DEAL_CARDS||i().state===p.WAITING_FOR_SERVER||i().state===p.PLAYER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na dokon\u010Den\xED akce");return}if(i().state===p.COMPUTER_TURN||i().state===p.COMPUTER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na tah protihr\xE1\u010De");return}const r=this.$refs.gameContainer.getBoundingClientRect();Oe.x=(t.clientX-r.left)/r.width*2-1,Oe.y=-((t.clientY-r.top)/r.height)*2+1,nt.setFromCamera(Oe,this.camera);const e=nt.intersectObjects(this.scene.children);switch((s=(o=e[0].object)==null?void 0:o.parent)==null?void 0:s.name){case F.CARD:this.handleMouseClickOnCard(e[0].object.parent);return;case F.DROW_PILE:this.handleMouseClickOnDrawPile(e[0].object.parent);return}this.playerSelectObject&&this.clearPlayerSelect()},handleSwitchMenu(){window.innerWidth<ae().minimumViewPort||(ae().showMenu?setTimeout(()=>{this.fitGameContainerToSize(this.gameContainerWidth-ae().menuWidth)},200):this.fitGameContainerToSize(this.gameContainerWidth+ae().menuWidth))},fitGameContainerToSize(t,n){n==null&&(n=this.gameContainerHeight),t==null&&(t=this.gameContainerWidth),this.camera.aspect=t/n,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,n),this.gameContainerWidth=t,this.gameContainerHeight=n},clearAll(){this.resetScene(),this.scene=null,this.renderer=null,this.camera=null,this.gameContainerWidth=null,this.gameContainerHeight=null},gameOver(t){console.log("ukon\u010Dit hru"),console.log(t),i().activePlayerId=null,i().setGameState(p.GAME_OVER),this.showGameOverDialog=!0,this.winnerId=t.to},async getDrawCardPileFromServer(t){this.$get("prsi/suits",{groupId:i().settings.cardGroupId},!1,this.axiosCancelTokenStoreName).then(e=>{e&&(e.forEach(o=>{o.image.startsWith("data:image")||(o.image="data:"+o.imageType+";base64,"+o.image)}),this.suits=e)});const n=[],r=await this.$get("prsi/all_cards",{groupId:t},!1,this.axiosCancelTokenStoreName);if(r!==null)return r.forEach(e=>{n.push(A.createCardFromMaterials(1,F.CARD,A.createTexturedMaterial(e.face),this.materials.cardBack,this.materials.cardFrame,{cardId:e.id,selectable:!0,face:e.face,power:e.power,powerValue:e.powerValue})),delete e.face}),n},async getNewGameFromServer(t){return await this.$post("prsi/start",t,!1,this.axiosCancelTokenStoreName)},async getNextPlayerActions(){if(i().state===p.NO_GAME)return;const t={stateId:i().stateId,players:i().players.map(e=>({id:e.id,cardIds:e.cardInHandIds})),drawPile:i().drawPileCardsIds,discardPile:i().discardPileCardsIds,rules:i().rules,lastMove:i().lastPlayerMove,lastMoveBy:i().activePlayerId},n=this.showNextPlayerNameBeforeServerResponse();i().setGameState(p.WAITING_FOR_SERVER);const r=await this.$post("prsi/next",t,!1,this.axiosCancelTokenStoreName);i().activePlayerId=n,i().setGameState(this.mainPlayer===this.activePlayer?p.PLAYER_TURN:p.COMPUTER_TURN,this.mainPlayer===this.activePlayer),i().setFromState(r);for(const e of r.movesList){if(e.type===k.GAME_OVER){this.gameOver(e);return}await this.executeMove(e),await this.sleep(500)}},async sleep(t){return new Promise(n=>setTimeout(n,t))}},mounted(){this.initWebGL(),this.addListeners()},beforeUnmount(){this.removeListeners(),this.clearAll()},watch:{showMenu(){this.handleSwitchMenu()},players(){this.handleChangePlayers()},isGameActive(){i().state===p.START_GAME&&this.startGame(),i().state===p.NO_GAME&&this.resetGame()}}}),ga=t=>(Wt("data-v-56f4c8e7"),t=t(),Ut(),t),ya={class:"height-100 width-100 fp-column game-page",ref:"gamePage"},Pa={key:0,class:"overlay"},Ca=ga(()=>Q("span",{class:"overlay-text"},"Na\u010D\xEDt\xE1n\xED hry",-1)),wa=[Ca],ba={id:"gameContainer",ref:"gameContainer",class:"game-container"},Ea={key:1,class:"game-statusbar non-selectable"},Ta={class:"fp-column",style:{position:"absolute",right:"3px"}},Sa={key:2,class:"non-selectable width-100 page-info"},Ia={key:3,class:"non-selectable width-100 page-warning"};function Ra(t,n,r,e,o,s){var m;const l=Je("suit-select-dialog"),c=Je("game-over-dialog");return D(),V("div",ya,[t.loading?(D(),V("div",Pa,wa)):X("",!0),Q("div",ba,null,512),t.showStausBar?(D(),V("div",Ea," hr\xE1\u010D\u016F: "+q(t.players)+", hr\xE1\u010D: "+q((m=t.activePlayer)==null?void 0:m.name)+", existuje tah: "+q(t.hasMoreMoves)+", posledn\xED tah: "+q(t.lastMove)+", ",1)):X("",!0),Q("div",Ta,[_(ne,{style:{margin:"3px","z-index":"10"},icon:"panorama",color:"accent",title:"Zobrazit pohled hr\xE1\u010De",onClick:n[0]||(n[0]=d=>t.changeCameraView(t.cameraView.PLAYER))}),_(ne,{style:{margin:"3px","z-index":"10"},icon:"visibility",color:"accent",title:"N\xE1hled na hern\xED st\u016Fl",onClick:n[1]||(n[1]=d=>t.changeCameraView(t.cameraView.TABLE))})]),!t.gameWarning&&t.gameInfo?(D(),V("div",Sa,q(t.gameInfo),1)):X("",!0),t.gameWarning?(D(),V("div",Ia,q(t.gameWarning),1)):X("",!0),t.computerStopBtn?(D(),V("div",{key:4,style:ge(`position: absolute; left: ${t.gameContainerWidth/2-50}px; top: ${t.gameContainerHeight/3-50}px`)},[_(ne,{icon:"front_hand",color:"red",title:"St\xE1t",style:{width:"100px",height:"100px"},class:"page-warning",onClick:n[2]||(n[2]=d=>t.handleNotPlay())})],4)):X("",!0),t.showStopBtn?(D(),V("div",{key:5,style:ge(`position: absolute; left: ${t.gameContainerWidth/2-50}px; bottom: 100px`)},[_(ne,{icon:"front_hand",color:"accent",title:"St\xE1t",style:{margin:"3px"},class:"page-warning",onClick:n[3]||(n[3]=d=>t.handleNotPlay())})],4)):t.showSuits.length?(D(),V("div",{key:6,style:ge(`position: absolute; left: ${t.gameContainerWidth/2-t.showSuits.length*27}px; bottom: 30px`)},[(D(!0),V(ht,null,mt(t.showSuits,(d,h)=>(D(),ce(Ae,{key:h,src:d.image,style:{width:"50px",margin:"4px"}},null,8,["src"]))),128))],4)):X("",!0),_(l,{modelValue:t.showSelectSuit,"onUpdate:modelValue":n[4]||(n[4]=d=>t.showSelectSuit=d),items:t.itemsSelectSuits,onSelect:t.handleSuitSelect},null,8,["modelValue","items","onSelect"]),_(c,{modelValue:t.showGameOverDialog,"onUpdate:modelValue":n[5]||(n[5]=d=>t.showGameOverDialog=d),"player-id":t.winnerId},null,8,["modelValue","player-id"])],512)}var Na=De(fa,[["render",Ra],["__scopeId","data-v-56f4c8e7"]]);export{Na as default};
