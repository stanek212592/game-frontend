import{g as ie}from"./QBtn.5cb6fc9d.js";import{t as we,l as be,Q as _e,n as ot,o as rt,m as Gt}from"./imagesEnum.5c37614f.js";import{T as lt,b as ge,S as ct,P as dt,E as ut,M as B,c as Ee,B as mt,G as ht,e as F,R as zt,d as jt,f as Ft,V as v,h as H,i as ae,Q as Je,j as et,k as G,l as Yt,g as i,m as T,u as Q,a as g,n as Vt,W as Wt,o as Ut}from"./game.d0cdf690.js";import{_ as ve,O as A,W as de,X as $,f as D,R as J,Z as q,Q as Y,ak as pt,a0 as ye,F as ft,$ as X,d as Ht,k as ne,u as Bt,a7 as tt,a1 as $t,a2 as Kt}from"./index.38f5faef.js";const E=ge.card;var O={config:E,createCard:qt,createTexturedMaterial:Xt,createColoredMaterial:Zt,createFromUrlMaterial:Qt,createCardFromMaterials:Jt};const Pe=new lt;function qt(t,n=F.DROW_PILE,r=null,e=null){if(t=Math.floor(Number(t)),isNaN(t)||t<1)return null;const s=E.width*E.size,o=E.height*E.size,l=E.radius*E.size,c=E.radius,u=E.depth*E.size,d=new ct;d.moveTo(0,l),d.lineTo(0,o-l),d.quadraticCurveTo(0,o,l,o),d.lineTo(s-l,o),d.quadraticCurveTo(s,o,s,o-l),d.lineTo(s,l),d.quadraticCurveTo(s,0,s-l,0),d.lineTo(l,0),d.quadraticCurveTo(0,0,0,l);const h=new dt;h.moveTo(c,c),h.lineTo(s-c,c),h.lineTo(s-c,o-c),h.lineTo(c,o-c),h.lineTo(c,c),d.holes.push(h);const f={steps:1,depth:u*t,bevelEnabled:!1},p=new ut(d,f),P=new B({color:"#000000"}),w=new Ee(p,P),S=new mt(s-2*c,o-2*c,u*t),z=[P,P,P,P,P,new B({map:Pe.load(we.CARD_BACK.path)})],L=r?[P,P,P,P,new B({map:Pe.load(r.path)}),new B({map:Pe.load(we.CARD_BACK.path)})]:null,j=new Ee(S,r?L:z),b=new ht;return w.position.x-=s/2,w.position.y-=o/2,w.position.z-=u*t/2,w.name=F.CARD_FRAME,b.add(w),b.add(j),b.rotateX(Math.PI/2),b.name=n,b.params={...e},b.select=(R=!0)=>{R?w.material=new B({color:"#ea7c01"}):w.material=P},r&&(b.hidePicture=(R=!0)=>{j.material=R?z:L}),b}function Xt(t){const n=new lt().load("data:image/jpeg;base64,"+t);return new B({map:n})}function Zt(t){return new B({color:t})}function Qt(t=we.CARD_BACK.path){return new B({map:Pe.load(t)})}function Jt(t,n,r,e,s,o=null){if(!n||!r||!(s!=null&&s.primary)||!(s!=null&&s.secondary)||(t=Math.floor(Number(t)),isNaN(t)||t<1))return null;const l=E.width*E.size,c=E.height*E.size,u=E.radius*E.size,d=E.radius,h=E.depth*E.size,f=new ct;f.moveTo(0,u),f.lineTo(0,c-u),f.quadraticCurveTo(0,c,u,c),f.lineTo(l-u,c),f.quadraticCurveTo(l,c,l,c-u),f.lineTo(l,u),f.quadraticCurveTo(l,0,l-u,0),f.lineTo(u,0),f.quadraticCurveTo(0,0,0,u);const p=new dt;p.moveTo(d,d),p.lineTo(l-d,d),p.lineTo(l-d,c-d),p.lineTo(d,c-d),p.lineTo(d,d),f.holes.push(p);const P={steps:1,depth:h*t,bevelEnabled:!1},w=new ut(f,P),S=new Ee(w,s.primary),z=new mt(l-2*d,c-2*d,h*t),L=[s.primary,s.primary,s.primary,s.primary,s.primary,e],j=[s.primary,s.primary,s.primary,s.primary,r,e],b=new Ee(z,L),R=new ht;return S.position.x-=l/2,S.position.y-=c/2,S.position.z-=h*t/2,S.name=F.CARD_FRAME,R.add(S),R.add(b),R.rotateX(Math.PI/2),R.name=n,R.params={...o},R.select=(x=!0)=>{x?S.material=new B({color:"#ea7c01"}):S.material=s.primary},R.hidePicture=(x=!0)=>{b.material=x?L:j},R}const at={type:"change"},Ae={type:"start"},nt={type:"end"},fe=new zt,it=new jt,ea=Math.cos(70*Yt.DEG2RAD);class ta extends Ft{constructor(n,r){super(),this.object=n,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new v,this.cursor=new v,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.PAN},this.touches={ONE:ae.ROTATE,TWO:ae.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(a){a.addEventListener("keydown",Oe),this._domElementKeyEvents=a},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Oe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(at),e.update(),o=s.NONE},this.update=function(){const a=new v,m=new Je().setFromUnitVectors(n.up,new v(0,1,0)),y=m.clone().invert(),C=new v,M=new Je,K=new v,k=2*Math.PI;return function(kt=null){const Ze=e.object.position;a.copy(Ze).sub(e.target),a.applyQuaternion(m),c.setFromVector3(a),e.autoRotate&&o===s.NONE&&oe(Pt(kt)),e.enableDamping?(c.theta+=u.theta*e.dampingFactor,c.phi+=u.phi*e.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let V=e.minAzimuthAngle,W=e.maxAzimuthAngle;isFinite(V)&&isFinite(W)&&(V<-Math.PI?V+=k:V>Math.PI&&(V-=k),W<-Math.PI?W+=k:W>Math.PI&&(W-=k),V<=W?c.theta=Math.max(V,Math.min(W,c.theta)):c.theta=c.theta>(V+W)/2?Math.max(V,c.theta):Math.min(W,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let le=!1;if(e.zoomToCursor&&ue||e.object.isOrthographicCamera)c.radius=Re(c.radius);else{const U=c.radius;c.radius=Re(c.radius*d),le=U!=c.radius}if(a.setFromSpherical(c),a.applyQuaternion(y),Ze.copy(e.target).add(a),e.object.lookAt(e.target),e.enableDamping===!0?(u.theta*=1-e.dampingFactor,u.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),e.zoomToCursor&&ue){let U=null;if(e.object.isPerspectiveCamera){const ce=a.length();U=Re(ce*d);const pe=ce-U;e.object.position.addScaledVector(R,pe),e.object.updateMatrixWorld(),le=!!pe}else if(e.object.isOrthographicCamera){const ce=new v(x.x,x.y,0);ce.unproject(e.object);const pe=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),e.object.updateProjectionMatrix(),le=pe!==e.object.zoom;const Qe=new v(x.x,x.y,0);Qe.unproject(e.object),e.object.position.sub(Qe).add(ce),e.object.updateMatrixWorld(),U=a.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;U!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(U).add(e.object.position):(fe.origin.copy(e.object.position),fe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(fe.direction))<ea?n.lookAt(e.target):(it.setFromNormalAndCoplanarPoint(e.object.up,e.target),fe.intersectPlane(it,e.target))))}else if(e.object.isOrthographicCamera){const U=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),U!==e.object.zoom&&(e.object.updateProjectionMatrix(),le=!0)}return d=1,ue=!1,le||C.distanceToSquared(e.object.position)>l||8*(1-M.dot(e.object.quaternion))>l||K.distanceToSquared(e.target)>l?(e.dispatchEvent(at),C.copy(e.object.position),M.copy(e.object.quaternion),K.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",qe),e.domElement.removeEventListener("pointerdown",Ue),e.domElement.removeEventListener("pointercancel",re),e.domElement.removeEventListener("wheel",He),e.domElement.removeEventListener("pointermove",Me),e.domElement.removeEventListener("pointerup",re),e.domElement.getRootNode().removeEventListener("keydown",Be,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Oe),e._domElementKeyEvents=null)};const e=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const l=1e-6,c=new et,u=new et;let d=1;const h=new v,f=new G,p=new G,P=new G,w=new G,S=new G,z=new G,L=new G,j=new G,b=new G,R=new v,x=new G;let ue=!1;const I=[],se={};let Te=!1;function Pt(a){return a!==null?2*Math.PI/60*e.autoRotateSpeed*a:2*Math.PI/60/60*e.autoRotateSpeed}function me(a){const m=Math.abs(a*.01);return Math.pow(.95,e.zoomSpeed*m)}function oe(a){u.theta-=a}function he(a){u.phi-=a}const Ne=function(){const a=new v;return function(y,C){a.setFromMatrixColumn(C,0),a.multiplyScalar(-y),h.add(a)}}(),Le=function(){const a=new v;return function(y,C){e.screenSpacePanning===!0?a.setFromMatrixColumn(C,1):(a.setFromMatrixColumn(C,0),a.crossVectors(e.object.up,a)),a.multiplyScalar(y),h.add(a)}}(),ee=function(){const a=new v;return function(y,C){const M=e.domElement;if(e.object.isPerspectiveCamera){const K=e.object.position;a.copy(K).sub(e.target);let k=a.length();k*=Math.tan(e.object.fov/2*Math.PI/180),Ne(2*y*k/M.clientHeight,e.object.matrix),Le(2*C*k/M.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Ne(y*(e.object.right-e.object.left)/e.object.zoom/M.clientWidth,e.object.matrix),Le(C*(e.object.top-e.object.bottom)/e.object.zoom/M.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function Se(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d/=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function xe(a){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d*=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ie(a,m){if(!e.zoomToCursor)return;ue=!0;const y=e.domElement.getBoundingClientRect(),C=a-y.left,M=m-y.top,K=y.width,k=y.height;x.x=C/K*2-1,x.y=-(M/k)*2+1,R.set(x.x,x.y,1).unproject(e.object).sub(e.object.position).normalize()}function Re(a){return Math.max(e.minDistance,Math.min(e.maxDistance,a))}function ke(a){f.set(a.clientX,a.clientY)}function Ct(a){Ie(a.clientX,a.clientX),L.set(a.clientX,a.clientY)}function Ge(a){w.set(a.clientX,a.clientY)}function wt(a){p.set(a.clientX,a.clientY),P.subVectors(p,f).multiplyScalar(e.rotateSpeed);const m=e.domElement;oe(2*Math.PI*P.x/m.clientHeight),he(2*Math.PI*P.y/m.clientHeight),f.copy(p),e.update()}function bt(a){j.set(a.clientX,a.clientY),b.subVectors(j,L),b.y>0?Se(me(b.y)):b.y<0&&xe(me(b.y)),L.copy(j),e.update()}function Et(a){S.set(a.clientX,a.clientY),z.subVectors(S,w).multiplyScalar(e.panSpeed),ee(z.x,z.y),w.copy(S),e.update()}function Tt(a){Ie(a.clientX,a.clientY),a.deltaY<0?xe(me(a.deltaY)):a.deltaY>0&&Se(me(a.deltaY)),e.update()}function St(a){let m=!1;switch(a.code){case e.keys.UP:a.ctrlKey||a.metaKey||a.shiftKey?he(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(0,e.keyPanSpeed),m=!0;break;case e.keys.BOTTOM:a.ctrlKey||a.metaKey||a.shiftKey?he(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(0,-e.keyPanSpeed),m=!0;break;case e.keys.LEFT:a.ctrlKey||a.metaKey||a.shiftKey?oe(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(e.keyPanSpeed,0),m=!0;break;case e.keys.RIGHT:a.ctrlKey||a.metaKey||a.shiftKey?oe(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):ee(-e.keyPanSpeed,0),m=!0;break}m&&(a.preventDefault(),e.update())}function ze(a){if(I.length===1)f.set(a.pageX,a.pageY);else{const m=te(a),y=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);f.set(y,C)}}function je(a){if(I.length===1)w.set(a.pageX,a.pageY);else{const m=te(a),y=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);w.set(y,C)}}function Fe(a){const m=te(a),y=a.pageX-m.x,C=a.pageY-m.y,M=Math.sqrt(y*y+C*C);L.set(0,M)}function It(a){e.enableZoom&&Fe(a),e.enablePan&&je(a)}function Rt(a){e.enableZoom&&Fe(a),e.enableRotate&&ze(a)}function Ye(a){if(I.length==1)p.set(a.pageX,a.pageY);else{const y=te(a),C=.5*(a.pageX+y.x),M=.5*(a.pageY+y.y);p.set(C,M)}P.subVectors(p,f).multiplyScalar(e.rotateSpeed);const m=e.domElement;oe(2*Math.PI*P.x/m.clientHeight),he(2*Math.PI*P.y/m.clientHeight),f.copy(p)}function Ve(a){if(I.length===1)S.set(a.pageX,a.pageY);else{const m=te(a),y=.5*(a.pageX+m.x),C=.5*(a.pageY+m.y);S.set(y,C)}z.subVectors(S,w).multiplyScalar(e.panSpeed),ee(z.x,z.y),w.copy(S)}function We(a){const m=te(a),y=a.pageX-m.x,C=a.pageY-m.y,M=Math.sqrt(y*y+C*C);j.set(0,M),b.set(0,Math.pow(j.y/L.y,e.zoomSpeed)),Se(b.y),L.copy(j);const K=(a.pageX+m.x)*.5,k=(a.pageY+m.y)*.5;Ie(K,k)}function Mt(a){e.enableZoom&&We(a),e.enablePan&&Ve(a)}function Ot(a){e.enableZoom&&We(a),e.enableRotate&&Ye(a)}function Ue(a){e.enabled!==!1&&(I.length===0&&(e.domElement.setPointerCapture(a.pointerId),e.domElement.addEventListener("pointermove",Me),e.domElement.addEventListener("pointerup",re)),!xt(a)&&(Nt(a),a.pointerType==="touch"?Ke(a):At(a)))}function Me(a){e.enabled!==!1&&(a.pointerType==="touch"?vt(a):Dt(a))}function re(a){switch(Lt(a),I.length){case 0:e.domElement.releasePointerCapture(a.pointerId),e.domElement.removeEventListener("pointermove",Me),e.domElement.removeEventListener("pointerup",re),e.dispatchEvent(nt),o=s.NONE;break;case 1:const m=I[0],y=se[m];Ke({pointerId:m,pageX:y.x,pageY:y.y});break}}function At(a){let m;switch(a.button){case 0:m=e.mouseButtons.LEFT;break;case 1:m=e.mouseButtons.MIDDLE;break;case 2:m=e.mouseButtons.RIGHT;break;default:m=-1}switch(m){case H.DOLLY:if(e.enableZoom===!1)return;Ct(a),o=s.DOLLY;break;case H.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enablePan===!1)return;Ge(a),o=s.PAN}else{if(e.enableRotate===!1)return;ke(a),o=s.ROTATE}break;case H.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(e.enableRotate===!1)return;ke(a),o=s.ROTATE}else{if(e.enablePan===!1)return;Ge(a),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ae)}function Dt(a){switch(o){case s.ROTATE:if(e.enableRotate===!1)return;wt(a);break;case s.DOLLY:if(e.enableZoom===!1)return;bt(a);break;case s.PAN:if(e.enablePan===!1)return;Et(a);break}}function He(a){e.enabled===!1||e.enableZoom===!1||o!==s.NONE||(a.preventDefault(),e.dispatchEvent(Ae),Tt(_t(a)),e.dispatchEvent(nt))}function _t(a){const m=a.deltaMode,y={clientX:a.clientX,clientY:a.clientY,deltaY:a.deltaY};switch(m){case 1:y.deltaY*=16;break;case 2:y.deltaY*=100;break}return a.ctrlKey&&!Te&&(y.deltaY*=10),y}function Be(a){a.key==="Control"&&(Te=!0,e.domElement.getRootNode().addEventListener("keyup",$e,{passive:!0,capture:!0}))}function $e(a){a.key==="Control"&&(Te=!1,e.domElement.getRootNode().removeEventListener("keyup",$e,{passive:!0,capture:!0}))}function Oe(a){e.enabled===!1||e.enablePan===!1||St(a)}function Ke(a){switch(Xe(a),I.length){case 1:switch(e.touches.ONE){case ae.ROTATE:if(e.enableRotate===!1)return;ze(a),o=s.TOUCH_ROTATE;break;case ae.PAN:if(e.enablePan===!1)return;je(a),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(e.touches.TWO){case ae.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;It(a),o=s.TOUCH_DOLLY_PAN;break;case ae.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Rt(a),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ae)}function vt(a){switch(Xe(a),o){case s.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ye(a),e.update();break;case s.TOUCH_PAN:if(e.enablePan===!1)return;Ve(a),e.update();break;case s.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Mt(a),e.update();break;case s.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ot(a),e.update();break;default:o=s.NONE}}function qe(a){e.enabled!==!1&&a.preventDefault()}function Nt(a){I.push(a.pointerId)}function Lt(a){delete se[a.pointerId];for(let m=0;m<I.length;m++)if(I[m]==a.pointerId){I.splice(m,1);return}}function xt(a){for(let m=0;m<I.length;m++)if(I[m]==a.pointerId)return!0;return!1}function Xe(a){let m=se[a.pointerId];m===void 0&&(m=new G,se[a.pointerId]=m),m.set(a.pageX,a.pageY)}function te(a){const m=a.pointerId===I[0]?I[1]:I[0];return se[m]}e.domElement.addEventListener("contextmenu",qe),e.domElement.addEventListener("pointerdown",Ue),e.domElement.addEventListener("pointercancel",re),e.domElement.addEventListener("wheel",He,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Be,{passive:!0,capture:!0}),this.update()}}var aa={add:na};function na(t,n){const r=new ta(t,n.domElement);return r.enableDamping=!0,r.dampingFactor=.05,r.screenSpacePanning=!0,r.enablePan=!1,r.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.ROTATE},r.enableZoom=!0,r.minDistance=300,r.maxDistance=3e3,r.minPolarAngle=-1,r.maxPolarAngle=Math.PI/2.01,r}var N={moveCardVertically:Z,moveCard:Ce,rotateCardTo:gt,rotateCardBy:oa,moveCardTo:yt,shuffleIfNeeded:ia};async function Z(t,n=i().animate.stepSize,r=T.tableConfig.height+150){const e=Math.sign(r-t.position.y);n||(n=i().animate.stepSize),n*=i().speed;let s=null;return new Promise(o=>{const l=()=>{if(i().state===g.NO_GAME){s&&cancelAnimationFrame(s),o(!1);return}if(Math.abs(t.position.y-r)<=n){t.position.y=r,o(!0);return}t.position.y+=e*n,s=requestAnimationFrame(l)};l()})}async function Ce(t,n=100,r=Math.PI,e=i().animate.stepSize){e*=i().speed;let s=0;const o=Q.vector(r,e);let l=null;return new Promise(c=>{const u=()=>{if(n-s<=e){c(!0);return}if(t.position.x+=o.x,t.position.z+=o.z,s+=e,i().state===g.NO_GAME){l&&cancelAnimationFrame(l),c(!1);return}l=requestAnimationFrame(u)};u()})}async function gt(t,n=null,r=null,e=null){const s=i().animate.angleSize*i().speed,o=Math.sign(1/n),l=Math.sign(1/e),c=Math.sign(1/r);let u=null;return new Promise(d=>{const h=()=>{if(n!=null&&Math.abs(n-t.rotation.x)<=s?t.rotation.x+=s*o:n!=null&&(t.rotation.x=n,n=null),r!=null&&Math.abs(r-t.rotation.y)<=s?t.rotation.y+=s*c:r!=null&&(t.rotation.y=r,r=null),e!=null&&Math.abs(e-t.rotation.z)<=s?t.rotation.z+=s*l:e!=null&&(t.rotation.z=e,e=null),n===null&&r===null&&e===null){d(!0);return}if(i().state===g.NO_GAME){u&&cancelAnimationFrame(u),d(!1);return}u=requestAnimationFrame(h)};h()})}async function ia(t,n,r){if(i().drawPileCardsIds.length===0){const e=[],s=i().discardPileCardsIds,o=s[s.length-1],l=s.slice(0,-1);for(const u of l){const d=i().gameCards.find(h=>h.params.cardId===u);await Ce(d,ge.card.height*1.1),await Z(d,void 0,T.tableConfig.height+75+e.length),await gt(d,Math.PI/2,0,0),d.hidePicture(!0),await Z(d,void 0,T.tableConfig.height+150+e.length),e.push(d)}if(e.length>2)for(let u=0;u<50;u++){const d=Math.floor(Math.random()*e.length),h=e[d];await Ce(h,100,void 0,15),await Z(h,15,T.tableConfig.height+150+e.length+u),await Ce(h,100,2*Math.PI,15);for(let f=0;f<e.length;f++){const p=e[f];await Z(p,15,T.tableConfig.height+150+e.length+f)}}for(let u=0;u<e.length;u++){const d=e[u];await yt(d,ge.animate.drawPilePosition,void 0,15),await Z(d,15,T.tableConfig.height+u*.5),i().drawPileCardsIds.push(d.params.cardId),t.remove(d),t.remove(n),r()}i().drawPileCardsIds=sa(l),i().discardPileCardsIds=[o];const c=i().gameCards.find(u=>u.params.cardId===o);await Z(c,15,T.tableConfig.height+ge.card.depth)}}function sa(t){for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}async function oa(t,n=null,r=null,e=null){const s=i().animate.angleSize*i().speed,o=n?Math.abs(Math.ceil(n/s)):null,l=r?Math.abs(Math.ceil(r/s)):null,c=e?Math.abs(Math.ceil(e/s)):null;let u=0,d=null;return new Promise(h=>{const f=()=>{if(o&&o>u&&t.rotateX(n/o),l&&l>u&&t.rotateY(r/l),c&&c>u&&t.rotateZ(e/c),Math.max(o,c,l)===u){h(!0);return}if(u++,i().state===g.NO_GAME){d&&cancelAnimationFrame(d),h(!1);return}d=requestAnimationFrame(f)};f()})}async function yt(t,n={x:0,z:0},r=null,e=i().animate.stepSize){n.x=Q.round(n.x),n.z=Q.round(n.z),e*=i().speed;let s=i().animate.angleSize*i().speed;const o=t.position;let l=0;const c=Math.atan2(n.z-o.z,n.x-o.x),u=Q.vector(c,e),d=Q.distance(o.x,n.x,o.z,n.z);let h=null;return new Promise(f=>{const p=()=>{const P=d-l;if(P<=e?(t.position.x=n.x,t.position.z=n.z,l=d):(t.position.x+=u.x,t.position.z+=u.z,l+=e),r!==null){const w=r-t.rotation.z;Math.abs(w)<=s?(t.rotation.z=r,r=null):t.rotation.z+=Math.sign(w)*s}if(P<=e&&r===null){f(!0);return}if(i().state===g.NO_GAME){h&&cancelAnimationFrame(h),f(!1);return}h=requestAnimationFrame(p)};p()})}var _=Object.freeze({DRAW_TO_DISCARD:"DRAW_TO_DISCARD",DRAW_TO_PLAYER:"DRAW_TO_PLAYER",PLAYER_TO_DISCARD:"PLAYER_TO_DISCARD",NOT_PLAY:"NOT_PLAY",GAME_OVER:"GAME_OVER"});const ra={name:"SuitSelectDialog",props:{modelValue:{type:Boolean,default:!1},items:{type:Array,default:()=>[]}},data:()=>({}),computed:{modelValueComp:{get(){return this.modelValue},set(t){this.$emit("update:model-value",t)}},itemSelected(){return!!this.items.filter(t=>t.selected).length}},methods:{handleClick(t){if(!t.selected){this.items.forEach(n=>n.selected=!1),t.selected=!0;return}this.$emit("select",t.name),this.$emit("update:model-value",!1)}}},la={class:"text-h6"};function ca(t,n,r,e,s,o){return A(),de(rt,{modelValue:o.modelValueComp,"onUpdate:modelValue":n[0]||(n[0]=l=>o.modelValueComp=l),persistent:""},{default:$(()=>[D(ot,null,{default:$(()=>[D(be,null,{default:$(()=>[J("div",la,"Vyberte barvu "+q(o.itemSelected?"(vyberte znovu pro potvrzen\xED)":""),1)]),_:1}),D(be,{class:"fp-row"},{default:$(()=>[(A(!0),Y(ft,null,pt(r.items,(l,c)=>(A(),de(_e,{key:c,src:l.image,style:ye(`width: 200px; border: solid 3px ${l.selected?"red":"white"};`),onClick:u=>o.handleClick(l)},null,8,["src","style","onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var da=ve(ra,[["render",ca]]);const ua={name:"GameOverDialog",props:{modelValue:{type:Boolean,default:!1},playerId:{type:Number,default:null}},data:()=>({}),computed:{valueComp:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},player(){return this.playerId?i().players.find(t=>t.id===this.playerId):{}}},methods:{startGame(){i().setGameState(g.START_GAME)},stopGame(){i().setGameState(g.NO_GAME)},restartGame(){this.stopGame(),this.$nextTick(()=>this.startGame()),this.close()},close(){this.$emit("update:modelValue",!1)}}},ma=J("span",{style:{"font-size":"14pt","font-weight":"bold"}},"Vyhr\xE1l:",-1),ha={style:{"font-size":"28pt","font-weight":"bold",color:"#0d47a1"}},pa=J("br",null,null,-1);function fa(t,n,r,e,s,o){return A(),de(rt,{modelValue:o.valueComp,"onUpdate:modelValue":n[0]||(n[0]=l=>o.valueComp=l),persistent:""},{default:$(()=>[D(ot,null,{default:$(()=>[D(be,null,{default:$(()=>[ma]),_:1}),D(be,null,{default:$(()=>{var l,c;return[J("span",ha,q((l=o.player)==null?void 0:l.name),1),pa,(c=o.player)!=null&&c.avatar?(A(),de(_e,{key:0,src:o.player.avatar,style:{"margin-left":"10px",width:"350px","border-radius":"5px"}},null,8,["src"])):X("",!0)]}),_:1}),D(Gt,{align:"right",class:"text-primary"},{default:$(()=>[D(ie,{style:{margin:"auto"},color:"orange",label:t.$t("zavrit"),onClick:o.close},null,8,["label","onClick"]),D(ie,{style:{margin:"auto"},color:"secondary",label:t.$t("hra_restart"),onClick:o.restartGame},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ga=ve(ua,[["render",fa]]);const st=new Vt,De=new G,ya=Ht({name:"GamePage",components:{GameOverDialog:ga,SuitSelectDialog:da},data:()=>({suits:[],itemsSelectSuits:[],showSelectSuit:!1,computerStopBtn:!1,showGameOverDialog:!1,winnerId:null,gameContainerWidth:0,gameContainerHeight:0,camera:null,renderer:null,scene:null,drawPileObject:null,materials:{cardFrame:{primary:null,secondary:null},cardBack:null,table:null,sky:null,grass:null},cameraView:{PLAYER:"player",TABLE:"table"},playerSelectObject:null,timeouts:[],axiosCancelTokenStoreName:"game",cardOnDrawPileUsePower:!1}),computed:{loading(){return i().state===g.LOADING},showMenu(){return ne().showMenu},showStausBar(){return!1},players(){return i().players.length},activePlayer(){return i().players.find(t=>t.id===i().activePlayerId)},gameWarning(){return i().warning},gameInfo(){return i().info},hasMoreMoves(){var t;return i().activePlayerId?!(i().lastPlayerMove===_.PLAYER_TO_DISCARD||i().lastPlayerMove===_.NOT_PLAY||i().lastPlayerMove===_.DRAW_TO_PLAYER&&((t=i().rules)==null?void 0:t.numberOfCardsToDraw)===0):!0},lastMove(){return i().lastPlayerMove},showStopBtn(){var l,c,u,d;const t=i().discardPileCardsIds,n=t[t.length-1],r=(u=(c=(l=i())==null?void 0:l.gameCards)==null?void 0:c.find(h=>h.params.cardId===n))==null?void 0:u.params,e=(r==null?void 0:r.power)==="GET"&&(r==null?void 0:r.powerValue)===0,s=((d=i().rules)==null?void 0:d.numberOfCardsToDraw)>0;return g.PLAYER_TURN===i().state&&e&&!s},showSuits(){var e,s,o,l;if(!((e=i().gameCards)!=null&&e.length))return[];if(!((s=i().discardPileCardsIds)!=null&&s.length))return[];const t=i().discardPileCardsIds,n=t[t.length-1];return((o=i().gameCards.find(c=>c.params.cardId===n).params)==null?void 0:o.power)!=="SELECT_SUIT"?[]:(l=i().rules)!=null&&l.suit?this.suits.filter(c=>c.name===i().rules.suit):this.suits},mainPlayer(){const t=i().players.find(n=>n.id===Bt().id);return t||{}},isGameActive(){return i().state!==g.NO_GAME}},methods:{async startGame(){const t=i().settings;this.resetGame(),i().setGameState(g.LOADING),this.materials.cardFrame.primary=O.createColoredMaterial("#000000"),this.materials.cardFrame.secondary=O.createColoredMaterial("#fb8d3c"),this.materials.cardBack=O.createFromUrlMaterial(we.CARD_BACK.path),i().gameCards=await this.getDrawCardPileFromServer(t.cardGroupId);const n=await this.getNewGameFromServer(t);if(!n){this.resetGame();return}i().setPiles(n),i().setPlayers(n.players),i().setGameState(g.DEAL_CARDS),this.createDrawPile(),await this.dealCards(n.movesList),i().setFromState(n),i().setActivePlayerById(n.nextPLayerId)},async dealCards(t){const n=t.map((r,e)=>new Promise(s=>{const o=setTimeout(async()=>{await this.executeMove(r),s()},e*500/i().speed);this.timeouts.push(o)}));await Promise.all(n)},async executeMove(t,n){var r,e;switch(t.type){case _.DRAW_TO_DISCARD:n=await this.getDrawPileCard(null,!0),await this.moveToDiscardPile(n)||i().setGameState(g.ERROR);return;case _.DRAW_TO_PLAYER:const o=i().rules;if(!o){await this.getDrawPileCard(this.getPlayer(t.to));return}if(o.numberOfCardsToDraw===0){i().setWarning("Nepovolen\xFD tah");return}else if(o.numberOfCardsToDraw--,o.permittedCardIdsOnDiscardPile=[],o.numberOfCardsToDraw===0&&i().setGameState(this.activePlayer===this.mainPlayer?g.PLAYER_TURN_PROCESSING:g.COMPUTER_TURN_PROCESSING,!1),await this.getDrawPileCard(this.getPlayer(t.to)),await N.shuffleIfNeeded(this.scene,this.drawPileObject,()=>this.createDrawPile()),o.numberOfCardsToDraw>0){this.activePlayer===this.mainPlayer&&this.executeMove(t);return}break;case _.PLAYER_TO_DISCARD:const l=this.getPlayer(t.from);if(this.mainPlayer!==l)i().setGameState(g.COMPUTER_TURN_PROCESSING,!1),n=i().gameCards.find(c=>c.params.cardId===t.cardId),t.newSuit&&(i().rules.suit=t.newSuit),await this.moveToDiscardPile(n,l);else if((((r=i().rules)==null?void 0:r.permittedCardIdsOnDiscardPile)||[]).includes(n.params.cardId))i().setGameState(g.PLAYER_TURN_PROCESSING),await this.moveToDiscardPile(n,l);else{i().setWarning("Nepovolen\xFD tah");return}break;case _.NOT_PLAY:this.activePlayer===this.mainPlayer?i().setGameState(g.PLAYER_TURN_PROCESSING):(this.computerStopBtn=!0,await this.sleep(1e3/i().speed),this.computerStopBtn=!1,i().setGameState(g.COMPUTER_TURN_PROCESSING,!1));break}i().lastPlayerMove=t.type,i().state===g.COMPUTER_TURN_PROCESSING&&this.getNextPlayerActions(),i().state===g.PLAYER_TURN_PROCESSING&&(t.type===_.PLAYER_TO_DISCARD&&((e=n==null?void 0:n.params)==null?void 0:e.power)==="SELECT_SUIT"?this.openSelectSuitDialog():this.getNextPlayerActions())},createDrawPile(){const t=i().drawPileCardsIds.length,n=O.createCardFromMaterials(t,F.DROW_PILE,this.materials.cardFrame,this.materials.cardBack,this.materials.cardFrame,{selectable:!0});n&&(n.position.y=T.tableConfig.height+(t+1)*O.config.depth,n.position.x=i().animate.drawPilePosition.x,n.position.z=i().animate.drawPilePosition.z,this.scene.add(n)),this.drawPileObject=n},handleMouseClickOnCard(t){var e;const n=i().players[0];if(n.id!==i().activePlayerId||!((e=t==null?void 0:t.params)!=null&&e.selectable))return;if(!this.playerSelectObject||this.playerSelectObject&&this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect();const r=t.params.cardId;n.cardInHandIds.includes(r)&&this.executeMove({type:_.PLAYER_TO_DISCARD,from:n.id},t)},handleMouseClickOnDrawPile(t){if(i().players[0].id===i().activePlayerId){if(!this.playerSelectObject||this.playerSelectObject!==t){this.clearPlayerSelect(),t.select(),this.playerSelectObject=t;return}this.clearPlayerSelect(),this.executeMove({type:_.DRAW_TO_PLAYER,to:this.mainPlayer.id})}},getPlayer(t){return i().players.find(n=>n.id===t)},clearPlayerSelect(){const t=this.playerSelectObject;!t||(t.select&&t.select(!1),this.playerSelectObject=null)},async addCardToHand(t,n,r=i().animate.cardAngleView){const e=Math.abs(Math.ceil(r/(i().animate.angleSize*i().speed)));let s=0,o=null;return new Promise(l=>{const c=async()=>{if(s<e)t.rotateX(r/e),s++;else{n.cardInHandIds.push(t.params.cardId);const u=i().animate.maxCardsPerRow;let d=(n.cardInHandIds.length-1)%u+1,h=Math.floor((n.cardInHandIds.length-1)/u);switch(h){case 0:h=1;break;case 1:h=0;break;case 2:break;default:h=-h+2}if(h*=i().animate.cardOverlap,h-=1,d-1){const f=n.point,p=d%2===0?n.angle-Math.PI/2:n.angle+Math.PI/2,P=Q.vector(p,(O.config.width*2+10)*Math.floor(d/2));if(P.x+=f.x,P.z+=f.z,!await N.moveCardTo(t,P)){l(!1);return}}if(!await N.moveCardVertically(t,void 0,T.tableConfig.height-h*O.config.height)){l(!1);return}if(!await N.moveCard(t,O.config.height*Math.abs(h),Math.sign(h)*n.angle)){l(!1);return}l(!0);return}if(i().state===g.NO_GAME){o&&cancelAnimationFrame(o),l(!1);return}o=requestAnimationFrame(c)};c()})},async moveToDiscardPile(t,n){if(!t)return!1;t.params.selectable=!1,t.hidePicture(!1);const r=t.params.cardId,e=T.tableConfig.height+i().discardPileCardsIds.length*O.config.depth*4,s=i().animate.discardPilePosition,o={...t.position};i().discardPileCardsIds.push(r);let l=null,c=!0;if(n){const d=n.cardInHandIds,h=d.findIndex(p=>p===r),f=d.length-1;h!==f&&(l=i().gameCards.find(p=>p.params.cardId===d[f]),d.splice(h,1,l.params.cardId),c=!1),d.pop()}const u=async()=>{await N.moveCardVertically(l,void 0,o.y),await N.moveCardTo(l,{x:o.x,z:o.z})};return new Promise(async d=>{let h=await N.moveCardVertically(t);c||u(),h&&(h=await N.rotateCardBy(t,Math.PI/2+i().animate.cardAngleView)),h&&(h=await N.moveCardTo(t,s));const f=Q.round(Math.random()*2*Math.PI);if(h&&(h=await N.rotateCardTo(t,-Math.PI/2,0,f)),h&&(h=await N.moveCardVertically(t,void 0,e)),!h){i().setGameState(g.ERROR),d(!1);return}t.params.selectable=!0,d(!0)})},async getDrawPileCard(t,n){if(i().state===g.NO_GAME)return;const r=i().drawPileCardsIds.length;if(!r)return i().setGameState(g.ERROR),!1;const e=i().drawPileCardsIds[0],s=i().gameCards.find(c=>c.params.cardId===e);if(!s)return;i().drawPileCardsIds=i().drawPileCardsIds.slice(1),s.params.selectable=!1,s.hidePicture(!(t!=null&&t.main));const o=this.drawPileObject,l={x:o.position.x,z:o.position.z};if(s.position.y=T.tableConfig.height+r*2*O.config.depth,s.position.x=l.x,s.position.z=l.z,this.scene.add(s),this.scene.remove(o),this.createDrawPile(),!await N.moveCardVertically(s))return!1;if(n)return s.params.selectable=!0,s;if(!await N.moveCardTo(s,t.point,-Math.PI/2+t.angle))return!1;await this.addCardToHand(s,t),s.params.selectable=!0},showNextPlayerNameBeforeServerResponse(){let t=i().players.findIndex(e=>e.id===i().activePlayerId)+1;const n=i().players.length,r=i().players[t%n];return this.mainPlayer!==r&&i().setInfo("Hraje "+r.name),r.id},addListeners(){window.addEventListener("resize",this.handleChangeWindowSize.bind(this)),this.$refs.gameContainer.addEventListener("click",this.onMouseClick),this.$refs.gameContainer.addEventListener("dblclick",this.onMouseDoubleClick)},removeListeners(){window.removeEventListener("resize",this.handleChangeWindowSize),this.$refs.gameContainer.removeEventListener("click",this.onMouseClick),this.$refs.gameContainer.removeEventListener("dblclick",this.onMouseDoubleClick)},resetScene(){const t=[F.CARD,F.DROW_PILE,F.DISCARD_PILE,F.TABLE],n=this.scene;n.children.filter(s=>t.includes(s.name)).forEach(s=>{n.remove(s)});const e=T.createTable(this.materials.table);e&&this.scene.add(e)},resetGame(){this.cardOnDrawPileUsePower=!1,this.resetScene(),i().reset(),this.timeouts.forEach(clearTimeout);const t=ne().axiosRequests[this.axiosCancelTokenStoreName];t!=null&&t.length&&t.forEach(n=>{n.cancel&&n.cancel()}),this.timeouts=[]},initWebGL(){this.materials.table=T.createTableMaterial();const t=this.$refs.gameContainer,n=t.clientWidth,r=t.clientHeight,e=new Wt({antialias:!0});e.setSize(n,r),t.appendChild(e.domElement);const s=new Ut(75,n/r,1,1e4);s.lookAt(0,T.tableConfig.height+O.config.height*3,0);const o=aa.add(s,e),l=T.create(),c=T.createTable(this.materials.table);c&&l.add(c);const u=()=>{requestAnimationFrame(u),o.update(),e.render(l,s)};this.scene=l,this.renderer=e,this.camera=s,this.gameContainerWidth=n,this.gameContainerHeight=r,this.changeCameraView(this.cameraView.PLAYER),u()},changeCameraView(t){t||(t=i().cameraView);const n=this.camera,r=this.cameraView,e=this.mainPlayer.point||{x:0,z:T.tableConfig.radius};switch(t){case null:case r.PLAYER:n.position.set(0,T.tableConfig.height*2+O.config.height*2.5,e.z*1.05+O.config.height*1.5);break;case r.TABLE:n.position.set(0,e.z*1.3,e.z*.5);break}i().cameraView=t},handleChangePlayers(){this.resetScene()},handleChangeWindowSize(){const t=this.$refs.gameContainer,n=t.clientWidth,r=t.clientHeight;this.fitGameContainerToSize(n,r)},handleSuitSelect(t){i().rules.suit=t,this.getNextPlayerActions()},handleNotPlay(){this.executeMove({type:_.NOT_PLAY})},openSelectSuitDialog(){this.$get("prsi/suits",{groupId:i().settings.cardGroupId}).then(t=>{!t||(this.itemsSelectSuits=[],t.forEach(n=>{n.image.startsWith("data:image")||(n.image="data:"+n.imageType+";base64,"+n.image)}),this.itemsSelectSuits=t,this.showSelectSuit=!0)})},onMouseClick(t){var s,o;if(t.stopPropagation(),i().state===g.LOADING||i().state===g.DEAL_CARDS||i().state===g.WAITING_FOR_SERVER||i().state===g.PLAYER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na dokon\u010Den\xED akce");return}if(i().state===g.COMPUTER_TURN||i().state===g.COMPUTER_TURN_PROCESSING){i().setWarning("Po\u010Dkejte na tah protihr\xE1\u010De");return}const r=this.$refs.gameContainer.getBoundingClientRect();De.x=(t.clientX-r.left)/r.width*2-1,De.y=-((t.clientY-r.top)/r.height)*2+1,st.setFromCamera(De,this.camera);const e=st.intersectObjects(this.scene.children);switch((o=(s=e[0].object)==null?void 0:s.parent)==null?void 0:o.name){case F.CARD:this.handleMouseClickOnCard(e[0].object.parent);return;case F.DROW_PILE:this.handleMouseClickOnDrawPile(e[0].object.parent);return}this.playerSelectObject&&this.clearPlayerSelect()},handleSwitchMenu(){window.innerWidth<ne().minimumViewPort||(ne().showMenu?setTimeout(()=>{this.fitGameContainerToSize(this.gameContainerWidth-ne().menuWidth)},200):this.fitGameContainerToSize(this.gameContainerWidth+ne().menuWidth))},fitGameContainerToSize(t,n){n==null&&(n=this.gameContainerHeight),t==null&&(t=this.gameContainerWidth),this.camera.aspect=t/n,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,n),this.gameContainerWidth=t,this.gameContainerHeight=n},clearAll(){this.resetScene(),this.scene=null,this.renderer=null,this.camera=null,this.gameContainerWidth=null,this.gameContainerHeight=null},gameOver(t){i().activePlayerId=null,i().setGameState(g.GAME_OVER),this.showGameOverDialog=!0,this.winnerId=t.to},async getDrawCardPileFromServer(t){this.$get("prsi/suits",{groupId:i().settings.cardGroupId},!1,this.axiosCancelTokenStoreName).then(e=>{e&&(e.forEach(s=>{s.image.startsWith("data:image")||(s.image="data:"+s.imageType+";base64,"+s.image)}),this.suits=e)});const n=[],r=await this.$get("prsi/all_cards",{groupId:t},!1,this.axiosCancelTokenStoreName);if(r!==null)return r.forEach(e=>{n.push(O.createCardFromMaterials(1,F.CARD,O.createTexturedMaterial(e.face),this.materials.cardBack,this.materials.cardFrame,{cardId:e.id,selectable:!0,face:e.face,power:e.power,powerValue:e.powerValue,cardValue:e.cardValue,suit:e.suit})),delete e.face}),n},async getNewGameFromServer(t){const n=await this.$post("prsi/start",t,!1,this.axiosCancelTokenStoreName);return console.log("Hra na\u010Dtena"),n},async getNextPlayerActions(){var s,o;let t=null;if(i().activePlayerId===this.mainPlayer.id){let l=i().lastPlayerMove;const c=i().players.filter(p=>p!==this.mainPlayer).map(p=>({id:p.id,count:p.cardInHandIds.length}));let u=[];i().discardPileCardsIds.forEach(p=>{const P=i().gameCards.find(w=>w.params.cardId===p).params;u.push({id:P.cardId,value:P.suit+"-"+P.cardValue.name,power:P.power})});const d=i().players[0]?i().players[0].cardInHandIds:[];let h=i().gameCards.filter(p=>d.includes(p.params.cardId)).map(p=>({id:p.params.cardId,value:p.params.suit+"-"+p.params.cardValue.name}));const f=u[u.length-1];if(i().lastPlayerMove===_.PLAYER_TO_DISCARD){const p=u[u.length-1];h.push({id:p.id,value:p.value}),u=u.slice(0,u.length-1),l+=",id:"+p.id+","+p.value,p.power==="SELECT_SUIT"&&(l+="->"+i().rules.suit)}else f.power==="SELECT_SUIT"&&(u[u.length-1].value+="->"+i().rules.suit);i().lastPlayerMove===_.DRAW_TO_PLAYER&&(h=h.slice(0,u.length-1)),t={playersCards:h,opponentCards:c,discardPileCards:u,lastCardEffect:!!this.cardOnDrawPileUsePower,lastMove:l}}if(i().state===g.NO_GAME)return;const n={stateId:i().stateId,players:i().players.map(l=>({id:l.id,cardIds:l.cardInHandIds})),drawPile:i().drawPileCardsIds,discardPile:i().discardPileCardsIds,rules:i().rules,lastMove:i().lastPlayerMove,lastMoveBy:i().activePlayerId,trainningData:t},r=this.showNextPlayerNameBeforeServerResponse();i().setGameState(g.WAITING_FOR_SERVER);const e=await this.$post("prsi/next",n,!1,this.axiosCancelTokenStoreName);if(console.log("Dal\u0161\xED tah ze serveru"),!!e){this.cardOnDrawPileUsePower=((s=e==null?void 0:e.rules)==null?void 0:s.suit)||((o=e==null?void 0:e.rules)==null?void 0:o.numberOfCardsToDraw)!==1,i().activePlayerId=r,i().setGameState(this.mainPlayer===this.activePlayer?g.PLAYER_TURN:g.COMPUTER_TURN,this.mainPlayer===this.activePlayer),i().setFromState(e);for(const l of e.movesList){if(l.type===_.GAME_OVER){this.gameOver(l);return}await this.executeMove(l),await this.sleep(500)}}},async sleep(t){return new Promise(n=>setTimeout(n,t))}},mounted(){this.initWebGL(),this.addListeners()},beforeUnmount(){this.removeListeners(),this.clearAll()},watch:{showMenu(){this.handleSwitchMenu()},players(){this.handleChangePlayers()},isGameActive(){i().state===g.START_GAME&&this.startGame(),i().state===g.NO_GAME&&this.resetGame()}}}),Pa=t=>($t("data-v-5913a08b"),t=t(),Kt(),t),Ca={class:"height-100 width-100 fp-column game-page",ref:"gamePage"},wa={key:0,class:"overlay"},ba=Pa(()=>J("span",{class:"overlay-text"},"Na\u010D\xEDt\xE1n\xED hry",-1)),Ea=[ba],Ta={id:"gameContainer",ref:"gameContainer",class:"game-container"},Sa={key:1,class:"game-statusbar non-selectable"},Ia={class:"fp-column",style:{position:"absolute",right:"3px"}},Ra={key:2,class:"non-selectable width-100 page-info"},Ma={key:3,class:"non-selectable width-100 page-warning"};function Oa(t,n,r,e,s,o){var u;const l=tt("suit-select-dialog"),c=tt("game-over-dialog");return A(),Y("div",Ca,[t.loading?(A(),Y("div",wa,Ea)):X("",!0),J("div",Ta,null,512),t.showStausBar?(A(),Y("div",Sa," hr\xE1\u010D\u016F: "+q(t.players)+", hr\xE1\u010D: "+q((u=t.activePlayer)==null?void 0:u.name)+", existuje tah: "+q(t.hasMoreMoves)+", posledn\xED tah: "+q(t.lastMove)+", ",1)):X("",!0),J("div",Ia,[D(ie,{style:{margin:"3px","z-index":"10"},icon:"panorama",color:"accent",title:"Zobrazit pohled hr\xE1\u010De",onClick:n[0]||(n[0]=d=>t.changeCameraView(t.cameraView.PLAYER))}),D(ie,{style:{margin:"3px","z-index":"10"},icon:"visibility",color:"accent",title:"N\xE1hled na hern\xED st\u016Fl",onClick:n[1]||(n[1]=d=>t.changeCameraView(t.cameraView.TABLE))})]),!t.gameWarning&&t.gameInfo?(A(),Y("div",Ra,q(t.gameInfo),1)):X("",!0),t.gameWarning?(A(),Y("div",Ma,q(t.gameWarning),1)):X("",!0),t.computerStopBtn?(A(),Y("div",{key:4,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-50}px; top: ${t.gameContainerHeight/3-50}px`)},[D(ie,{icon:"front_hand",color:"red",title:"St\xE1t",style:{width:"100px",height:"100px"},class:"page-warning",onClick:n[2]||(n[2]=d=>t.handleNotPlay())})],4)):X("",!0),t.showStopBtn?(A(),Y("div",{key:5,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-50}px; bottom: 100px`)},[D(ie,{icon:"front_hand",color:"accent",title:"St\xE1t",style:{margin:"3px"},class:"page-warning",onClick:n[3]||(n[3]=d=>t.handleNotPlay())})],4)):t.showSuits.length?(A(),Y("div",{key:6,style:ye(`position: absolute; left: ${t.gameContainerWidth/2-t.showSuits.length*27}px; bottom: 30px`)},[(A(!0),Y(ft,null,pt(t.showSuits,(d,h)=>(A(),de(_e,{key:h,src:d.image,style:{width:"50px",margin:"4px"}},null,8,["src"]))),128))],4)):X("",!0),D(l,{modelValue:t.showSelectSuit,"onUpdate:modelValue":n[4]||(n[4]=d=>t.showSelectSuit=d),items:t.itemsSelectSuits,onSelect:t.handleSuitSelect},null,8,["modelValue","items","onSelect"]),D(c,{modelValue:t.showGameOverDialog,"onUpdate:modelValue":n[5]||(n[5]=d=>t.showGameOverDialog=d),"player-id":t.winnerId},null,8,["modelValue","player-id"])],512)}var xa=ve(ya,[["render",Oa],["__scopeId","data-v-5913a08b"]]);export{xa as default};
