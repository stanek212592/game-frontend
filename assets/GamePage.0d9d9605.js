import{Q as ke}from"./QBtn.7460600e.js";import{T as lt,S as ct,P as ht,E as dt,M as q,a as Ie,B as ut,G as mt,e as v,R as pt,b as ft,c as gt,V as M,d as N,f as G,Q as ve,h as Ne,i as O,j as bt,k as yt,g as h,l as S,W as Pt,m as wt}from"./game.17037ff1.js";import{_ as Ct,d as Et,k as Z,R as Mt,S as Tt,U as St,W as ce,Z as te,f as _e}from"./index.25c90732.js";import{i as me}from"./imagesEnum.48fd99c4.js";const x={size:2,width:50,height:80,radius:6,depth:.1};var D={config:x,createCard:Dt,select:Ot};const he=new lt;function Dt(n,o=v.DROW_PILE,s=null,e=null){if(n=Math.floor(Number(n)),isNaN(n)||n<1)return null;const i=x.width*x.size,a=x.height*x.size,c=x.radius*x.size,l=x.radius,m=x.depth*x.size,d=new ct;d.moveTo(0,c),d.lineTo(0,a-c),d.quadraticCurveTo(0,a,c,a),d.lineTo(i-c,a),d.quadraticCurveTo(i,a,i,a-c),d.lineTo(i,c),d.quadraticCurveTo(i,0,i-c,0),d.lineTo(c,0),d.quadraticCurveTo(0,0,0,c);const p=new ht;p.moveTo(l,l),p.lineTo(i-l,l),p.lineTo(i-l,a-l),p.lineTo(l,a-l),p.lineTo(l,l),d.holes.push(p);const C={steps:1,depth:m*n,bevelEnabled:!1},E=new dt(d,C),g=new q({color:"#000000"}),P=new Ie(E,g),L=new ut(i-2*l,a-2*l,m*n),j=[g,g,g,g,g,new q({map:he.load(me.CARD_BACK.path)})],z=s?[g,g,g,g,new q({map:he.load(s.path)}),new q({map:he.load(me.CARD_BACK.path)})]:null,A=new Ie(L,s?z:j),y=new mt;return P.position.x-=i/2,P.position.y-=a/2,P.position.z-=m*n/2,P.name=v.CARD_FRAME,y.add(P),y.add(A),y.rotateX(Math.PI/2),y.name=o,y.params={...e},y.select=(Y=!0)=>{Y?P.material=new q({color:"#ea7c01"}):P.material=g},s&&(y.hidePicture=(Y=!0)=>{A.material=Y?j:z}),y}function Ot(n){console.log(n)}const He={type:"change"},de={type:"start"},Ye={type:"end"},ne=new pt,We=new ft,xt=Math.cos(70*bt.DEG2RAD);class Lt extends gt{constructor(o,s){super(),this.object=o,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.touches={ONE:G.ROTATE,TWO:G.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",le),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",le),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(He),e.update(),a=i.NONE},this.update=function(){const t=new M,r=new ve().setFromUnitVectors(o.up,new M(0,1,0)),u=r.clone().invert(),f=new M,w=new ve,H=new M,T=2*Math.PI;return function(rt=null){const Ae=e.object.position;t.copy(Ae).sub(e.target),t.applyQuaternion(r),l.setFromVector3(t),e.autoRotate&&a===i.NONE&&K(Ge(rt)),e.enableDamping?(l.theta+=m.theta*e.dampingFactor,l.phi+=m.phi*e.dampingFactor):(l.theta+=m.theta,l.phi+=m.phi);let R=e.minAzimuthAngle,k=e.maxAzimuthAngle;isFinite(R)&&isFinite(k)&&(R<-Math.PI?R+=T:R>Math.PI&&(R-=T),k<-Math.PI?k+=T:k>Math.PI&&(k-=T),R<=k?l.theta=Math.max(R,Math.min(k,l.theta)):l.theta=l.theta>(R+k)/2?Math.max(R,l.theta):Math.min(k,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(p,e.dampingFactor):e.target.add(p),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let B=!1;if(e.zoomToCursor&&$||e.object.isOrthographicCamera)l.radius=se(l.radius);else{const I=l.radius;l.radius=se(l.radius*d),B=I!=l.radius}if(t.setFromSpherical(l),t.applyQuaternion(u),Ae.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(m.theta*=1-e.dampingFactor,m.phi*=1-e.dampingFactor,p.multiplyScalar(1-e.dampingFactor)):(m.set(0,0,0),p.set(0,0,0)),e.zoomToCursor&&$){let I=null;if(e.object.isPerspectiveCamera){const X=t.length();I=se(X*d);const ee=X-I;e.object.position.addScaledVector(Y,ee),e.object.updateMatrixWorld(),B=!!ee}else if(e.object.isOrthographicCamera){const X=new M(_.x,_.y,0);X.unproject(e.object);const ee=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),e.object.updateProjectionMatrix(),B=ee!==e.object.zoom;const Re=new M(_.x,_.y,0);Re.unproject(e.object),e.object.position.sub(Re).add(X),e.object.updateMatrixWorld(),I=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;I!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(I).add(e.object.position):(ne.origin.copy(e.object.position),ne.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ne.direction))<xt?o.lookAt(e.target):(We.setFromNormalAndCoplanarPoint(e.object.up,e.target),ne.intersectPlane(We,e.target))))}else if(e.object.isOrthographicCamera){const I=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),I!==e.object.zoom&&(e.object.updateProjectionMatrix(),B=!0)}return d=1,$=!1,B||f.distanceToSquared(e.object.position)>c||8*(1-w.dot(e.object.quaternion))>c||H.distanceToSquared(e.target)>c?(e.dispatchEvent(He),f.copy(e.object.position),w.copy(e.object.quaternion),H.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",je),e.domElement.removeEventListener("pointerdown",Se),e.domElement.removeEventListener("pointercancel",U),e.domElement.removeEventListener("wheel",De),e.domElement.removeEventListener("pointermove",re),e.domElement.removeEventListener("pointerup",U),e.domElement.getRootNode().removeEventListener("keydown",Oe,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",le),e._domElementKeyEvents=null)};const e=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=i.NONE;const c=1e-6,l=new Ne,m=new Ne;let d=1;const p=new M,C=new O,E=new O,g=new O,P=new O,L=new O,j=new O,z=new O,A=new O,y=new O,Y=new M,_=new O;let $=!1;const b=[],V={};let ae=!1;function Ge(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function Q(t){const r=Math.abs(t*.01);return Math.pow(.95,e.zoomSpeed*r)}function K(t){m.theta-=t}function J(t){m.phi-=t}const pe=function(){const t=new M;return function(u,f){t.setFromMatrixColumn(f,0),t.multiplyScalar(-u),p.add(t)}}(),fe=function(){const t=new M;return function(u,f){e.screenSpacePanning===!0?t.setFromMatrixColumn(f,1):(t.setFromMatrixColumn(f,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(u),p.add(t)}}(),W=function(){const t=new M;return function(u,f){const w=e.domElement;if(e.object.isPerspectiveCamera){const H=e.object.position;t.copy(H).sub(e.target);let T=t.length();T*=Math.tan(e.object.fov/2*Math.PI/180),pe(2*u*T/w.clientHeight,e.object.matrix),fe(2*f*T/w.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(pe(u*(e.object.right-e.object.left)/e.object.zoom/w.clientWidth,e.object.matrix),fe(f*(e.object.top-e.object.bottom)/e.object.zoom/w.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function oe(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ge(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?d*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(t,r){if(!e.zoomToCursor)return;$=!0;const u=e.domElement.getBoundingClientRect(),f=t-u.left,w=r-u.top,H=u.width,T=u.height;_.x=f/H*2-1,_.y=-(w/T)*2+1,Y.set(_.x,_.y,1).unproject(e.object).sub(e.object.position).normalize()}function se(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function be(t){C.set(t.clientX,t.clientY)}function Ve(t){ie(t.clientX,t.clientX),z.set(t.clientX,t.clientY)}function ye(t){P.set(t.clientX,t.clientY)}function Ke(t){E.set(t.clientX,t.clientY),g.subVectors(E,C).multiplyScalar(e.rotateSpeed);const r=e.domElement;K(2*Math.PI*g.x/r.clientHeight),J(2*Math.PI*g.y/r.clientHeight),C.copy(E),e.update()}function Ue(t){A.set(t.clientX,t.clientY),y.subVectors(A,z),y.y>0?oe(Q(y.y)):y.y<0&&ge(Q(y.y)),z.copy(A),e.update()}function Be(t){L.set(t.clientX,t.clientY),j.subVectors(L,P).multiplyScalar(e.panSpeed),W(j.x,j.y),P.copy(L),e.update()}function Xe(t){ie(t.clientX,t.clientY),t.deltaY<0?ge(Q(t.deltaY)):t.deltaY>0&&oe(Q(t.deltaY)),e.update()}function qe(t){let r=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?J(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,e.keyPanSpeed),r=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?J(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,-e.keyPanSpeed),r=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?K(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(e.keyPanSpeed,0),r=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?K(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(-e.keyPanSpeed,0),r=!0;break}r&&(t.preventDefault(),e.update())}function Pe(t){if(b.length===1)C.set(t.pageX,t.pageY);else{const r=F(t),u=.5*(t.pageX+r.x),f=.5*(t.pageY+r.y);C.set(u,f)}}function we(t){if(b.length===1)P.set(t.pageX,t.pageY);else{const r=F(t),u=.5*(t.pageX+r.x),f=.5*(t.pageY+r.y);P.set(u,f)}}function Ce(t){const r=F(t),u=t.pageX-r.x,f=t.pageY-r.y,w=Math.sqrt(u*u+f*f);z.set(0,w)}function Ze(t){e.enableZoom&&Ce(t),e.enablePan&&we(t)}function $e(t){e.enableZoom&&Ce(t),e.enableRotate&&Pe(t)}function Ee(t){if(b.length==1)E.set(t.pageX,t.pageY);else{const u=F(t),f=.5*(t.pageX+u.x),w=.5*(t.pageY+u.y);E.set(f,w)}g.subVectors(E,C).multiplyScalar(e.rotateSpeed);const r=e.domElement;K(2*Math.PI*g.x/r.clientHeight),J(2*Math.PI*g.y/r.clientHeight),C.copy(E)}function Me(t){if(b.length===1)L.set(t.pageX,t.pageY);else{const r=F(t),u=.5*(t.pageX+r.x),f=.5*(t.pageY+r.y);L.set(u,f)}j.subVectors(L,P).multiplyScalar(e.panSpeed),W(j.x,j.y),P.copy(L)}function Te(t){const r=F(t),u=t.pageX-r.x,f=t.pageY-r.y,w=Math.sqrt(u*u+f*f);A.set(0,w),y.set(0,Math.pow(A.y/z.y,e.zoomSpeed)),oe(y.y),z.copy(A);const H=(t.pageX+r.x)*.5,T=(t.pageY+r.y)*.5;ie(H,T)}function Qe(t){e.enableZoom&&Te(t),e.enablePan&&Me(t)}function Je(t){e.enableZoom&&Te(t),e.enableRotate&&Ee(t)}function Se(t){e.enabled!==!1&&(b.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",re),e.domElement.addEventListener("pointerup",U)),!st(t)&&(ot(t),t.pointerType==="touch"?Le(t):et(t)))}function re(t){e.enabled!==!1&&(t.pointerType==="touch"?at(t):tt(t))}function U(t){switch(it(t),b.length){case 0:e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",re),e.domElement.removeEventListener("pointerup",U),e.dispatchEvent(Ye),a=i.NONE;break;case 1:const r=b[0],u=V[r];Le({pointerId:r,pageX:u.x,pageY:u.y});break}}function et(t){let r;switch(t.button){case 0:r=e.mouseButtons.LEFT;break;case 1:r=e.mouseButtons.MIDDLE;break;case 2:r=e.mouseButtons.RIGHT;break;default:r=-1}switch(r){case N.DOLLY:if(e.enableZoom===!1)return;Ve(t),a=i.DOLLY;break;case N.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;ye(t),a=i.PAN}else{if(e.enableRotate===!1)return;be(t),a=i.ROTATE}break;case N.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;be(t),a=i.ROTATE}else{if(e.enablePan===!1)return;ye(t),a=i.PAN}break;default:a=i.NONE}a!==i.NONE&&e.dispatchEvent(de)}function tt(t){switch(a){case i.ROTATE:if(e.enableRotate===!1)return;Ke(t);break;case i.DOLLY:if(e.enableZoom===!1)return;Ue(t);break;case i.PAN:if(e.enablePan===!1)return;Be(t);break}}function De(t){e.enabled===!1||e.enableZoom===!1||a!==i.NONE||(t.preventDefault(),e.dispatchEvent(de),Xe(nt(t)),e.dispatchEvent(Ye))}function nt(t){const r=t.deltaMode,u={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(r){case 1:u.deltaY*=16;break;case 2:u.deltaY*=100;break}return t.ctrlKey&&!ae&&(u.deltaY*=10),u}function Oe(t){t.key==="Control"&&(ae=!0,e.domElement.getRootNode().addEventListener("keyup",xe,{passive:!0,capture:!0}))}function xe(t){t.key==="Control"&&(ae=!1,e.domElement.getRootNode().removeEventListener("keyup",xe,{passive:!0,capture:!0}))}function le(t){e.enabled===!1||e.enablePan===!1||qe(t)}function Le(t){switch(ze(t),b.length){case 1:switch(e.touches.ONE){case G.ROTATE:if(e.enableRotate===!1)return;Pe(t),a=i.TOUCH_ROTATE;break;case G.PAN:if(e.enablePan===!1)return;we(t),a=i.TOUCH_PAN;break;default:a=i.NONE}break;case 2:switch(e.touches.TWO){case G.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ze(t),a=i.TOUCH_DOLLY_PAN;break;case G.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;$e(t),a=i.TOUCH_DOLLY_ROTATE;break;default:a=i.NONE}break;default:a=i.NONE}a!==i.NONE&&e.dispatchEvent(de)}function at(t){switch(ze(t),a){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ee(t),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;Me(t),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Qe(t),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Je(t),e.update();break;default:a=i.NONE}}function je(t){e.enabled!==!1&&t.preventDefault()}function ot(t){b.push(t.pointerId)}function it(t){delete V[t.pointerId];for(let r=0;r<b.length;r++)if(b[r]==t.pointerId){b.splice(r,1);return}}function st(t){for(let r=0;r<b.length;r++)if(b[r]==t.pointerId)return!0;return!1}function ze(t){let r=V[t.pointerId];r===void 0&&(r=new O,V[t.pointerId]=r),r.set(t.pageX,t.pageY)}function F(t){const r=t.pointerId===b[0]?b[1]:b[0];return V[r]}e.domElement.addEventListener("contextmenu",je),e.domElement.addEventListener("pointerdown",Se),e.domElement.addEventListener("pointercancel",U),e.domElement.addEventListener("wheel",De,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Oe,{passive:!0,capture:!0}),this.update()}}var jt={add:zt};function zt(n,o){const s=new Lt(n,o.domElement);return s.enableDamping=!0,s.dampingFactor=.05,s.screenSpacePanning=!0,s.enablePan=!1,s.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.ROTATE},s.enableZoom=!0,s.minDistance=300,s.maxDistance=3e3,s.minPolarAngle=-1,s.maxPolarAngle=Math.PI/2.01,s}const Fe=new yt,ue=new O,At=Et({name:"GamePage",data:()=>({gameContainerWidth:0,gameContainerHeight:0,camera:null,renderer:null,scene:null,tableEdges:4,cameraView:{PLAYER:"player",TABLE:"table"},drawPileObject:null,discardPileObject:null,playerSelectObject:null}),computed:{showMenu(){return Z().showMenu},players(){return h().players.length},isGameActive(){return h().isGameActive}},methods:{startGame(){h().isGameActive&&this.resetScene(),h().userActionDisabled=!0;const n=a=>{const c=a.firstname+`${a.firstname&&a.surname?" ":""}`+a.surname;return c?c+` (${a.login})`:a.login},o=h().players,s=h().players.length,e=2*Math.PI/s;o.forEach((a,c)=>{a.id=c,a.name=c===0?n(Mt()):"po\u010D\xEDta\u010D "+c,a.main=c===0,a.angle=e*c+Math.PI/2,a.point=this.vector(e*c+Math.PI/2,S.tableConfig.radius*(s===2||s===4?.75:s===5?.85:.9)),a.cardInHand=[]}),this.changeCameraView(),h().drawPileCards=[],this.discardPileObject=null;const i=h().initialSettings.cardCount;h().drawPileCards=Array.from({length:i},(a,c)=>({id:c,picture:me.CARDS[Math.floor(Math.random()*6)+1],params:{selectable:!0}})),this.createDrawPile(h().initialSettings.drawPilePosition.x,h().initialSettings.drawPilePosition.z),this.dealCards(h().players,h().initialSettings.cardsPerPlayer).then(()=>{h().userActionDisabled=!1,console.log("rozd\xE1no")})},async dealCards(n,o){const s=[];return h().players.forEach((e,i)=>{for(let a=0;a<o;a++){const c=new Promise(l=>{setTimeout(()=>{this.getDrawPileCard(e).then(()=>l())},750*a+i*400)});s.push(c)}}),Promise.all(s)},createDrawPile(n=0,o=0){const s=h().drawPileCards.length,e=D.createCard(s);e&&(e.position.y=S.tableConfig.height+(s+1)*D.config.depth,e.position.x=n,e.position.z=o,this.scene.add(e)),this.drawPileObject=e},handleMouseClickOnCard(n){var o;if(!!((o=n==null?void 0:n.params)!=null&&o.selectable)){if(!this.playerSelectObject||this.playerSelectObject&&this.playerSelectObject!==n){this.clearPlayerSelect(),n.select(),this.playerSelectObject=n;return}this.clearPlayerSelect(),n.params.playerId!=null&&this.moveToDiscardPile(n)}},handleMouseClickOnDrawPile(n){if(!this.playerSelectObject||this.playerSelectObject!==n){this.clearPlayerSelect(),n.select(),this.playerSelectObject=n;return}this.clearPlayerSelect();const o=h().players.find(s=>s.main);this.getDrawPileCard(o)},clearPlayerSelect(){const n=this.playerSelectObject;!n||(n.select&&n.select(!1),this.playerSelectObject=null)},async moveCardVertically(n,o=h().animate.stepSize,s=S.tableConfig.height+150){const e=Math.sign(s-n.position.y);return o||(o=h().animate.stepSize),o*=h().speed,new Promise(i=>{const a=()=>{if(Math.abs(n.position.y-s)<=o){n.position.y=s,i(!0);return}n.position.y+=e*o,requestAnimationFrame(a)};a()})},async moveCard(n,o=100,s=Math.PI,e=h().animate.stepSize){e*=h().speed;let i=0;const a=this.vector(s,e);return new Promise(c=>{const l=()=>{if(o-i<=e){c(!0);return}n.position.x+=a.x,n.position.z+=a.z,i+=e,requestAnimationFrame(l)};l()})},async moveCardTo(n,o={x:0,z:0},s=null,e=h().animate.stepSize){o.x=this.round(o.x),o.z=this.round(o.z),e*=h().speed;const i=n.position;let a=0;const c=Math.atan2(o.z-i.z,o.x-i.x),l=this.vector(c,e),m=this.distance(i.x,o.x,i.z,o.z);return new Promise(d=>{const p=()=>{if(m-a<=e){n.position.x=this.round(o.x),n.position.z=this.round(o.z),d(!0);return}n.position.x+=l.x,n.position.z+=l.z,s!==null&&Math.abs(n.rotation.z-s)<=h().animate.angleSize?(n.rotation.z=s,s=null):s!==null&&(n.rotation.z+=h().animate.angleSize),a+=e,requestAnimationFrame(p)};p()})},async rotateCardTo(n,o=null,s=null,e=null){const i=h().animate.angleSize*h().speed,a=Math.sign(1/o),c=Math.sign(1/e),l=Math.sign(1/s);new Promise((m,d)=>{const p=()=>{if(o!=null&&Math.abs(o-n.rotation.x)<=i?n.rotation.x+=i*a:o!=null&&(n.rotation.x=o,o=null),s!=null&&Math.abs(s-n.rotation.y)<=i?n.rotation.y+=i*l:s!=null&&(n.rotation.y=s,s=null),e!=null&&Math.abs(e-n.rotation.z)<=i?n.rotation.z+=i*c:e!=null&&(n.rotation.z=e,e=null),o===null&&s===null&&e===null){m(!0);return}requestAnimationFrame(p)};p()})},async rotateCardBy(n,o=null,s=null,e=null){const i=h().animate.angleSize*h().speed,a=o?Math.abs(Math.ceil(o/i)):null,c=s?Math.abs(Math.ceil(s/i)):null,l=e?Math.abs(Math.ceil(e/i)):null;let m=0;new Promise((d,p)=>{const C=()=>{if(a&&a>m&&n.rotateX(o/a),c&&c>m&&n.rotateY(s/c),l&&l>m&&n.rotateZ(e/l),Math.max(a,l,c)===m){d(!0);return}m++,requestAnimationFrame(C)};C()})},async addCardToHand(n,o=h().animate.cardAngleView){const s=Math.abs(Math.ceil(o/(h().animate.angleSize*h().speed)));let e=0;return new Promise(i=>{const a=async()=>{if(e<s)n.rotateX(o/s),e++;else{const c=h().players.find(p=>p.id===n.params.playerId);c.cardInHand.push(n);const l=h().animate.maxCardsPerRow;let m=(c.cardInHand.length-1)%l+1,d=Math.floor((c.cardInHand.length-1)/l);switch(d){case 0:d=1;break;case 1:d=0;break;case 2:break;default:d=-d+2}if(d*=h().animate.cardOverlap,d-=1,m-1){const p=c.point,C=m%2===0?c.angle-Math.PI/2:c.angle+Math.PI/2,E=this.vector(C,(D.config.width*2+10)*Math.floor(m/2));E.x+=p.x,E.z+=p.z,await this.moveCardTo(n,E)}await this.moveCardVertically(n,null,S.tableConfig.height-d*D.config.height),await this.moveCard(n,D.config.height*Math.abs(d),Math.sign(d)*c.angle),i(!0);return}requestAnimationFrame(a)};a()})},async moveToDiscardPile(n){h().userActionDisabled=!0,n.params.selectable=!1,n.hidePicture(!1),h().discardPileCards||(h().discardPileCards=[]);const o=S.tableConfig.height+h().discardPileCards.length*D.config.depth*4,s=h().initialSettings.discardPilePosition,e={...n.position};h().discardPileCards.push(n);const a=h().players.find(p=>p.id===n.params.playerId).cardInHand,c=a.findIndex(p=>p===n),l=a[a.length-1],m=c===a.length-1;m||a.splice(c,1,l),a.pop(),n.params.playerId=null;const d=async()=>{await this.moveCardVertically(l,void 0,e.y),await this.moveCardTo(l,{x:e.x,z:e.z})};return D.createCard(1),new Promise(async p=>{await this.moveCardVertically(n),m?h().userActionDisabled=!1:d().then(()=>h().userActionDisabled=!1),await this.rotateCardBy(n,Math.PI/2+h().animate.cardAngleView),await this.moveCardTo(n,s),await this.rotateCardTo(n,-Math.PI/2,0,1),await this.moveCardVertically(n,void 0,o),n.params.selectable=!0,p(!0)})},async getDrawPileCard(n){const o=h().drawPileCards.length;if(!o)return;const s=h().drawPileCards[0];s.params.selectable=!1,h().drawPileCards=h().drawPileCards.slice(1);const e=this.drawPileObject,i={x:e.position.x,z:e.position.z},a=D.createCard(1,v.CARD,s.picture,{playerId:n.id,cardId:s.id,label:s.picture.label,...s.params});n.main||a.hidePicture(),a.position.y=S.tableConfig.height+o*2*D.config.depth,a.position.x=i.x,a.position.z=i.z,this.scene.add(a),this.scene.remove(e),this.createDrawPile(i.x,i.z),await this.moveCardVertically(a),await this.moveCardTo(a,n.point,-Math.PI/2+n.angle),await this.addCardToHand(a),a.params.selectable=!0},vector(n,o){return{x:this.round(Math.cos(n)*o),z:this.round(Math.sin(n)*o)}},distance(n,o,s,e){return Math.sqrt(Math.pow(o-n,2)+Math.pow(e-s,2))},round(n,o=10){return n=Number(n),isNaN(n)?null:Math.round(n*10**o)/10**o},addListeners(){window.addEventListener("resize",this.handleChangeWindowSize.bind(this)),this.$refs.gameContainer.addEventListener("click",this.onMouseClick),this.$refs.gameContainer.addEventListener("dblclick",this.onMouseDoubleClick)},removeListeners(){window.removeEventListener("resize",this.handleChangeWindowSize),this.$refs.gameContainer.removeEventListener("click",this.onMouseClick),this.$refs.gameContainer.removeEventListener("dblclick",this.onMouseDoubleClick)},resetScene(){const n=[v.CARD,v.DROW_PILE,v.DISCARD_PILE,v.TABLE],o=this.scene;o.children.filter(i=>n.includes(i.name)).forEach(i=>{o.remove(i)});const e=S.createTable(this.tableEdges);e&&this.scene.add(e)},initWebGL(){const n=this.$refs.gameContainer,o=n.clientWidth,s=n.clientHeight,e=new Pt;e.setSize(o,s),n.appendChild(e.domElement);const i=new wt(75,o/s,1,1e4);i.lookAt(0,S.tableConfig.height+D.config.height*3,0);const a=jt.add(i,e),c=S.create(),l=S.createTable(this.tableEdges);l&&c.add(l);const m=()=>{requestAnimationFrame(m),a.update(),e.render(c,i)};m(),this.scene=c,this.renderer=e,this.camera=i,this.gameContainerWidth=o,this.gameContainerHeight=s,this.changeCameraView(this.cameraView.PLAYER)},changeCameraView(n){var i;n||(n=h().cameraView);const o=this.camera,s=this.cameraView,e=((i=h().players.find(a=>a.main))==null?void 0:i.point)||{x:0,z:S.tableConfig.radius};switch(n){case null:case s.PLAYER:o.position.set(0,S.tableConfig.height*2+D.config.height*2,e.z*1.4+D.config.height*2);break;case s.TABLE:o.position.set(0,e.z*2.5,0);break}h().cameraView=n},setTableEdges(){this.tableEdges=this.players<4?Math.max(this.players*2,4):this.players},handleChangePlayers(){this.setTableEdges(),this.resetScene()},handleChangeWindowSize(){const n=this.$refs.gameContainer,o=n.clientWidth,s=n.clientHeight;this.fitGameContainerToSize(o,s)},onMouseClick(n){var i,a;if(n.stopPropagation(),h().userActionDisabled){console.log("z\xE1kaz klik\xE1n\xED");return}const s=this.$refs.gameContainer.getBoundingClientRect();ue.x=(n.clientX-s.left)/s.width*2-1,ue.y=-((n.clientY-s.top)/s.height)*2+1,Fe.setFromCamera(ue,this.camera);const e=Fe.intersectObjects(this.scene.children);switch((a=(i=e[0].object)==null?void 0:i.parent)==null?void 0:a.name){case v.CARD:this.handleMouseClickOnCard(e[0].object.parent);return;case v.DROW_PILE:this.handleMouseClickOnDrawPile(e[0].object.parent);return}this.playerSelectObject&&this.clearPlayerSelect()},onMouseDoubleClick(n){n.preventDefault()},handleSwitchMenu(){window.innerWidth<Z().minimumViewPort||(Z().showMenu?setTimeout(()=>{this.fitGameContainerToSize(this.gameContainerWidth-Z().menuWidth)},200):this.fitGameContainerToSize(this.gameContainerWidth+Z().menuWidth))},fitGameContainerToSize(n,o){o==null&&(o=this.gameContainerHeight),n==null&&(n=this.gameContainerWidth),this.camera.aspect=n/o,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,o),this.gameContainerWidth=n,this.gameContainerHeight=o},clearAll(){this.resetScene(),this.scene=null,this.renderer=null,this.camera=null,this.gameContainerWidth=null,this.gameContainerHeight=null}},mounted(){this.setTableEdges(),this.initWebGL(),this.addListeners()},beforeUnmount(){this.removeListeners(),this.clearAll()},watch:{showMenu(){this.handleSwitchMenu()},players(){this.handleChangePlayers()},isGameActive(){this.isGameActive&&this.startGame()}}}),Rt={class:"height-100 width-100 fp-column game-page",ref:"gamePage"},kt={id:"gameContainer",ref:"gameContainer",class:"game-container"},It={class:"game-toolbar"},vt={class:"fp-column",style:{position:"absolute",right:"3px"}};function Nt(n,o,s,e,i,a){return Tt(),St("div",Rt,[ce("div",kt,null,512),ce("div",It," hra: "+te(n.isGameActive)+", hr\xE1\u010D\u016F: "+te(n.players)+", W: "+te(n.gameContainerWidth)+" H: "+te(n.gameContainerHeight),1),ce("div",vt,[_e(ke,{style:{margin:"3px"},icon:"visibility",color:"accent",title:"Zobrazit pohled hr\xE1\u010De",onClick:o[0]||(o[0]=c=>n.changeCameraView(n.cameraView.PLAYER))}),_e(ke,{style:{margin:"3px"},icon:"panorama",color:"accent",title:"N\xE1hled na hern\xED st\u016Fl",onClick:o[1]||(o[1]=c=>n.changeCameraView(n.cameraView.TABLE))})])],512)}var Vt=Ct(At,[["render",Nt],["__scopeId","data-v-33d4e09a"]]);export{Vt as default};
