import{g as Fe}from"./QBtn.63385719.js";import{T as qe,a as wt,S as Ze,P as $e,E as Qe,M as G,b as re,B as Je,G as et,e as j,R as Ct,c as Et,d as Tt,V as A,f as H,h as B,Q as Ye,i as He,j as L,k as Mt,g as d,l as S,m as It,W as Dt,n as At}from"./game.54b0ca82.js";import{_ as St,d as Rt,k as Q,O as Ge,Q as We,Y as xt,R as ie,X as J,f as Ke,Z as Ot,$ as kt}from"./index.3a3473fb.js";import{i as ce}from"./imagesEnum.add174d3.js";const w=wt.card;var D={config:w,createCard:Lt,createTexturedMaterial:zt,createColoredMaterial:vt,createFromUrlMaterial:jt,createCardFromMaterials:_t};const se=new qe;function Lt(a,o=j.DROW_PILE,i=null,e=null){if(a=Math.floor(Number(a)),isNaN(a)||a<1)return null;const n=w.width*w.size,c=w.height*w.size,s=w.radius*w.size,r=w.radius,u=w.depth*w.size,m=new Ze;m.moveTo(0,s),m.lineTo(0,c-s),m.quadraticCurveTo(0,c,s,c),m.lineTo(n-s,c),m.quadraticCurveTo(n,c,n,c-s),m.lineTo(n,s),m.quadraticCurveTo(n,0,n-s,0),m.lineTo(s,0),m.quadraticCurveTo(0,0,0,s);const h=new $e;h.moveTo(r,r),h.lineTo(n-r,r),h.lineTo(n-r,c-r),h.lineTo(r,c-r),h.lineTo(r,r),m.holes.push(h);const f={steps:1,depth:u*a,bevelEnabled:!1},b=new Qe(m,f),y=new G({color:"#000000"}),C=new re(b,y),E=new Je(n-2*r,c-2*r,u*a),z=[y,y,y,y,y,new G({map:se.load(ce.CARD_BACK.path)})],R=i?[y,y,y,y,new G({map:se.load(i.path)}),new G({map:se.load(ce.CARD_BACK.path)})]:null,v=new re(E,i?R:z),P=new et;return C.position.x-=n/2,C.position.y-=c/2,C.position.z-=u*a/2,C.name=j.CARD_FRAME,P.add(C),P.add(v),P.rotateX(Math.PI/2),P.name=o,P.params={...e},P.select=(M=!0)=>{M?C.material=new G({color:"#ea7c01"}):C.material=y},i&&(P.hidePicture=(M=!0)=>{v.material=M?z:R}),P}function zt(a){const o=new qe().load("data:image/jpeg;base64,"+a);return new G({map:o})}function vt(a){return new G({color:a})}function jt(a=ce.CARD_BACK.path){return new G({map:se.load(a)})}function _t(a,o,i,e,n,c=null){if(!o||!i||!(n!=null&&n.primary)||!(n!=null&&n.secondary)||(a=Math.floor(Number(a)),isNaN(a)||a<1))return null;const s=w.width*w.size,r=w.height*w.size,u=w.radius*w.size,m=w.radius,h=w.depth*w.size,f=new Ze;f.moveTo(0,u),f.lineTo(0,r-u),f.quadraticCurveTo(0,r,u,r),f.lineTo(s-u,r),f.quadraticCurveTo(s,r,s,r-u),f.lineTo(s,u),f.quadraticCurveTo(s,0,s-u,0),f.lineTo(u,0),f.quadraticCurveTo(0,0,0,u);const b=new $e;b.moveTo(m,m),b.lineTo(s-m,m),b.lineTo(s-m,r-m),b.lineTo(m,r-m),b.lineTo(m,m),f.holes.push(b);const y={steps:1,depth:h*a,bevelEnabled:!1},C=new Qe(f,y),E=new re(C,n.primary),z=new Je(s-2*m,r-2*m,h*a),R=[n.primary,n.primary,n.primary,n.primary,n.primary,e],v=[n.primary,n.primary,n.primary,n.primary,i,e],P=new re(z,R),M=new et;return E.position.x-=s/2,E.position.y-=r/2,E.position.z-=h*a/2,E.name=j.CARD_FRAME,M.add(E),M.add(P),M.rotateX(Math.PI/2),M.name=o,M.params={...c},M.select=(x=!0)=>{x?E.material=new G({color:"#ea7c01"}):E.material=n.primary},M.hidePicture=(x=!0)=>{P.material=x?R:v},M}const Ve={type:"change"},fe={type:"start"},Be={type:"end"},oe=new Ct,Ue=new Et,Nt=Math.cos(70*Mt.DEG2RAD);class Ft extends Tt{constructor(o,i){super(),this.object=o,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new A,this.cursor=new A,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.PAN},this.touches={ONE:B.ROTATE,TWO:B.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",pe),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",pe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Ve),e.update(),c=n.NONE},this.update=function(){const t=new A,l=new Ye().setFromUnitVectors(o.up,new A(0,1,0)),p=l.clone().invert(),g=new A,I=new Ye,W=new A,O=2*Math.PI;return function(Pt=null){const _e=e.object.position;t.copy(_e).sub(e.target),t.applyQuaternion(l),r.setFromVector3(t),e.autoRotate&&c===n.NONE&&X(tt(Pt)),e.enableDamping?(r.theta+=u.theta*e.dampingFactor,r.phi+=u.phi*e.dampingFactor):(r.theta+=u.theta,r.phi+=u.phi);let N=e.minAzimuthAngle,F=e.maxAzimuthAngle;isFinite(N)&&isFinite(F)&&(N<-Math.PI?N+=O:N>Math.PI&&(N-=O),F<-Math.PI?F+=O:F>Math.PI&&(F-=O),N<=F?r.theta=Math.max(N,Math.min(F,r.theta)):r.theta=r.theta>(N+F)/2?Math.max(N,r.theta):Math.min(F,r.theta)),r.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,r.phi)),r.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let Z=!1;if(e.zoomToCursor&&ee||e.object.isOrthographicCamera)r.radius=ue(r.radius);else{const Y=r.radius;r.radius=ue(r.radius*m),Z=Y!=r.radius}if(t.setFromSpherical(r),t.applyQuaternion(p),_e.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(u.theta*=1-e.dampingFactor,u.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),e.zoomToCursor&&ee){let Y=null;if(e.object.isPerspectiveCamera){const $=t.length();Y=ue($*m);const ne=$-Y;e.object.position.addScaledVector(M,ne),e.object.updateMatrixWorld(),Z=!!ne}else if(e.object.isOrthographicCamera){const $=new A(x.x,x.y,0);$.unproject(e.object);const ne=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),Z=ne!==e.object.zoom;const Ne=new A(x.x,x.y,0);Ne.unproject(e.object),e.object.position.sub(Ne).add($),e.object.updateMatrixWorld(),Y=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;Y!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(Y).add(e.object.position):(oe.origin.copy(e.object.position),oe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(oe.direction))<Nt?o.lookAt(e.target):(Ue.setFromNormalAndCoplanarPoint(e.object.up,e.target),oe.intersectPlane(Ue,e.target))))}else if(e.object.isOrthographicCamera){const Y=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),Y!==e.object.zoom&&(e.object.updateProjectionMatrix(),Z=!0)}return m=1,ee=!1,Z||g.distanceToSquared(e.object.position)>s||8*(1-I.dot(e.object.quaternion))>s||W.distanceToSquared(e.target)>s?(e.dispatchEvent(Ve),g.copy(e.object.position),I.copy(e.object.quaternion),W.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",ve),e.domElement.removeEventListener("pointerdown",xe),e.domElement.removeEventListener("pointercancel",q),e.domElement.removeEventListener("wheel",Oe),e.domElement.removeEventListener("pointermove",he),e.domElement.removeEventListener("pointerup",q),e.domElement.getRootNode().removeEventListener("keydown",ke,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",pe),e._domElementKeyEvents=null)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=n.NONE;const s=1e-6,r=new He,u=new He;let m=1;const h=new A,f=new L,b=new L,y=new L,C=new L,E=new L,z=new L,R=new L,v=new L,P=new L,M=new A,x=new L;let ee=!1;const T=[],U={};let le=!1;function tt(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function te(t){const l=Math.abs(t*.01);return Math.pow(.95,e.zoomSpeed*l)}function X(t){u.theta-=t}function ae(t){u.phi-=t}const Pe=function(){const t=new A;return function(p,g){t.setFromMatrixColumn(g,0),t.multiplyScalar(-p),h.add(t)}}(),we=function(){const t=new A;return function(p,g){e.screenSpacePanning===!0?t.setFromMatrixColumn(g,1):(t.setFromMatrixColumn(g,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(p),h.add(t)}}(),K=function(){const t=new A;return function(p,g){const I=e.domElement;if(e.object.isPerspectiveCamera){const W=e.object.position;t.copy(W).sub(e.target);let O=t.length();O*=Math.tan(e.object.fov/2*Math.PI/180),Pe(2*p*O/I.clientHeight,e.object.matrix),we(2*g*O/I.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Pe(p*(e.object.right-e.object.left)/e.object.zoom/I.clientWidth,e.object.matrix),we(g*(e.object.top-e.object.bottom)/e.object.zoom/I.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function de(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?m/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ce(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?m*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function me(t,l){if(!e.zoomToCursor)return;ee=!0;const p=e.domElement.getBoundingClientRect(),g=t-p.left,I=l-p.top,W=p.width,O=p.height;x.x=g/W*2-1,x.y=-(I/O)*2+1,M.set(x.x,x.y,1).unproject(e.object).sub(e.object.position).normalize()}function ue(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function Ee(t){f.set(t.clientX,t.clientY)}function at(t){me(t.clientX,t.clientX),R.set(t.clientX,t.clientY)}function Te(t){C.set(t.clientX,t.clientY)}function nt(t){b.set(t.clientX,t.clientY),y.subVectors(b,f).multiplyScalar(e.rotateSpeed);const l=e.domElement;X(2*Math.PI*y.x/l.clientHeight),ae(2*Math.PI*y.y/l.clientHeight),f.copy(b),e.update()}function ot(t){v.set(t.clientX,t.clientY),P.subVectors(v,R),P.y>0?de(te(P.y)):P.y<0&&Ce(te(P.y)),R.copy(v),e.update()}function it(t){E.set(t.clientX,t.clientY),z.subVectors(E,C).multiplyScalar(e.panSpeed),K(z.x,z.y),C.copy(E),e.update()}function st(t){me(t.clientX,t.clientY),t.deltaY<0?Ce(te(t.deltaY)):t.deltaY>0&&de(te(t.deltaY)),e.update()}function rt(t){let l=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?ae(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):K(0,e.keyPanSpeed),l=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?ae(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):K(0,-e.keyPanSpeed),l=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?X(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):K(e.keyPanSpeed,0),l=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?X(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):K(-e.keyPanSpeed,0),l=!0;break}l&&(t.preventDefault(),e.update())}function Me(t){if(T.length===1)f.set(t.pageX,t.pageY);else{const l=V(t),p=.5*(t.pageX+l.x),g=.5*(t.pageY+l.y);f.set(p,g)}}function Ie(t){if(T.length===1)C.set(t.pageX,t.pageY);else{const l=V(t),p=.5*(t.pageX+l.x),g=.5*(t.pageY+l.y);C.set(p,g)}}function De(t){const l=V(t),p=t.pageX-l.x,g=t.pageY-l.y,I=Math.sqrt(p*p+g*g);R.set(0,I)}function ct(t){e.enableZoom&&De(t),e.enablePan&&Ie(t)}function lt(t){e.enableZoom&&De(t),e.enableRotate&&Me(t)}function Ae(t){if(T.length==1)b.set(t.pageX,t.pageY);else{const p=V(t),g=.5*(t.pageX+p.x),I=.5*(t.pageY+p.y);b.set(g,I)}y.subVectors(b,f).multiplyScalar(e.rotateSpeed);const l=e.domElement;X(2*Math.PI*y.x/l.clientHeight),ae(2*Math.PI*y.y/l.clientHeight),f.copy(b)}function Se(t){if(T.length===1)E.set(t.pageX,t.pageY);else{const l=V(t),p=.5*(t.pageX+l.x),g=.5*(t.pageY+l.y);E.set(p,g)}z.subVectors(E,C).multiplyScalar(e.panSpeed),K(z.x,z.y),C.copy(E)}function Re(t){const l=V(t),p=t.pageX-l.x,g=t.pageY-l.y,I=Math.sqrt(p*p+g*g);v.set(0,I),P.set(0,Math.pow(v.y/R.y,e.zoomSpeed)),de(P.y),R.copy(v);const W=(t.pageX+l.x)*.5,O=(t.pageY+l.y)*.5;me(W,O)}function dt(t){e.enableZoom&&Re(t),e.enablePan&&Se(t)}function mt(t){e.enableZoom&&Re(t),e.enableRotate&&Ae(t)}function xe(t){e.enabled!==!1&&(T.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",he),e.domElement.addEventListener("pointerup",q)),!yt(t)&&(gt(t),t.pointerType==="touch"?ze(t):ut(t)))}function he(t){e.enabled!==!1&&(t.pointerType==="touch"?ft(t):ht(t))}function q(t){switch(bt(t),T.length){case 0:e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",he),e.domElement.removeEventListener("pointerup",q),e.dispatchEvent(Be),c=n.NONE;break;case 1:const l=T[0],p=U[l];ze({pointerId:l,pageX:p.x,pageY:p.y});break}}function ut(t){let l;switch(t.button){case 0:l=e.mouseButtons.LEFT;break;case 1:l=e.mouseButtons.MIDDLE;break;case 2:l=e.mouseButtons.RIGHT;break;default:l=-1}switch(l){case H.DOLLY:if(e.enableZoom===!1)return;at(t),c=n.DOLLY;break;case H.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;Te(t),c=n.PAN}else{if(e.enableRotate===!1)return;Ee(t),c=n.ROTATE}break;case H.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;Ee(t),c=n.ROTATE}else{if(e.enablePan===!1)return;Te(t),c=n.PAN}break;default:c=n.NONE}c!==n.NONE&&e.dispatchEvent(fe)}function ht(t){switch(c){case n.ROTATE:if(e.enableRotate===!1)return;nt(t);break;case n.DOLLY:if(e.enableZoom===!1)return;ot(t);break;case n.PAN:if(e.enablePan===!1)return;it(t);break}}function Oe(t){e.enabled===!1||e.enableZoom===!1||c!==n.NONE||(t.preventDefault(),e.dispatchEvent(fe),st(pt(t)),e.dispatchEvent(Be))}function pt(t){const l=t.deltaMode,p={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(l){case 1:p.deltaY*=16;break;case 2:p.deltaY*=100;break}return t.ctrlKey&&!le&&(p.deltaY*=10),p}function ke(t){t.key==="Control"&&(le=!0,e.domElement.getRootNode().addEventListener("keyup",Le,{passive:!0,capture:!0}))}function Le(t){t.key==="Control"&&(le=!1,e.domElement.getRootNode().removeEventListener("keyup",Le,{passive:!0,capture:!0}))}function pe(t){e.enabled===!1||e.enablePan===!1||rt(t)}function ze(t){switch(je(t),T.length){case 1:switch(e.touches.ONE){case B.ROTATE:if(e.enableRotate===!1)return;Me(t),c=n.TOUCH_ROTATE;break;case B.PAN:if(e.enablePan===!1)return;Ie(t),c=n.TOUCH_PAN;break;default:c=n.NONE}break;case 2:switch(e.touches.TWO){case B.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;ct(t),c=n.TOUCH_DOLLY_PAN;break;case B.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;lt(t),c=n.TOUCH_DOLLY_ROTATE;break;default:c=n.NONE}break;default:c=n.NONE}c!==n.NONE&&e.dispatchEvent(fe)}function ft(t){switch(je(t),c){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ae(t),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;Se(t),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;dt(t),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;mt(t),e.update();break;default:c=n.NONE}}function ve(t){e.enabled!==!1&&t.preventDefault()}function gt(t){T.push(t.pointerId)}function bt(t){delete U[t.pointerId];for(let l=0;l<T.length;l++)if(T[l]==t.pointerId){T.splice(l,1);return}}function yt(t){for(let l=0;l<T.length;l++)if(T[l]==t.pointerId)return!0;return!1}function je(t){let l=U[t.pointerId];l===void 0&&(l=new L,U[t.pointerId]=l),l.set(t.pageX,t.pageY)}function V(t){const l=t.pointerId===T[0]?T[1]:T[0];return U[l]}e.domElement.addEventListener("contextmenu",ve),e.domElement.addEventListener("pointerdown",xe),e.domElement.addEventListener("pointercancel",q),e.domElement.addEventListener("wheel",Oe,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",ke,{passive:!0,capture:!0}),this.update()}}var Yt={add:Ht};function Ht(a,o){const i=new Ft(a,o.domElement);return i.enableDamping=!0,i.dampingFactor=.05,i.screenSpacePanning=!0,i.enablePan=!1,i.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.ROTATE},i.enableZoom=!0,i.minDistance=300,i.maxDistance=3e3,i.minPolarAngle=-1,i.maxPolarAngle=Math.PI/2.01,i}var _={vector:Gt,distance:Wt,round:ye};function Gt(a,o){return{x:ye(Math.cos(a)*o),z:ye(Math.sin(a)*o)}}function Wt(a,o,i,e){return Math.sqrt(Math.pow(o-a,2)+Math.pow(e-i,2))}function ye(a,o=10){return a=Number(a),isNaN(a)?null:Math.round(a*10**o)/10**o}var k={moveCardVertically:Kt,moveCard:Vt,rotateCardTo:Bt,rotateCardBy:Ut,moveCardTo:Xt};async function Kt(a,o=d().animate.stepSize,i=S.tableConfig.height+150){const e=Math.sign(i-a.position.y);o||(o=d().animate.stepSize),o*=d().speed;let n=null;return new Promise(c=>{const s=()=>{if(Math.abs(a.position.y-i)<=o){a.position.y=i,c(!0);return}if(a.position.y+=e*o,!d().isGameActive){n&&cancelAnimationFrame(n),c(!1);return}n=requestAnimationFrame(s)};s()})}async function Vt(a,o=100,i=Math.PI,e=d().animate.stepSize){e*=d().speed;let n=0;const c=_.vector(i,e);let s=null;return new Promise(r=>{const u=()=>{if(o-n<=e){r(!0);return}if(a.position.x+=c.x,a.position.z+=c.z,n+=e,!d().isGameActive){s&&cancelAnimationFrame(s),r(!1);return}s=requestAnimationFrame(u)};u()})}async function Bt(a,o=null,i=null,e=null){const n=d().animate.angleSize*d().speed,c=Math.sign(1/o),s=Math.sign(1/e),r=Math.sign(1/i);let u=null;new Promise((m,h)=>{const f=()=>{if(o!=null&&Math.abs(o-a.rotation.x)<=n?a.rotation.x+=n*c:o!=null&&(a.rotation.x=o,o=null),i!=null&&Math.abs(i-a.rotation.y)<=n?a.rotation.y+=n*r:i!=null&&(a.rotation.y=i,i=null),e!=null&&Math.abs(e-a.rotation.z)<=n?a.rotation.z+=n*s:e!=null&&(a.rotation.z=e,e=null),o===null&&i===null&&e===null){m(!0);return}if(!d().isGameActive){u&&cancelAnimationFrame(u),m(!1);return}u=requestAnimationFrame(f)};f()})}async function Ut(a,o=null,i=null,e=null){const n=d().animate.angleSize*d().speed,c=o?Math.abs(Math.ceil(o/n)):null,s=i?Math.abs(Math.ceil(i/n)):null,r=e?Math.abs(Math.ceil(e/n)):null;let u=0,m=null;new Promise((h,f)=>{const b=()=>{if(c&&c>u&&a.rotateX(o/c),s&&s>u&&a.rotateY(i/s),r&&r>u&&a.rotateZ(e/r),Math.max(c,r,s)===u){h(!0);return}if(u++,!d().isGameActive){m&&cancelAnimationFrame(m),h(!1);return}m=requestAnimationFrame(b)};b()})}async function Xt(a,o={x:0,z:0},i=null,e=d().animate.stepSize){o.x=_.round(o.x),o.z=_.round(o.z),e*=d().speed;const n=a.position;let c=0;const s=Math.atan2(o.z-n.z,o.x-n.x),r=_.vector(s,e),u=_.distance(n.x,o.x,n.z,o.z);let m=null;return new Promise(h=>{const f=()=>{if(u-c<=e){a.position.x=_.round(o.x),a.position.z=_.round(o.z),h(!0);return}if(a.position.x+=r.x,a.position.z+=r.z,i!==null&&Math.abs(a.rotation.z-i)<=d().animate.angleSize?(a.rotation.z=i,i=null):i!==null&&(a.rotation.z+=d().animate.angleSize),c+=e,!d().isGameActive){m&&cancelAnimationFrame(m),h(!1);return}m=requestAnimationFrame(f)};f()})}var ge=Object.freeze({DRAW_TO_DISCARD:"DRAW_TO_DISCARD",DRAW_TO_PLAYER:"DRAW_TO_PLAYER",NEXT_PLAYER:"NEXT_PLAYER",CARD_TO_DISCARD:"CARD_TO_DISCARD"});const Xe=new It,be=new L,qt=Rt({name:"GamePage",data:()=>({gameContainerWidth:0,gameContainerHeight:0,camera:null,renderer:null,scene:null,drawPileObject:null,materials:{cardFrame:{primary:null,secondary:null},cardBack:null,table:null,sky:null,grass:null},cameraView:{PLAYER:"player",TABLE:"table"},loading:!1,playerSelectObject:null,timeouts:[],fetchPromises:[]}),computed:{showMenu(){return Q().showMenu},players(){return d().players.length},isGameActive(){return d().isGameActive},activePlayer(){return d().players.find(a=>a.id===d().activePlayerId)}},methods:{async startGame(){this.loading=!0,this.resetScene(),d().userActionDisabled=!0,d().activePlayerId=null;const a={settingsId:1,userIds:[1,2],cardGroupId:1};this.materials.cardFrame.primary=D.createColoredMaterial("#000000"),this.materials.cardFrame.secondary=D.createColoredMaterial("#fb8d3c"),this.materials.cardBack=D.createFromUrlMaterial(ce.CARD_BACK.path),d().gameCards=await this.getDrawCardPileFromServer(a.cardGroupId);const o=await this.getStartParamsFromServer(a);d().drawPileCardsIds=o.drawPile;const i=s=>{const r=s.firstname+`${s.firstname&&s.surname?" ":""}`+s.surname;return r?r+` (${s.login})`:s.login},e=o.players,n=e.length,c=2*Math.PI/n;d().setPlayers(n),d().players.forEach((s,r)=>{const u=e[r];s.id=u.userId,s.main=r===0,s.avatar=u.avatar,s.name=i(u),s.cardInHandIds=u.cardIds,s.virtual=u.virtual,s.angle=c*r+Math.PI/2,s.point=_.vector(c*r+Math.PI/2,S.tableConfig.radius*(n===2||n===4?.75:n===5?.85:.9))}),this.createDrawPile(d().animate.drawPilePosition.x,d().animate.drawPilePosition.z),this.loading=!1,console.log("p\u0159ed rozd\xE1n\xEDm");for(const s of o.movesList)await new Promise(r=>{const u=setTimeout(()=>{this.executeMove(s),r()},500);this.timeouts.push(u)});await this.getDrawPileCard(d().players[0]),d().userActionDisabled=!1,console.log("konec")},async executeMove(a){switch(console.log(a),a.type){case ge.DRAW_TO_DISCARD:console.log("d\xE1t kartu z bal\xED\u010Dku na st\u016Fl");const o=await this.getDrawPileCard(null,!0);await this.moveToDiscardPile(o);break;case ge.DRAW_TO_PLAYER:console.log("d\xE1t kartu z bal\xED\u010Dku hr\xE1\u010Di: "+a.to),await this.getDrawPileCard(d().players.find(i=>i.id===a.to));break;case ge.NEXT_PLAYER:console.log("nyn\xED harje hr\xE1\u010D "+a.to),d().activePlayerId=a.to,console.log("pokud aktivn\xED hr\xE1\u010D nen\xED main, tak volat beckedn");break}a.discardPileParams!=null&&console.log(a.discardPileParams)},createDrawPile(){const a=d().drawPileCardsIds.length,o=D.createCardFromMaterials(a,j.DROW_PILE,this.materials.cardFrame,this.materials.cardBack,this.materials.cardFrame,{selectable:!0});o&&(o.position.y=S.tableConfig.height+(a+1)*D.config.depth,o.position.x=d().animate.drawPilePosition.x,o.position.z=d().animate.drawPilePosition.z,this.scene.add(o)),this.drawPileObject=o},handleMouseClickOnCard(a){var e;if(console.log("click na kartu id: "+a.params.cardId),!((e=a==null?void 0:a.params)!=null&&e.selectable))return;if(!this.playerSelectObject||this.playerSelectObject&&this.playerSelectObject!==a){this.clearPlayerSelect(),a.select(),this.playerSelectObject=a;return}this.clearPlayerSelect();const o=a.params.cardId,i=d().players[0];i.cardInHandIds.includes(o)&&this.moveToDiscardPile(a,i)},handleMouseClickOnDrawPile(a){if(!this.playerSelectObject||this.playerSelectObject!==a){this.clearPlayerSelect(),a.select(),this.playerSelectObject=a;return}this.clearPlayerSelect();const o=d().players.find(i=>i.main);this.getDrawPileCard(o)},clearPlayerSelect(){const a=this.playerSelectObject;!a||(a.select&&a.select(!1),this.playerSelectObject=null)},async addCardToHand(a,o,i=d().animate.cardAngleView){const e=Math.abs(Math.ceil(i/(d().animate.angleSize*d().speed)));let n=0,c=null;return new Promise(s=>{const r=async()=>{if(n<e)a.rotateX(i/e),n++;else{o.cardInHandIds.push(a.params.cardId);const u=d().animate.maxCardsPerRow;let m=(o.cardInHandIds.length-1)%u+1,h=Math.floor((o.cardInHandIds.length-1)/u);switch(h){case 0:h=1;break;case 1:h=0;break;case 2:break;default:h=-h+2}if(h*=d().animate.cardOverlap,h-=1,m-1){const f=o.point,b=m%2===0?o.angle-Math.PI/2:o.angle+Math.PI/2,y=_.vector(b,(D.config.width*2+10)*Math.floor(m/2));if(y.x+=f.x,y.z+=f.z,!await k.moveCardTo(a,y)){s(!1);return}}if(!await k.moveCardVertically(a,null,S.tableConfig.height-h*D.config.height)){s(!1);return}if(!await k.moveCard(a,D.config.height*Math.abs(h),Math.sign(h)*o.angle)){s(!1);return}s(!0);return}if(!d().isGameActive){c&&cancelAnimationFrame(c),s(!1);return}c=requestAnimationFrame(r)};r()})},async moveToDiscardPile(a,o){d().userActionDisabled=!0,a.params.selectable=!1,a.hidePicture(!1);const i=a.params.cardId,e=S.tableConfig.height+d().discardPileCardsIds.length*D.config.depth*4,n=d().animate.discardPilePosition,c={...a.position};d().discardPileCardsIds.push(i);let s=null,r=!0;if(o){const m=o.cardInHandIds,h=m.findIndex(b=>b===i),f=m.length-1;h!==f&&(s=d().gameCards.find(b=>b.params.cardId===m[f]),m.splice(h,1,s.params.cardId),r=!1),m.pop()}const u=async()=>{await k.moveCardVertically(s,void 0,c.y),await k.moveCardTo(s,{x:c.x,z:c.z})};return new Promise(async m=>{await k.moveCardVertically(a),r?d().userActionDisabled=!1:u().then(()=>d().userActionDisabled=!1),await k.rotateCardBy(a,Math.PI/2+d().animate.cardAngleView),await k.moveCardTo(a,n);const h=_.round(Math.random()*2*Math.PI);await k.rotateCardTo(a,-Math.PI/2,0,h),await k.moveCardVertically(a,void 0,e),a.params.selectable=!0,m(!0)})},async getDrawPileCard(a,o){if(!d().isGameActive)return;const i=d().drawPileCardsIds.length;if(!i)return;const e=d().drawPileCardsIds[0],n=d().gameCards.find(r=>r.params.cardId===e);d().drawPileCardsIds=d().drawPileCardsIds.slice(1),n.params.selectable=!1,n.hidePicture(!(a!=null&&a.main));const c=this.drawPileObject,s={x:c.position.x,z:c.position.z};if(n.position.y=S.tableConfig.height+i*2*D.config.depth,n.position.x=s.x,n.position.z=s.z,this.scene.add(n),this.scene.remove(c),this.createDrawPile(s.x,s.z),!!await k.moveCardVertically(n)){if(o)return n.params.selectable=!0,n;!await k.moveCardTo(n,a.point,-Math.PI/2+a.angle)||(await this.addCardToHand(n,a),n.params.selectable=!0)}},addListeners(){window.addEventListener("resize",this.handleChangeWindowSize.bind(this)),this.$refs.gameContainer.addEventListener("click",this.onMouseClick),this.$refs.gameContainer.addEventListener("dblclick",this.onMouseDoubleClick)},removeListeners(){window.removeEventListener("resize",this.handleChangeWindowSize),this.$refs.gameContainer.removeEventListener("click",this.onMouseClick),this.$refs.gameContainer.removeEventListener("dblclick",this.onMouseDoubleClick)},resetScene(){const a=[j.CARD,j.DROW_PILE,j.DISCARD_PILE,j.TABLE],o=this.scene;o.children.filter(n=>a.includes(n.name)).forEach(n=>{o.remove(n)});const e=S.createTable(this.materials.table);e&&this.scene.add(e)},resetGame(){this.resetScene(),d().userActionDisabled=!1,this.loading=!1,this.timeouts.forEach(clearTimeout),this.fetchPromises.forEach(a=>{a.cancel&&a.cancel()})},initWebGL(){this.materials.table=S.createTableMaterial();const a=this.$refs.gameContainer,o=a.clientWidth,i=a.clientHeight,e=new Dt;e.setSize(o,i),a.appendChild(e.domElement);const n=new At(75,o/i,1,1e4);n.lookAt(0,S.tableConfig.height+D.config.height*3,0);const c=Yt.add(n,e),s=S.create(),r=S.createTable(this.materials.table);r&&s.add(r);const u=()=>{requestAnimationFrame(u),c.update(),e.render(s,n)};this.scene=s,this.renderer=e,this.camera=n,this.gameContainerWidth=o,this.gameContainerHeight=i,this.changeCameraView(this.cameraView.PLAYER),u()},changeCameraView(a){var n;a||(a=d().cameraView);const o=this.camera,i=this.cameraView,e=((n=d().players.find(c=>c.main))==null?void 0:n.point)||{x:0,z:S.tableConfig.radius};switch(a){case null:case i.PLAYER:o.position.set(0,S.tableConfig.height*2+D.config.height*2,e.z*1.4+D.config.height*2);break;case i.TABLE:o.position.set(0,e.z*2.5,0);break}d().cameraView=a},handleChangePlayers(){this.resetScene()},handleChangeWindowSize(){const a=this.$refs.gameContainer,o=a.clientWidth,i=a.clientHeight;this.fitGameContainerToSize(o,i)},onMouseClick(a){var n,c;if(a.stopPropagation(),d().userActionDisabled){console.log("z\xE1kaz klik\xE1n\xED");return}const i=this.$refs.gameContainer.getBoundingClientRect();be.x=(a.clientX-i.left)/i.width*2-1,be.y=-((a.clientY-i.top)/i.height)*2+1,Xe.setFromCamera(be,this.camera);const e=Xe.intersectObjects(this.scene.children);switch((c=(n=e[0].object)==null?void 0:n.parent)==null?void 0:c.name){case j.CARD:this.handleMouseClickOnCard(e[0].object.parent);return;case j.DROW_PILE:this.handleMouseClickOnDrawPile(e[0].object.parent);return}this.playerSelectObject&&this.clearPlayerSelect()},onMouseDoubleClick(a){a.preventDefault()},handleSwitchMenu(){window.innerWidth<Q().minimumViewPort||(Q().showMenu?setTimeout(()=>{this.fitGameContainerToSize(this.gameContainerWidth-Q().menuWidth)},200):this.fitGameContainerToSize(this.gameContainerWidth+Q().menuWidth))},fitGameContainerToSize(a,o){o==null&&(o=this.gameContainerHeight),a==null&&(a=this.gameContainerWidth),this.camera.aspect=a/o,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,o),this.gameContainerWidth=a,this.gameContainerHeight=o},clearAll(){this.resetScene(),this.scene=null,this.renderer=null,this.camera=null,this.gameContainerWidth=null,this.gameContainerHeight=null},async getDrawCardPileFromServer(a){const o=[];let i=Date.now();const e={cancel:null,id:i};let n=this.$get("prsi/all_cards",{groupId:a},!1,e);this.fetchPromises.push(e);const c=await n;if(this.fetchPromises=this.fetchPromises.filter(s=>s.id!==i),c!==null)return c.forEach(s=>{o.push(D.createCardFromMaterials(1,j.CARD,D.createTexturedMaterial(s.face),this.materials.cardBack,this.materials.cardFrame,{cardId:s.id,selectable:!0})),delete s.face}),o},async getStartParamsFromServer(a){let o=Date.now();o=Date.now();const i={cancel:null,id:o},e=await this.$post("prsi",a,!1,i);this.fetchPromises.push(i);const n=await e;return this.fetchPromises=this.fetchPromises.filter(c=>c.id!==o),n}},mounted(){this.initWebGL(),this.addListeners(),d().setPlayers(2),d().isGameActive=!1},beforeUnmount(){this.removeListeners(),this.clearAll()},watch:{showMenu(){this.handleSwitchMenu()},players(){this.handleChangePlayers()},isGameActive(){this.isGameActive?this.startGame():this.resetGame()}}}),Zt=a=>(Ot("data-v-08a5609d"),a=a(),kt(),a),$t={class:"height-100 width-100 fp-column game-page",ref:"gamePage"},Qt={key:0,class:"overlay"},Jt=Zt(()=>ie("span",{class:"overlay-text"},"Na\u010D\xEDt\xE1n\xED hry",-1)),ea=[Jt],ta={id:"gameContainer",ref:"gameContainer",class:"game-container"},aa={class:"game-toolbar"},na={class:"fp-column",style:{position:"absolute",right:"3px"}};function oa(a,o,i,e,n,c){var s;return Ge(),We("div",$t,[a.loading?(Ge(),We("div",Qt,ea)):xt("",!0),ie("div",ta,null,512),ie("div",aa," hra: "+J(a.isGameActive)+", hr\xE1\u010D\u016F: "+J(a.players)+", W: "+J(a.gameContainerWidth)+" H: "+J(a.gameContainerHeight)+", ativn\xED hr\xE1\u010D: "+J((s=a.activePlayer)==null?void 0:s.name),1),ie("div",na,[Ke(Fe,{style:{margin:"3px"},icon:"visibility",color:"accent",title:"Zobrazit pohled hr\xE1\u010De",onClick:o[0]||(o[0]=r=>a.changeCameraView(a.cameraView.PLAYER))}),Ke(Fe,{style:{margin:"3px"},icon:"panorama",color:"accent",title:"N\xE1hled na hern\xED st\u016Fl",onClick:o[1]||(o[1]=r=>a.changeCameraView(a.cameraView.TABLE))})])],512)}var ma=St(qt,[["render",oa],["__scopeId","data-v-08a5609d"]]);export{ma as default};
